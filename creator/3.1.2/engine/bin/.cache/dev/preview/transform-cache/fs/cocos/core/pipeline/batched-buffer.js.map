{"version":3,"sources":["../../../../../../../../../cocos/core/pipeline/batched-buffer.ts"],"names":["BufferUsageBit","Format","MemoryUsageBit","InputAssemblerInfo","Attribute","BufferInfo","Mat4","UBOLocalBatched","SubModelPool","SubModelView","BatchedBuffer","get","pass","extraKey","buffers","_buffers","has","set","record","batches","dynamicOffsets","_device","device","destroy","i","length","batch","j","vbs","vbIdx","ia","ubo","merge","subModel","passIdx","model","flatBuffers","subMesh","vbSize","vbIdxSize","vbCount","count","passes","hShader","handle","SHADER_0","descriptorSet","isBatchExist","mergeCount","BATCHING_COUNT","vb","stride","flatBuff","batchVB","vbBuf","vbDatas","size","resize","Uint8Array","buffer","vbIdxBuf","vbIdxData","Float32Array","BYTES_PER_ELEMENT","start","end","toArray","uboData","transform","worldMatrix","MAT_WORLDS_OFFSET","bindBuffer","BINDING","update","vertexCount","totalVBs","newVB","createBuffer","VERTEX","TRANSFER_DST","HOST","DEVICE","push","fill","attributes","inputAssembler","attrs","Array","a","R32F","iaInfo","createInputAssembler","UNIFORM","SIZE","COUNT","clear","Map"],"mappings":"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"}