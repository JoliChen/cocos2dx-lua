{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/scene/skybox.ts"],"names":["builtinResMgr","Material","UNIFORM_ENVIRONMENT_BINDING","MaterialInstance","samplerLib","legacyCC","SkyboxPool","NULL_HANDLE","SkyboxView","skybox_mesh","skybox_material","Skybox","_envmap","_globalDSManager","_model","_default","_handle","alloc","initialize","skyboxInfo","set","ENABLE","enabled","USE_IBL","useIBL","IS_RGBE","isRGBE","envmap","activate","pipeline","director","root","ambient","pipelineSceneData","globalDSManager","get","createModel","renderer","scene","Model","_initLocalDescriptors","MODEL","handle","albedoArray","mipmapLevel","mat","effectName","defines","USE_RGBE_CUBEMAP","parent","recompileShaders","utils","createMesh","primitives","box","width","height","length","initSubModel","renderingSubMeshes","_updateGlobalBinding","_updatePipeline","value","current","macros","CC_USE_IBL","onGlobalPipelineStateChanged","texture","getGFXTexture","sampler","getSampler","_device","getSamplerHash","bindSampler","bindTexture","update","destroy","free","val","setSubModelMaterial"],"mappings":"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"}