{"version":3,"sources":["../../../../../../../../../../cocos/core/pipeline/forward/forward-pipeline.ts"],"names":["ccclass","displayOrder","type","serializable","RenderPipeline","ForwardFlow","RenderTextureConfig","MaterialConfig","ShadowFlow","UBOGlobal","UBOShadow","UBOCamera","UNIFORM_SHADOWMAP_BINDING","UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING","ColorAttachment","DepthStencilAttachment","LoadOp","RenderPassInfo","ClearFlagBit","Filter","Address","StoreOp","AccessType","SKYBOX_FLAG","genSamplerHash","samplerLib","builtinResMgr","errorID","sceneCulling","_samplerInfo","POINT","NONE","CLAMP","ForwardPipeline","_renderPasses","Map","initialize","info","_flows","length","shadowFlow","initInfo","push","forwardFlow","activate","_activeRenderer","render","cameras","_commandBuffers","begin","_pipelineUBO","updateGlobalUBO","i","camera","scene","updateCameraUBO","j","end","_device","flushCommands","queue","submit","getRenderPass","clearFlags","renderPass","get","device","colorAttachment","depthStencilAttachment","format","colorFormat","depthStencilFormat","stencilStoreOp","DISCARD","depthStoreOp","COLOR","loadOp","LOAD","beginAccesses","PRESENT","DEPTH_STENCIL","DEPTH","depthLoadOp","STENCIL","stencilLoadOp","DEPTH_STENCIL_ATTACHMENT_WRITE","renderPassInfo","createRenderPass","set","commandBuffer","shadowMapSamplerHash","shadowMapSampler","getSampler","_descriptorSet","bindSampler","bindTexture","getGFXTexture","update","destroyUBOs","getBuffer","BINDING","destroy","getTexture","rpIter","values","rpRes","next","done","value"],"mappings":"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"}