{"version":3,"sources":["../../../../../../../../../cocos/3d/models/skinning-model.ts"],"names":["getRelevantBuffers","outIndices","outBuffers","jointMaps","targetJoint","i","length","idxMap","index","j","push","AABB","BufferUsageBit","MemoryUsageBit","BufferInfo","Mat4","Vec3","UBOSkinning","ModelType","uploadJointData","MorphModel","AABBPool","AABBView","deleteTransform","getTransform","getWorldMatrix","myPatches","name","value","v3_min","v3_max","v3_1","v3_2","m4_1","ab_1","SkinningModel","uploadAnimation","_buffers","_dataArray","_joints","_bufferIndices","type","SKINNING","destroy","bindSkeleton","skeleton","skinningRoot","mesh","target","transform","boneSpaceBounds","getBoneSpaceBounds","struct","_ensureEnoughBuffers","jointBufferIndices","joints","bound","getChildByPath","bindpose","bindposes","indices","buffers","updateTransform","stamp","root","hasChangedFlags","_dirtyFlags","updateWorldTransform","_transformUpdated","set","Infinity","worldMatrix","getBoundary","min","max","worldBounds","_worldBounds","_modelBounds","fromPoints","_mat","_pos","_rot","_scale","setVec3","_hWorldBounds","CENTER","center","HALF_EXTENSION","halfExtents","updateUBOs","multiply","world","b","update","initSubModel","idx","subMeshData","mat","original","vertexBuffers","iaInfo","jointMappedBuffers","getMacroPatches","subModelIndex","superMacroPatches","concat","_updateLocalDescriptors","submodelIdx","descriptorSet","buffer","bindBuffer","BINDING","count","_device","createBuffer","UNIFORM","TRANSFER_DST","HOST","DEVICE","SIZE","Float32Array","COUNT"],"mappings":"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"}