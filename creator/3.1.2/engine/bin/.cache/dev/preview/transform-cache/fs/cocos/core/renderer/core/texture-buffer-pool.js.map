{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/core/texture-buffer-pool.ts"],"names":["nearestPOT","num","roundUp","n","alignment","Math","ceil","getTypedArrayConstructor","Format","FormatInfos","TextureType","TextureUsageBit","TextureFlagBit","TextureInfo","BufferTextureCopy","TextureBufferPool","device","_device","_format","UNKNOWN","_formatSize","_chunks","_chunkCount","_handles","_region0","_region1","_region2","_roundUpFn","_bufferViewCtor","Uint8Array","_channels","_alignment","initialize","info","formatInfo","format","size","count","roundUpFn","inOrderFree","alloc","_McDonaldAlloc","destroy","i","chunk","texture","length","chunkIdx","index","start","undefined","_findAvailableSpace","handle","end","push","targetSize","sqrt","texLength","max","newChunk","createChunk","texHandle","free","splice","texSize","console","createTexture","TEX2D","SAMPLED","TRANSFER_DST","IMMUTABLE","update","buffer","buffers","regions","remainSize","byteLength","offsetX","width","offsetY","floor","copySize","min","begin","texOffset","x","y","texExtent","height","copyBuffersToTexture","isFound","handles","filter","h","sort","a","b"],"mappings":"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"}