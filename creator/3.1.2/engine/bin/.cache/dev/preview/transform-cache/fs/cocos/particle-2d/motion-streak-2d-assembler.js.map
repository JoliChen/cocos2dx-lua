{"version":3,"sources":["../../../../../../../../cocos/particle-2d/motion-streak-2d-assembler.ts"],"names":["normal","out","dir","x","y","computeMiter","miter","lineA","lineB","halfThick","maxMultiple","add","_tangent","normalize","_vec2","multiple","dot","Math","min","MotionStreak","Vec2","Color","_normal","MotionStreakAssembler","createData","comp","renderData","requestRenderData","dataLength","vertexCount","indicesCount","update","dt","stroke","node","matrix","worldMatrix","tx","m12","ty","m13","points","cur","length","point","difx","dify","minSeg","Point","splice","setPoint","time","fadeTime","verticesCount","color","cr","r","cg","g","cb","b","ca","a","prev","distance","subtract","setDir","data","findLast","i","p","progress","next","da","c","offset","u","v","_val","updateRenderData","fillBuffers","renderer","dataList","buffer","acquireBufferBatch","vertexOffset","byteOffset","indicesOffset","vertexId","isRecreate","request","currBufferBatch","vBuf","vData","iBuf","iData","vert","z","toArray","l","start","MotionStreakAssemblerManager","getAssembler","Assembler"],"mappings":"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"}