{"version":3,"sources":["../../../../../../../../../../cocos/core/pipeline/deferred/lighting-stage.ts"],"names":["ccclass","displayOrder","type","serializable","builtinResMgr","localDescriptorSetLayout","UBODeferredLight","SetIndex","UBOForwardLight","getPhaseID","Color","Rect","BufferUsageBit","MemoryUsageBit","BufferInfo","BufferViewInfo","DescriptorSetLayoutInfo","DescriptorSetInfo","ClearFlagBit","RenderStage","DeferredStagePriority","PlanarShadowQueue","Material","ShaderPool","PipelineStateManager","intersect","Sphere","Vec3","Vec4","SRGBToLinear","renderQueueClearFunc","convertRenderQueue","renderQueueSortFunc","RenderQueueDesc","colors","LIGHTINGPASS_INDEX","LightingStage","_deferredLitsBufs","_maxDeferredLights","LIGHTS_PER_PASS","_lightMeterScale","_descriptorSet","_renderArea","_phaseID","_defPhaseID","_renderQueues","initialize","info","gatherLights","camera","pipeline","_pipeline","cmdBuff","commandBuffers","sphereLights","scene","spotLights","_sphere","create","_vec4Array","Float32Array","exposure","idx","elementLen","length","fieldLen","i","light","set","position","x","y","z","range","sphereFrustum","frustum","toArray","_lightBufferData","color","useColorTemperature","tempRGB","colorTemperatureRGB","pipelineSceneData","isHDR","luminance","fpScale","size","spotAngle","direction","offset","updateBuffer","activate","flow","device","renderQueues","totalSize","BYTES_PER_ELEMENT","Math","ceil","capabilities","uboOffsetAlignment","createBuffer","UNIFORM","TRANSFER_DST","HOST","DEVICE","deferredLitsBufView","layoutInfo","bindings","_descriptorSetLayout","createDescriptorSetLayout","createDescriptorSet","bindBuffer","BINDING","_planarQueue","destroy","render","renderObjects","update","gatherShadowPasses","dynamicOffsets","bindDescriptorSet","LOCAL","generateRenderArea","clearFlag","COLOR","clearColor","scale","w","deferredData","getDeferredRenderData","framebuffer","lightingFrameBuffer","renderPass","beginRenderPass","clearDepth","clearStencil","GLOBAL","descriptorSet","pass","shader","builinDeferred","get","passes","getShaderVariant","_deferredMaterial","inputAssembler","quadIAOffscreen","pso","getOrCreatePipelineState","bindPipelineState","bindInputAssembler","draw","forEach","m","p","k","ro","subModels","model","subModel","phase","insertRenderPass","recordCommandBuffer","endRenderPass","val","initInfo","name","priority","LIGHTING","tag"],"mappings":"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"}