{"version":3,"sources":["../../../../../../../../../cocos/3d/models/baked-skinning-model.ts"],"names":["BufferUsageBit","MemoryUsageBit","BufferInfo","INST_JOINT_ANIM_INFO","UBOSkinningAnimation","UBOSkinningTexture","UNIFORM_JOINT_TEXTURE_BINDING","samplerLib","ModelType","jointTextureSamplerHash","MorphModel","legacyCC","AABBPool","AABBView","myPatches","name","value","BakedSkinningModel","uploadedAnim","undefined","_jointsMedium","_skeleton","_mesh","_dataPoolManager","_instAnimInfoIdx","type","BAKED_SKINNING","director","root","dataPoolManager","jointTextureInfo","Float32Array","animInfo","jointAnimationInfo","getData","buffer","texture","boundsInfo","destroy","_applyJointTexture","bindSkeleton","skeleton","skinningRoot","mesh","transform","resMgr","uuid","_device","createBuffer","UNIFORM","TRANSFER_DST","HOST","DEVICE","SIZE","updateTransform","stamp","skelBound","data","worldBounds","_worldBounds","node","_mat","_pos","_rot","_scale","setVec3","_hWorldBounds","CENTER","center","HALF_EXTENSION","halfExtents","updateUBOs","info","idx","view","instancedAttributes","views","dirty","update","uploadAnimation","anim","jointTexturePool","getSequencePoseTexture","bounds","get","hash","_modelBounds","getDefaultPoseTexture","oldTex","releaseHandle","handle","width","joints","length","pixelOffset","updateInstancedJointTextureInfo","tex","i","_subModels","descriptorSet","bindTexture","getMacroPatches","subModelIndex","patches","concat","_updateLocalDescriptors","submodelIdx","bindBuffer","BINDING","sampler","getSampler","bindSampler","_updateInstancedAttributes","attributes","pass","_getInstancedAttributeIndex"],"mappings":";;;;;;;;;;;AAkCSA,MAAAA,c,mBAAAA,c;AAAgBC,MAAAA,c,mBAAAA,c;AAAkDC,MAAAA,U,mBAAAA,U;;AAClEC,MAAAA,oB,yBAAAA,oB;AAAsBC,MAAAA,oB,yBAAAA,oB;AAAsBC,MAAAA,kB,yBAAAA,kB;AAAoBC,MAAAA,6B,yBAAAA,6B;;AAGhEC,MAAAA,U,iCAAAA,U;;AAEAC,MAAAA,S,6BAAAA,S;;AACgCC,MAAAA,uB,8CAAAA,uB;;AAChCC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,Q,wBAAAA,Q;;AAEAC,MAAAA,Q,kCAAAA,Q;AAAUC,MAAAA,Q,kCAAAA,Q;;;AAUbC,MAAAA,S,GAAY,CACd;AAAEC,QAAAA,IAAI,EAAE,iBAAR;AAA2BC,QAAAA,KAAK,EAAE;AAAlC,OADc,EAEd;AAAED,QAAAA,IAAI,EAAE,wBAAR;AAAkCC,QAAAA,KAAK,EAAE;AAAzC,OAFc,C;AAKlB;AACA;AACA;AACA;AACA;AACA;;oCACaC,kB;;;AAC0D;AASnE,sCAAe;AAAA;;AACX;AADW,gBATRC,YASQ,GATyCC,SASzC;AAAA,gBAPPC,aAOO;AAAA,gBALPC,SAKO,GALsB,IAKtB;AAAA,gBAJPC,KAIO,GAJc,IAId;AAAA,gBAHPC,gBAGO;AAAA,gBAFPC,gBAEO,GAFY,CAAC,CAEb;AAEX,gBAAKC,IAAL,GAAYjB,SAAS,CAACkB,cAAtB;AACA,gBAAKH,gBAAL,GAAwBZ,QAAQ,CAACgB,QAAT,CAAkBC,IAAlB,CAAuBC,eAA/C;AACA,cAAMC,gBAAgB,GAAG,IAAIC,YAAJ,CAAiB,CAAjB,CAAzB;;AACA,cAAMC,QAAQ,GAAG,MAAKT,gBAAL,CAAsBU,kBAAtB,CAAyCC,OAAzC,EAAjB;;AACA,gBAAKd,aAAL,GAAqB;AAAEe,YAAAA,MAAM,EAAE,IAAV;AAAgBL,YAAAA,gBAAgB,EAAhBA,gBAAhB;AAAkCE,YAAAA,QAAQ,EAARA,QAAlC;AAA4CI,YAAAA,OAAO,EAAE,IAArD;AAA2DC,YAAAA,UAAU,EAAE;AAAvE,WAArB;AANW;AAOd;;;;eAEMC,O,GAAP,mBAAkB;AACd,eAAKpB,YAAL,GAAoBC,SAApB,CADc,CACiB;;AAC/B,eAAKC,aAAL,CAAmBiB,UAAnB,GAAgC,IAAhC;;AACA,cAAI,KAAKjB,aAAL,CAAmBe,MAAvB,EAA+B;AAC3B,iBAAKf,aAAL,CAAmBe,MAAnB,CAA0BG,OAA1B;;AACA,iBAAKlB,aAAL,CAAmBe,MAAnB,GAA4B,IAA5B;AACH;;AACD,eAAKI,kBAAL;;AACA,gCAAMD,OAAN;AACH,S;;eAEME,Y,GAAP,sBAAqBC,QAArB,EAAuDC,YAAvD,EAAyFC,IAAzF,EAAmH;AAAA,cAA9FF,QAA8F;AAA9FA,YAAAA,QAA8F,GAAlE,IAAkE;AAAA;;AAAA,cAA5DC,YAA4D;AAA5DA,YAAAA,YAA4D,GAAhC,IAAgC;AAAA;;AAAA,cAA1BC,IAA0B;AAA1BA,YAAAA,IAA0B,GAAN,IAAM;AAAA;;AAC/G,eAAKtB,SAAL,GAAiBoB,QAAjB;AACA,eAAKnB,KAAL,GAAaqB,IAAb;;AACA,cAAI,CAACF,QAAD,IAAa,CAACC,YAAd,IAA8B,CAACC,IAAnC,EAAyC;AAAE;AAAS;;AACpD,eAAKC,SAAL,GAAiBF,YAAjB;AACA,cAAMG,MAAM,GAAG,KAAKtB,gBAApB;AACA,eAAKH,aAAL,CAAmBY,QAAnB,GAA8Ba,MAAM,CAACZ,kBAAP,CAA0BC,OAA1B,CAAkCQ,YAAY,CAACI,IAA/C,CAA9B;;AACA,cAAI,CAAC,KAAK1B,aAAL,CAAmBe,MAAxB,EAAgC;AAC5B,iBAAKf,aAAL,CAAmBe,MAAnB,GAA4B,KAAKY,OAAL,CAAaC,YAAb,CAA0B,IAAI9C,UAAJ,CAClDF,cAAc,CAACiD,OAAf,GAAyBjD,cAAc,CAACkD,YADU,EAElDjD,cAAc,CAACkD,IAAf,GAAsBlD,cAAc,CAACmD,MAFa,EAGlD/C,kBAAkB,CAACgD,IAH+B,EAIlDhD,kBAAkB,CAACgD,IAJ+B,CAA1B,CAA5B;AAMH;AACJ,S;;eAEMC,e,GAAP,yBAAwBC,KAAxB,EAAuC;AACnC,gCAAMD,eAAN,YAAsBC,KAAtB;;AACA,cAAI,CAAC,KAAKrC,YAAV,EAAwB;AAAE;AAAS;;AAFA,oCAGF,KAAKE,aAHH;AAAA,cAG3BY,QAH2B,uBAG3BA,QAH2B;AAAA,cAGjBK,UAHiB,uBAGjBA,UAHiB;AAInC,cAAMmB,SAAS,GAAGnB,UAAU,CAAEL,QAAQ,CAACyB,IAAT,CAAc,CAAd,CAAF,CAA5B;AACA,cAAMC,WAAW,GAAG,KAAKC,YAAzB;;AACA,cAAID,WAAW,IAAIF,SAAnB,EAA8B;AAC1B,gBAAMI,IAAI,GAAG,KAAKhB,SAAlB,CAD0B,CAE1B;;AACAY,YAAAA,SAAS,CAACZ,SAAV,CAAoBgB,IAAI,CAACC,IAAzB,EAA+BD,IAAI,CAACE,IAApC,EAA0CF,IAAI,CAACG,IAA/C,EAAqDH,IAAI,CAACI,MAA1D,EAAkEN,WAAlE;AACA9C,YAAAA,QAAQ,CAACqD,OAAT,CAAiB,KAAKC,aAAtB,EAAqCrD,QAAQ,CAACsD,MAA9C,EAAsDT,WAAW,CAACU,MAAlE;AACAxD,YAAAA,QAAQ,CAACqD,OAAT,CAAiB,KAAKC,aAAtB,EAAqCrD,QAAQ,CAACwD,cAA9C,EAA8DX,WAAW,CAACY,WAA1E;AACH;AACJ,S,CAED;;;eACOC,U,GAAP,oBAAmBhB,KAAnB,EAAkC;AAC9B,gCAAMgB,UAAN,YAAiBhB,KAAjB;;AACA,cAAMiB,IAAI,GAAG,KAAKpD,aAAL,CAAmBY,QAAhC;AACA,cAAMyC,GAAG,GAAG,KAAKjD,gBAAjB;;AACA,cAAIiD,GAAG,IAAI,CAAX,EAAc;AACV,gBAAMC,IAAI,GAAG,KAAKC,mBAAL,CAAyBC,KAAzB,CAA+BH,GAA/B,CAAb;AACAC,YAAAA,IAAI,CAAC,CAAD,CAAJ,GAAUF,IAAI,CAACf,IAAL,CAAU,CAAV,CAAV;AACH,WAHD,MAGO,IAAIe,IAAI,CAACK,KAAT,EAAgB;AACnBL,YAAAA,IAAI,CAACrC,MAAL,CAAY2C,MAAZ,CAAmBN,IAAI,CAACf,IAAxB;AACAe,YAAAA,IAAI,CAACK,KAAL,GAAa,KAAb;AACH;;AACD,iBAAO,IAAP;AACH,S;;eAEME,e,GAAP,yBAAwBC,IAAxB,EAAoD;AAChD,cAAI,CAAC,KAAK3D,SAAN,IAAmB,CAAC,KAAKC,KAAzB,IAAkC,KAAKJ,YAAL,KAAsB8D,IAA5D,EAAkE;AAAE;AAAS;;AAC7E,eAAK9D,YAAL,GAAoB8D,IAApB;AACA,cAAMnC,MAAM,GAAG,KAAKtB,gBAApB;AACA,cAAIa,OAAmC,GAAG,IAA1C;;AACA,cAAI4C,IAAJ,EAAU;AACN5C,YAAAA,OAAO,GAAGS,MAAM,CAACoC,gBAAP,CAAwBC,sBAAxB,CAA+C,KAAK7D,SAApD,EAA+D2D,IAA/D,EAAqE,KAAK1D,KAA1E,EAAiF,KAAKsB,SAAtF,CAAV;AACA,iBAAKxB,aAAL,CAAmBiB,UAAnB,GAAgCD,OAAO,IAAIA,OAAO,CAAC+C,MAAR,CAAeC,GAAf,CAAmB,KAAK9D,KAAL,CAAW+D,IAA9B,CAA3C;AACA,iBAAKC,YAAL,GAAoB,IAApB,CAHM,CAGoB;AAC7B,WAJD,MAIO;AACHlD,YAAAA,OAAO,GAAGS,MAAM,CAACoC,gBAAP,CAAwBM,qBAAxB,CAA8C,KAAKlE,SAAnD,EAA8D,KAAKC,KAAnE,EAA0E,KAAKsB,SAA/E,CAAV;AACA,iBAAKxB,aAAL,CAAmBiB,UAAnB,GAAgC,IAAhC;AACA,iBAAKiD,YAAL,GAAoBlD,OAAO,IAAIA,OAAO,CAAC+C,MAAR,CAAeC,GAAf,CAAmB,KAAK9D,KAAL,CAAW+D,IAA9B,EAAqC,CAArC,CAA/B;AACH;;AACD,eAAK9C,kBAAL,CAAwBH,OAAxB;AACH,S;;eAESG,kB,GAAV,4BAA8BH,OAA9B,EAA0E;AAAA,cAA5CA,OAA4C;AAA5CA,YAAAA,OAA4C,GAAN,IAAM;AAAA;;AACtE,cAAMoD,MAAM,GAAG,KAAKpE,aAAL,CAAmBgB,OAAlC;;AACA,cAAIoD,MAAM,IAAIA,MAAM,KAAKpD,OAAzB,EAAkC;AAAE,iBAAKb,gBAAL,CAAsB0D,gBAAtB,CAAuCQ,aAAvC,CAAqDD,MAArD;AAA+D;;AACnG,eAAKpE,aAAL,CAAmBgB,OAAnB,GAA6BA,OAA7B;;AACA,cAAI,CAACA,OAAL,EAAc;AAAE;AAAS;;AAJ6C,qCAKjC,KAAKhB,aAL4B;AAAA,cAK9De,MAL8D,wBAK9DA,MAL8D;AAAA,cAKtDL,gBALsD,wBAKtDA,gBALsD;AAMtEA,UAAAA,gBAAgB,CAAC,CAAD,CAAhB,GAAsBM,OAAO,CAACsD,MAAR,CAAetD,OAAf,CAAuBuD,KAA7C;AACA7D,UAAAA,gBAAgB,CAAC,CAAD,CAAhB,GAAsB,KAAKT,SAAL,CAAgBuE,MAAhB,CAAuBC,MAA7C;AACA/D,UAAAA,gBAAgB,CAAC,CAAD,CAAhB,GAAsBM,OAAO,CAAC0D,WAAR,GAAsB,GAA5C,CARsE,CAQrB;;AACjDhE,UAAAA,gBAAgB,CAAC,CAAD,CAAhB,GAAsB,IAAIA,gBAAgB,CAAC,CAAD,CAA1C;AACA,eAAKiE,+BAAL;;AACA,cAAI5D,MAAJ,EAAY;AAAEA,YAAAA,MAAM,CAAC2C,MAAP,CAAchD,gBAAd;AAAkC;;AAChD,cAAMkE,GAAG,GAAG5D,OAAO,CAACsD,MAAR,CAAetD,OAA3B;;AAEA,eAAK,IAAI6D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKC,UAAL,CAAgBL,MAApC,EAA4C,EAAEI,CAA9C,EAAiD;AAC7C,gBAAME,aAAa,GAAG,KAAKD,UAAL,CAAgBD,CAAhB,EAAmBE,aAAzC;AACAA,YAAAA,aAAa,CAACC,WAAd,CAA0B9F,6BAA1B,EAAyD0F,GAAzD;AACH;AACJ,S;;eAEMK,e,GAAP,yBAAwBC,aAAxB,EAAqE;AACjE,cAAMC,OAAO,yBAASF,eAAT,YAAyBC,aAAzB,CAAb;;AACA,iBAAOC,OAAO,GAAGA,OAAO,CAACC,MAAR,CAAe1F,SAAf,CAAH,GAA+BA,SAA7C;AACH,S;;eAES2F,uB,GAAV,iCAAmCC,WAAnC,EAAwDP,aAAxD,EAAsF;AAClF,gCAAMM,uBAAN,YAA8BC,WAA9B,EAA2CP,aAA3C;;AADkF,qCAE5C,KAAK/E,aAFuC;AAAA,cAE1Ee,MAF0E,wBAE1EA,MAF0E;AAAA,cAElEC,OAFkE,wBAElEA,OAFkE;AAAA,cAEzDJ,QAFyD,wBAEzDA,QAFyD;AAGlFmE,UAAAA,aAAa,CAACQ,UAAd,CAAyBtG,kBAAkB,CAACuG,OAA5C,EAAqDzE,MAArD;AACAgE,UAAAA,aAAa,CAACQ,UAAd,CAAyBvG,oBAAoB,CAACwG,OAA9C,EAAuD5E,QAAQ,CAACG,MAAhE;;AACA,cAAIC,OAAJ,EAAa;AACT,gBAAMyE,OAAO,GAAGtG,UAAU,CAACuG,UAAX,CAAsB,KAAK/D,OAA3B,EAAoCtC,uBAApC,CAAhB;AACA0F,YAAAA,aAAa,CAACC,WAAd,CAA0B9F,6BAA1B,EAAyD8B,OAAO,CAACsD,MAAR,CAAetD,OAAxE;AACA+D,YAAAA,aAAa,CAACY,WAAd,CAA0BzG,6BAA1B,EAAyDuG,OAAzD;AACH;AACJ,S;;eAESG,0B,GAAV,oCAAsCC,UAAtC,EAA+DC,IAA/D,EAA2E;AACvE,gCAAMF,0BAAN,YAAiCC,UAAjC,EAA6CC,IAA7C;;AACA,eAAK1F,gBAAL,GAAwB,KAAK2F,2BAAL,CAAiChH,oBAAjC,CAAxB;AACA,eAAK4F,+BAAL;AACH,S;;eAEOA,+B,GAAR,2CAA2C;AAAA,qCACA,KAAK3E,aADL;AAAA,cAC/BU,gBAD+B,wBAC/BA,gBAD+B;AAAA,cACbE,QADa,wBACbA,QADa;AAEvC,cAAMyC,GAAG,GAAG,KAAKjD,gBAAjB;;AACA,cAAIiD,GAAG,IAAI,CAAX,EAAc;AAAE;AACZ,gBAAMC,IAAI,GAAG,KAAKC,mBAAL,CAAyBC,KAAzB,CAA+BH,GAA/B,CAAb;AACAC,YAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU1C,QAAQ,CAACyB,IAAT,CAAc,CAAd,CAAV;AACAiB,YAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU5C,gBAAgB,CAAC,CAAD,CAA1B;AACA4C,YAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU5C,gBAAgB,CAAC,CAAD,CAA1B;AACH;AACJ,S;;;QAlJmCpB,U"}