{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/core/render-window.ts"],"names":["TextureType","TextureUsageBit","Format","TextureInfo","FramebufferInfo","RenderWindowPool","RenderWindowView","FramebufferPool","NULL_HANDLE","RenderWindow","registerCreateFunc","root","_createWindowFun","_root","_title","_width","_height","_nativeWidth","_nativeHeight","_renderPass","_colorTextures","_depthStencilTexture","_swapchainBufferIndices","_shouldSyncSizeWithSwapchain","_poolHandle","_cameras","initialize","device","info","alloc","title","undefined","swapchainBufferIndices","shouldSyncSizeWithSwapchain","width","height","renderPassInfo","colorAttachments","depthStencilAttachment","i","length","format","UNKNOWN","colorFormat","depthStencilFormat","createRenderPass","colorTex","createTexture","TEX2D","COLOR_ATTACHMENT","SAMPLED","set","HAS_OFF_SCREEN_ATTACHMENTS","HAS_ON_SCREEN_ATTACHMENTS","push","DEPTH_STENCIL_ATTACHMENT","hFBO","FRAMEBUFFER","destroy","clearCameras","colorTexture","get","resize","needRebuild","framebuffer","camera","isWindowSize","extractRenderCameras","cameras","j","enabled","update","attachCamera","sortCameras","detachCamera","splice","sort","a","b","priority"],"mappings":";;;;;;;;;;;;;;;;;AA0BIA,MAAAA,W,eAAAA,W;AAAaC,MAAAA,e,eAAAA,e;AAAiBC,MAAAA,M,eAAAA,M;AACNC,MAAAA,W,eAAAA,W;AAAaC,MAAAA,e,eAAAA,e;;AAEZC,MAAAA,gB,kBAAAA,gB;AAAkBC,MAAAA,gB,kBAAAA,gB;AAAkBC,MAAAA,e,kBAAAA,e;AAAiBC,MAAAA,W,kBAAAA,W;;;AAYlF;AACA;AACA;AACA;8BACaC,Y;AAqDT;AACJ;AACA;qBACkBC,kB,GAAd,4BAAkCC,IAAlC,EAA8C;AAC1CA,UAAAA,IAAI,CAACC,gBAAL,GAAwB,UAACC,KAAD;AAAA,mBAA+B,IAAIJ,YAAJ,CAAiBI,KAAjB,CAA/B;AAAA,WAAxB;AACH,S;;AAeD,8BAAqBF,IAArB,EAAiC;AAAA,eAbvBG,MAauB,GAbd,EAac;AAAA,eAZvBC,MAYuB,GAZd,CAYc;AAAA,eAXvBC,OAWuB,GAXb,CAWa;AAAA,eAVvBC,YAUuB,GAVR,CAUQ;AAAA,eATvBC,aASuB,GATP,CASO;AAAA,eARvBC,WAQuB,GARU,IAQV;AAAA,eAPvBC,cAOuB,GAPc,EAOd;AAAA,eANvBC,oBAMuB,GANgB,IAMhB;AAAA,eALvBC,uBAKuB,GALG,CAKH;AAAA,eAJvBC,4BAIuB,GAJQ,KAIR;AAAA,eAHvBC,WAGuB,GAHWhB,WAGX;AAAA,eAFvBiB,QAEuB,GAFF,EAEE;AAChC;;;;eAEMC,U,GAAP,oBAAmBC,MAAnB,EAAmCC,IAAnC,EAAqE;AACjE,eAAKJ,WAAL,GAAmBnB,gBAAgB,CAACwB,KAAjB,EAAnB;;AAEA,cAAID,IAAI,CAACE,KAAL,KAAeC,SAAnB,EAA8B;AAC1B,iBAAKjB,MAAL,GAAcc,IAAI,CAACE,KAAnB;AACH;;AAED,cAAIF,IAAI,CAACI,sBAAL,KAAgCD,SAApC,EAA+C;AAC3C,iBAAKT,uBAAL,GAA+BM,IAAI,CAACI,sBAApC;AACH;;AAED,cAAIJ,IAAI,CAACK,2BAAL,KAAqCF,SAAzC,EAAoD;AAChD,iBAAKR,4BAAL,GAAoCK,IAAI,CAACK,2BAAzC;AACH;;AAED,eAAKlB,MAAL,GAAca,IAAI,CAACM,KAAnB;AACA,eAAKlB,OAAL,GAAeY,IAAI,CAACO,MAApB;AACA,eAAKlB,YAAL,GAAoB,KAAKF,MAAzB;AACA,eAAKG,aAAL,GAAqB,KAAKF,OAA1B;AAlBiE,qCAoBZY,IAAI,CAACQ,cApBO;AAAA,cAoBzDC,gBApByD,wBAoBzDA,gBApByD;AAAA,cAoBvCC,sBApBuC,wBAoBvCA,sBApBuC;;AAqBjE,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,gBAAgB,CAACG,MAArC,EAA6CD,CAAC,EAA9C,EAAkD;AAC9C,gBAAIF,gBAAgB,CAACE,CAAD,CAAhB,CAAoBE,MAApB,KAA+BvC,MAAM,CAACwC,OAA1C,EAAmD;AAC/CL,cAAAA,gBAAgB,CAACE,CAAD,CAAhB,CAAoBE,MAApB,GAA6Bd,MAAM,CAACgB,WAApC;AACH;AACJ;;AACD,cAAIL,sBAAsB,IAAIA,sBAAsB,CAACG,MAAvB,KAAkCvC,MAAM,CAACwC,OAAvE,EAAgF;AAC5EJ,YAAAA,sBAAsB,CAACG,MAAvB,GAAgCd,MAAM,CAACiB,kBAAvC;AACH;;AAED,eAAKzB,WAAL,GAAmBQ,MAAM,CAACkB,gBAAP,CAAwBjB,IAAI,CAACQ,cAA7B,CAAnB;;AAEA,eAAK,IAAIG,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGF,gBAAgB,CAACG,MAArC,EAA6CD,EAAC,EAA9C,EAAkD;AAC9C,gBAAIO,QAAwB,GAAG,IAA/B;;AACA,gBAAI,EAAE,KAAKxB,uBAAL,GAAgC,KAAKiB,EAAvC,CAAJ,EAAgD;AAC5CO,cAAAA,QAAQ,GAAGnB,MAAM,CAACoB,aAAP,CAAqB,IAAI5C,WAAJ,CAC5BH,WAAW,CAACgD,KADgB,EAE5B/C,eAAe,CAACgD,gBAAhB,GAAmChD,eAAe,CAACiD,OAFvB,EAG5Bb,gBAAgB,CAACE,EAAD,CAAhB,CAAoBE,MAHQ,EAI5B,KAAK1B,MAJuB,EAK5B,KAAKC,OALuB,CAArB,CAAX;AAOAX,cAAAA,gBAAgB,CAAC8C,GAAjB,CAAqB,KAAK3B,WAA1B,EAAuClB,gBAAgB,CAAC8C,0BAAxD,EAAoF,CAApF;AACH,aATD,MASO;AACH/C,cAAAA,gBAAgB,CAAC8C,GAAjB,CAAqB,KAAK3B,WAA1B,EAAuClB,gBAAgB,CAAC+C,yBAAxD,EAAmF,CAAnF;AACH;;AACD,iBAAKjC,cAAL,CAAoBkC,IAApB,CAAyBR,QAAzB;AACH,WA/CgE,CAiDjE;;;AACA,cAAIR,sBAAJ,EAA4B;AACxB,gBAAI,KAAKhB,uBAAL,IAAgC,CAApC,EAAuC;AACnC,mBAAKD,oBAAL,GAA4BM,MAAM,CAACoB,aAAP,CAAqB,IAAI5C,WAAJ,CAC7CH,WAAW,CAACgD,KADiC,EAE7C/C,eAAe,CAACsD,wBAAhB,GAA2CtD,eAAe,CAACiD,OAFd,EAG7CZ,sBAAsB,CAACG,MAHsB,EAI7C,KAAK1B,MAJwC,EAK7C,KAAKC,OALwC,CAArB,CAA5B;AAOAX,cAAAA,gBAAgB,CAAC8C,GAAjB,CAAqB,KAAK3B,WAA1B,EAAuClB,gBAAgB,CAAC8C,0BAAxD,EAAoF,CAApF;AACH,aATD,MASO;AACH/C,cAAAA,gBAAgB,CAAC8C,GAAjB,CAAqB,KAAK3B,WAA1B,EAAuClB,gBAAgB,CAAC+C,yBAAxD,EAAmF,CAAnF;AACH;AACJ;;AAED,cAAMG,IAAI,GAAGjD,eAAe,CAACsB,KAAhB,CAAsBF,MAAtB,EAA8B,IAAIvB,eAAJ,CACvC,KAAKe,WADkC,EAEvC,KAAKC,cAFkC,EAGvC,KAAKC,oBAHkC,CAA9B,CAAb;AAKAhB,UAAAA,gBAAgB,CAAC8C,GAAjB,CAAqB,KAAK3B,WAA1B,EAAuClB,gBAAgB,CAACmD,WAAxD,EAAqED,IAArE;AAEA,iBAAO,IAAP;AACH,S;;eAEME,O,GAAP,mBAAkB;AACd,eAAKC,YAAL;;AACA,cAAI,KAAKtC,oBAAT,EAA+B;AAC3B,iBAAKA,oBAAL,CAA0BqC,OAA1B;;AACA,iBAAKrC,oBAAL,GAA4B,IAA5B;AACH;;AAED,eAAK,IAAIkB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKnB,cAAL,CAAoBoB,MAAxC,EAAgDD,CAAC,EAAjD,EAAqD;AACjD,gBAAMqB,YAAY,GAAG,KAAKxC,cAAL,CAAoBmB,CAApB,CAArB;;AACA,gBAAIqB,YAAJ,EAAkB;AACdA,cAAAA,YAAY,CAACF,OAAb;AACH;AACJ;;AACD,eAAKtC,cAAL,CAAoBoB,MAApB,GAA6B,CAA7B;;AAEA,cAAI,KAAKhB,WAAT,EAAsB;AAClBjB,YAAAA,eAAe,CAACsD,GAAhB,CAAoBxD,gBAAgB,CAACwD,GAAjB,CAAqB,KAAKrC,WAA1B,EAAuClB,gBAAgB,CAACmD,WAAxD,CAApB,EAA0FC,OAA1F;AACA,iBAAKlC,WAAL,GAAmBhB,WAAnB;AACH;AACJ;AAED;AACJ;AACA;AACA;AACA;AACA;;;eACWsD,M,GAAP,gBAAe5B,KAAf,EAA8BC,MAA9B,EAA8C;AAC1C,eAAKpB,MAAL,GAAcmB,KAAd;AACA,eAAKlB,OAAL,GAAemB,MAAf;;AAEA,cAAID,KAAK,GAAG,KAAKjB,YAAb,IACGkB,MAAM,GAAG,KAAKjB,aADrB,EACoC;AAChC,iBAAKD,YAAL,GAAoBiB,KAApB;AACA,iBAAKhB,aAAL,GAAqBiB,MAArB;AAEA,gBAAI4B,WAAW,GAAG,KAAlB;;AAEA,gBAAI,KAAK1C,oBAAT,EAA+B;AAC3B,mBAAKA,oBAAL,CAA0ByC,MAA1B,CAAiC5B,KAAjC,EAAwCC,MAAxC;;AACA4B,cAAAA,WAAW,GAAG,IAAd;AACH;;AAED,iBAAK,IAAIxB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKnB,cAAL,CAAoBoB,MAAxC,EAAgDD,CAAC,EAAjD,EAAqD;AACjD,kBAAMO,QAAQ,GAAG,KAAK1B,cAAL,CAAoBmB,CAApB,CAAjB;;AACA,kBAAIO,QAAJ,EAAc;AACVA,gBAAAA,QAAQ,CAACgB,MAAT,CAAgB5B,KAAhB,EAAuBC,MAAvB;AACA4B,gBAAAA,WAAW,GAAG,IAAd;AACH;AACJ;;AAED,gBAAMC,WAAW,GAAGzD,eAAe,CAACsD,GAAhB,CAAoBxD,gBAAgB,CAACwD,GAAjB,CAAqB,KAAKrC,WAA1B,EAAuClB,gBAAgB,CAACmD,WAAxD,CAApB,CAApB;;AACA,gBAAIM,WAAW,IAAIC,WAAnB,EAAgC;AAC5BA,cAAAA,WAAW,CAACN,OAAZ;AACAM,cAAAA,WAAW,CAACtC,UAAZ,CAAuB,IAAItB,eAAJ,CACnB,KAAKe,WADc,EAEnB,KAAKC,cAFc,EAGnB,KAAKC,oBAHc,CAAvB;AAKH;AACJ;;AAED,+DAAqB,KAAKI,QAA1B,wCAAoC;AAAA,gBAAzBwC,MAAyB;;AAChC,gBAAIA,MAAM,CAACC,YAAX,EAAyB;AACrBD,cAAAA,MAAM,CAACH,MAAP,CAAc5B,KAAd,EAAqBC,MAArB;AACH;AACJ;AACJ,S;;eAEMgC,oB,GAAP,8BAA6BC,OAA7B,EAAgD;AAC5C,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK5C,QAAL,CAAce,MAAlC,EAA0C6B,CAAC,EAA3C,EAA+C;AAC3C,gBAAMJ,MAAM,GAAG,KAAKxC,QAAL,CAAc4C,CAAd,CAAf;;AACA,gBAAIJ,MAAM,CAACK,OAAX,EAAoB;AAChBL,cAAAA,MAAM,CAACM,MAAP;AACAH,cAAAA,OAAO,CAACd,IAAR,CAAaW,MAAb;AACH;AACJ;AACJ;AAED;AACJ;AACA;AACA;AACA;;;eACWO,Y,GAAP,sBAAqBP,MAArB,EAAqC;AACjC,eAAK,IAAI1B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKd,QAAL,CAAce,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,gBAAI,KAAKd,QAAL,CAAcc,CAAd,MAAqB0B,MAAzB,EAAiC;AAC7B;AACH;AACJ;;AACD,eAAKxC,QAAL,CAAc6B,IAAd,CAAmBW,MAAnB;;AACA,eAAKQ,WAAL;AACH;AAED;AACJ;AACA;AACA;AACA;;;eACWC,Y,GAAP,sBAAqBT,MAArB,EAAqC;AACjC,eAAK,IAAI1B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKd,QAAL,CAAce,MAAlC,EAA0C,EAAED,CAA5C,EAA+C;AAC3C,gBAAI,KAAKd,QAAL,CAAcc,CAAd,MAAqB0B,MAAzB,EAAiC;AAC7B,mBAAKxC,QAAL,CAAckD,MAAd,CAAqBpC,CAArB,EAAwB,CAAxB;;AACA;AACH;AACJ;AACJ;AAED;AACJ;AACA;AACA;;;eACWoB,Y,GAAP,wBAAuB;AACnB,eAAKlC,QAAL,CAAce,MAAd,GAAuB,CAAvB;AACH,S;;eAEMiC,W,GAAP,uBAAsB;AAClB,eAAKhD,QAAL,CAAcmD,IAAd,CAAmB,UAACC,CAAD,EAAYC,CAAZ;AAAA,mBAA0BD,CAAC,CAACE,QAAF,GAAaD,CAAC,CAACC,QAAzC;AAAA,WAAnB;AACH,S;;;;;AA5QD;AACJ;AACA;AACA;AACI,yBAAqB;AACjB,mBAAO,KAAKhE,MAAZ;AACH;AAED;AACJ;AACA;AACA;;;;eACI,eAAsB;AAClB,mBAAO,KAAKC,OAAZ;AACH;AAED;AACJ;AACA;AACA;;;;eACI,eAAgC;AAC5B,mBAAOT,eAAe,CAACsD,GAAhB,CAAoBxD,gBAAgB,CAACwD,GAAjB,CAAqB,KAAKrC,WAA1B,EAAuClB,gBAAgB,CAACmD,WAAxD,CAApB,CAAP;AACH;;;eAED,eAAmC;AAC/B,mBAAO,KAAKlC,4BAAZ;AACH;AAED;AACJ;AACA;AACA;;;;eACI,eAA8B;AAC1B,mBAAOlB,gBAAgB,CAACwD,GAAjB,CAAqB,KAAKrC,WAA1B,EAAuClB,gBAAgB,CAAC+C,yBAAxD,MAAuF,CAA9F;AACH;AAED;AACJ;AACA;AACA;;;;eACI,eAA+B;AAC3B,mBAAOhD,gBAAgB,CAACwD,GAAjB,CAAqB,KAAKrC,WAA1B,EAAuClB,gBAAgB,CAAC8C,0BAAxD,MAAwF,CAA/F;AACH;;;eAED,eAAmC;AAC/B,mBAAO,KAAK5B,WAAZ;AACH;;;eAED,eAAe;AACX,mBAAO,KAAKC,QAAZ;AACH"}