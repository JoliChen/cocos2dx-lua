{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/scene/render-scene.ts"],"names":["TransformBit","ScenePool","SceneView","ModelArrayPool","NULL_HANDLE","UIBatchArrayPool","LightArrayPool","RenderScene","registerCreateFunc","root","_createSceneFun","_root","_name","_cameras","_models","_batches","_directionalLights","_sphereLights","_spotLights","_mainLight","_modelId","_scenePoolHandle","_modelArrayHandle","_batchArrayHandle","_sphereLightsHandle","_spotLightsHandle","_createHandles","initialize","info","name","update","stamp","mainLight","sphereLights","i","length","light","spotLights","models","model","enabled","updateTransform","updateUBOs","destroy","removeCameras","removeSphereLights","removeSpotLights","removeModels","free","addCamera","cam","attachToScene","push","removeCamera","camera","splice","detachFromScene","setMainLight","dl","set","MAIN_LIGHT","handle","unsetMainLight","dlList","node","hasChangedFlags","ROTATION","addDirectionalLight","removeDirectionalLight","addSphereLight","pl","removeSphereLight","erase","addSpotLight","sl","removeSpotLight","clear","addModel","m","removeModel","addBatch","batch","removeBatch","removeBatches","onGlobalPipelineStateChanged","generateModelId","alloc","MODEL_ARRAY","SPOT_LIGHT_ARRAY","SPHERE_LIGHT_ARRAY","BATCH_ARRAY_2D"],"mappings":"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"}