{"version":3,"sources":["../../../../../../../../../cocos/core/pipeline/instanced-buffer.ts"],"names":["SubModelView","SubModelPool","UNIFORM_LIGHTMAP_TEXTURE_BINDING","BufferUsageBit","MemoryUsageBit","InputAssemblerInfo","Attribute","BufferInfo","INITIAL_CAPACITY","MAX_CAPACITY","InstancedBuffer","get","pass","extraKey","buffers","_buffers","has","set","record","instances","hasPendingModels","dynamicOffsets","_device","device","destroy","i","length","instance","vb","ia","merge","subModel","attrs","passIdx","hShaderImplant","stride","buffer","sourceIA","inputAssembler","lightingMap","descriptorSet","getTexture","hShader","handle","SHADER_0","hDescriptorSet","DESCRIPTOR_SET","indexBuffer","count","capacity","newSize","oldData","data","Uint8Array","resize","createBuffer","VERTEX","TRANSFER_DST","HOST","DEVICE","vertexBuffers","slice","attributes","attr","newAttr","name","format","isNormalized","push","iaInfo","createInputAssembler","uploadBuffers","cmdBuff","instanceCount","updateBuffer","clear","Map"],"mappings":";;;;;;AAgCSA,MAAAA,Y,8BAAAA,Y;AAAcC,MAAAA,Y,8BAAAA,Y;;AACdC,MAAAA,gC,aAAAA,gC;;AACAC,MAAAA,c,eAAAA,c;AAAgBC,MAAAA,c,eAAAA,c;AAAiDC,MAAAA,kB,eAAAA,kB;AACtEC,MAAAA,S,eAAAA,S;AAAmBC,MAAAA,U,eAAAA,U;;;AAnCvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAqBMC,MAAAA,gB,GAAmB,E;AACnBC,MAAAA,Y,GAAe,I;;iCAERC,e;wBAGKC,G,GAAd,aAAmBC,IAAnB,EAA+BC,QAA/B,EAA6C;AAAA,cAAdA,QAAc;AAAdA,YAAAA,QAAc,GAAH,CAAG;AAAA;;AACzC,cAAMC,OAAO,GAAGJ,eAAe,CAACK,QAAhC;AACA,cAAI,CAACD,OAAO,CAACE,GAAR,CAAYJ,IAAZ,CAAL,EAAwBE,OAAO,CAACG,GAAR,CAAYL,IAAZ,EAAkB,EAAlB;AACxB,cAAMM,MAAM,GAAGJ,OAAO,CAACH,GAAR,CAAYC,IAAZ,CAAf;AACA,iBAAOM,MAAM,CAACL,QAAD,CAAN,KAAqBK,MAAM,CAACL,QAAD,CAAN,GAAmB,IAAIH,eAAJ,CAAoBE,IAApB,CAAxC,CAAP;AACH,S;;AAQD,iCAAaA,IAAb,EAAyB;AAAA,eANlBO,SAMkB,GANY,EAMZ;AAAA,eALlBP,IAKkB;AAAA,eAJlBQ,gBAIkB,GAJC,KAID;AAAA,eAHlBC,cAGkB,GAHS,EAGT;AAAA,eAFjBC,OAEiB;AACrB,eAAKA,OAAL,GAAeV,IAAI,CAACW,MAApB;AACA,eAAKX,IAAL,GAAYA,IAAZ;AACH;;;;eAEMY,O,GAAP,mBAAkB;AACd,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKN,SAAL,CAAeO,MAAnC,EAA2C,EAAED,CAA7C,EAAgD;AAC5C,gBAAME,QAAQ,GAAG,KAAKR,SAAL,CAAeM,CAAf,CAAjB;AACAE,YAAAA,QAAQ,CAACC,EAAT,CAAYJ,OAAZ;AACAG,YAAAA,QAAQ,CAACE,EAAT,CAAYL,OAAZ;AACH;;AACD,eAAKL,SAAL,CAAeO,MAAf,GAAwB,CAAxB;AACH,S;;eAEMI,K,GAAP,eAAcC,QAAd,EAAkCC,KAAlC,EAAmEC,OAAnE,EAAoFC,cAApF,EAAgI;AAAA,cAA5CA,cAA4C;AAA5CA,YAAAA,cAA4C,GAAN,IAAM;AAAA;;AAC5H,cAAMC,MAAM,GAAGH,KAAK,CAACI,MAAN,CAAaV,MAA5B;;AACA,cAAI,CAACS,MAAL,EAAa;AAAE;AAAS,WAFoG,CAEnG;;;AACzB,cAAME,QAAQ,GAAGN,QAAQ,CAACO,cAA1B;AACA,cAAMC,WAAW,GAAGR,QAAQ,CAACS,aAAT,CAAuBC,UAAvB,CAAkCvC,gCAAlC,CAApB;AACA,cAAIwC,OAAO,GAAIR,cAAf;;AACA,cAAI,CAACQ,OAAL,EAAc;AACVA,YAAAA,OAAO,GAAGzC,YAAY,CAACU,GAAb,CAAiBoB,QAAQ,CAACY,MAA1B,EAAkC3C,YAAY,CAAC4C,QAAb,GAAwBX,OAA1D,CAAV;AACH;;AACD,cAAMY,cAAc,GAAG5C,YAAY,CAACU,GAAb,CAAiBoB,QAAQ,CAACY,MAA1B,EAAkC3C,YAAY,CAAC8C,cAA/C,CAAvB;;AACA,eAAK,IAAIrB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKN,SAAL,CAAeO,MAAnC,EAA2C,EAAED,CAA7C,EAAgD;AAC5C,gBAAME,QAAQ,GAAG,KAAKR,SAAL,CAAeM,CAAf,CAAjB;;AACA,gBAAIE,QAAQ,CAACE,EAAT,CAAYkB,WAAZ,KAA4BV,QAAQ,CAACU,WAArC,IAAoDpB,QAAQ,CAACqB,KAAT,IAAkBvC,YAA1E,EAAwF;AAAE;AAAW,aAFzD,CAI5C;;;AACA,gBAAIkB,QAAQ,CAACY,WAAT,KAAyBA,WAA7B,EAA0C;AACtC;AACH;;AAED,gBAAIZ,QAAQ,CAACQ,MAAT,KAAoBA,MAAxB,EAAgC;AAC5B;AACA;AACH;;AACD,gBAAIR,QAAQ,CAACqB,KAAT,IAAkBrB,QAAQ,CAACsB,QAA/B,EAAyC;AAAE;AACvCtB,cAAAA,QAAQ,CAACsB,QAAT,KAAsB,CAAtB;AACA,kBAAMC,OAAO,GAAGvB,QAAQ,CAACQ,MAAT,GAAkBR,QAAQ,CAACsB,QAA3C;AACA,kBAAME,OAAO,GAAGxB,QAAQ,CAACyB,IAAzB;AACAzB,cAAAA,QAAQ,CAACyB,IAAT,GAAgB,IAAIC,UAAJ,CAAeH,OAAf,CAAhB;AACAvB,cAAAA,QAAQ,CAACyB,IAAT,CAAcnC,GAAd,CAAkBkC,OAAlB;AACAxB,cAAAA,QAAQ,CAACC,EAAT,CAAY0B,MAAZ,CAAmBJ,OAAnB;AACH;;AACD,gBAAIvB,QAAQ,CAACe,OAAT,KAAqBA,OAAzB,EAAkC;AAAEf,cAAAA,QAAQ,CAACe,OAAT,GAAmBA,OAAnB;AAA6B;;AACjE,gBAAIf,QAAQ,CAACkB,cAAT,KAA4BA,cAAhC,EAAgD;AAAElB,cAAAA,QAAQ,CAACkB,cAAT,GAA0BA,cAA1B;AAA2C;;AAC7FlB,YAAAA,QAAQ,CAACyB,IAAT,CAAcnC,GAAd,CAAkBe,KAAK,CAACI,MAAxB,EAAgCT,QAAQ,CAACQ,MAAT,GAAkBR,QAAQ,CAACqB,KAAT,EAAlD;AACA,iBAAK5B,gBAAL,GAAwB,IAAxB;AACA;AACH,WApC2H,CAsC5H;;;AACA,cAAMQ,EAAE,GAAG,KAAKN,OAAL,CAAaiC,YAAb,CAA0B,IAAIhD,UAAJ,CACjCJ,cAAc,CAACqD,MAAf,GAAwBrD,cAAc,CAACsD,YADN,EAEjCrD,cAAc,CAACsD,IAAf,GAAsBtD,cAAc,CAACuD,MAFJ,EAGjCxB,MAAM,GAAG3B,gBAHwB,EAIjC2B,MAJiC,CAA1B,CAAX;;AAMA,cAAMiB,IAAI,GAAG,IAAIC,UAAJ,CAAelB,MAAM,GAAG3B,gBAAxB,CAAb;AACA,cAAMoD,aAAa,GAAGvB,QAAQ,CAACuB,aAAT,CAAuBC,KAAvB,EAAtB;AACA,cAAMC,UAAU,GAAGzB,QAAQ,CAACyB,UAAT,CAAoBD,KAApB,EAAnB;AACA,cAAMd,WAAW,GAAGV,QAAQ,CAACU,WAA7B;;AAEA,eAAK,IAAItB,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGO,KAAK,CAAC8B,UAAN,CAAiBpC,MAArC,EAA6CD,EAAC,EAA9C,EAAkD;AAC9C,gBAAMsC,IAAI,GAAG/B,KAAK,CAAC8B,UAAN,CAAiBrC,EAAjB,CAAb;AACA,gBAAMuC,OAAO,GAAG,IAAI1D,SAAJ,CAAcyD,IAAI,CAACE,IAAnB,EAAyBF,IAAI,CAACG,MAA9B,EAAsCH,IAAI,CAACI,YAA3C,EAAyDP,aAAa,CAAClC,MAAvE,EAA+E,IAA/E,CAAhB;AACAoC,YAAAA,UAAU,CAACM,IAAX,CAAgBJ,OAAhB;AACH;;AACDZ,UAAAA,IAAI,CAACnC,GAAL,CAASe,KAAK,CAACI,MAAf;AAEAwB,UAAAA,aAAa,CAACQ,IAAd,CAAmBxC,EAAnB;AACA,cAAMyC,MAAM,GAAG,IAAIhE,kBAAJ,CAAuByD,UAAvB,EAAmCF,aAAnC,EAAkDb,WAAlD,CAAf;;AACA,cAAMlB,EAAE,GAAG,KAAKP,OAAL,CAAagD,oBAAb,CAAkCD,MAAlC,CAAX;;AACA,eAAKlD,SAAL,CAAeiD,IAAf,CAAoB;AAAEpB,YAAAA,KAAK,EAAE,CAAT;AAAYC,YAAAA,QAAQ,EAAEzC,gBAAtB;AAAwCoB,YAAAA,EAAE,EAAFA,EAAxC;AAA4CwB,YAAAA,IAAI,EAAJA,IAA5C;AAAkDvB,YAAAA,EAAE,EAAFA,EAAlD;AAAsDM,YAAAA,MAAM,EAANA,MAAtD;AAA8DO,YAAAA,OAAO,EAAPA,OAA9D;AAAuEG,YAAAA,cAAc,EAAdA,cAAvE;AAAuFN,YAAAA,WAAW,EAAXA;AAAvF,WAApB;AACA,eAAKnB,gBAAL,GAAwB,IAAxB;AACH,S;;eAEMmD,a,GAAP,uBAAsBC,OAAtB,EAA8C;AAC1C,eAAK,IAAI/C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKN,SAAL,CAAeO,MAAnC,EAA2C,EAAED,CAA7C,EAAgD;AAC5C,gBAAME,QAAQ,GAAG,KAAKR,SAAL,CAAeM,CAAf,CAAjB;;AACA,gBAAI,CAACE,QAAQ,CAACqB,KAAd,EAAqB;AAAE;AAAW;;AAClCrB,YAAAA,QAAQ,CAACE,EAAT,CAAY4C,aAAZ,GAA4B9C,QAAQ,CAACqB,KAArC;AACAwB,YAAAA,OAAO,CAACE,YAAR,CAAqB/C,QAAQ,CAACC,EAA9B,EAAkCD,QAAQ,CAACyB,IAA3C;AACH;AACJ,S;;eAEMuB,K,GAAP,iBAAgB;AACZ,eAAK,IAAIlD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKN,SAAL,CAAeO,MAAnC,EAA2C,EAAED,CAA7C,EAAgD;AAC5C,gBAAME,QAAQ,GAAG,KAAKR,SAAL,CAAeM,CAAf,CAAjB;AACAE,YAAAA,QAAQ,CAACqB,KAAT,GAAiB,CAAjB;AACH;;AACD,eAAK5B,gBAAL,GAAwB,KAAxB;AACH,S;;;;;AA7GQV,MAAAA,e,CACMK,Q,GAAW,IAAI6D,GAAJ,E"}