{"version":3,"sources":["../../../../../../../../../cocos/core/pipeline/render-shadow-map-batched-queue.ts"],"names":["getShadowPassIndex","subModels","shadowPassIndices","length","hasShadowPass","j","passes","shadowPassIndex","k","phase","_phaseID","push","SetIndex","getPhaseID","PipelineStateManager","ShaderPool","SubModelPool","SubModelView","BatchingSchemes","RenderInstancedQueue","InstancedBuffer","RenderBatchedQueue","BatchedBuffer","ShadowType","LightType","intersect","_shadowPassIndices","RenderShadowMapBatchedQueue","pipeline","_pipeline","_subModelsArray","_passArray","_shaderArray","_instancedQueue","_batchedQueue","gatherLightPasses","light","cmdBuff","clear","shadowInfo","pipelineSceneData","shadows","shadowObjects","enabled","type","ShadowMap","pipelineUBO","updateShadowUBOLight","i","ro","model","DIRECTIONAL","add","SPOT","worldBounds","aabbWithAABB","aabb","aabbFrustum","frustum","subModel","shadowPassIdx","pass","batchingScheme","INSTANCING","buffer","get","merge","instancedAttributes","queue","VB_MERGING","shader","handle","SHADER_0","uploadBuffers","recordCommandBuffer","device","renderPass","ia","inputAssembler","pso","getOrCreatePipelineState","descriptorSet","bindPipelineState","bindDescriptorSet","MATERIAL","LOCAL","bindInputAssembler","draw"],"mappings":"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"}