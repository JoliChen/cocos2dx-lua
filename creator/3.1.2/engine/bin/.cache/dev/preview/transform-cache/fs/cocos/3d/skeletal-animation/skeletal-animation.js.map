{"version":3,"sources":["../../../../../../../../../cocos/3d/skeletal-animation/skeletal-animation.ts"],"names":["collectRecursively","node","prefix","out","i","children","length","child","path","name","push","ccclass","executeInEditMode","executionOrder","help","menu","tooltip","type","serializable","editable","SkinnedMeshRenderer","Mat4","Node","Animation","SkelAnimDataHub","SkeletalAnimationState","getWorldTransformUntilRoot","legacyCC","js","Socket","target","setClassAlias","m4_1","m4_2","SkeletalAnimation","onDestroy","director","root","dataPoolManager","jointAnimationInfo","destroy","uuid","getAnimationManager","removeSockets","_sockets","start","sockets","useBakedAnimation","_useBakedAnimation","querySockets","animPaths","_defaultClip","Object","keys","getOrExtract","data","sort","reduce","acc","cur","startsWith","getChildByPath","rebuildSocketAnimations","socket","joint","substring","lastIndexOf","parent","fromRTS","rotation","position","scale","equals","matrix","_nameToState","stateName","state","rebuildSocketCurves","createSocket","find","s","console","warn","_createState","clip","_doCreateState","val","animMgr","addSockets","comps","getComponentsInChildren","comp","skinningRoot","setUseBakedAnimation"],"mappings":"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"}