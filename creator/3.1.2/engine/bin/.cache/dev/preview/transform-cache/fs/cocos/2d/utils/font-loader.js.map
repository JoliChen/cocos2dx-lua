{"version":3,"sources":["../../../../../../../../../cocos/2d/utils/font-loader.ts"],"names":["checkFontLoaded","allFontsLoaded","now","Date","i","_loadingFonts","length","fontLoadHandle","fontFamily","fontFamilyName","startTime","_timeout","warnID","onComplete","splice","oldWidth","refWidth","fontDesc","_canvasContext","font","newWidth","safeMeasureText","_testString","clearInterval","_intervalId","nativeCheckFontLoaded","start","callback","loader","Promise","resolve","reject","check","document","fonts","load","then","setTimeout","timeoutId","timer","race","clearTimeout","loadFont","url","options","getFontFamily","_fontFaces","labelCanvas","createElement","width","height","getContext","fontStyle","type","fontStr","Number","isNaN","textContent","body","appendChild","preloadDiv","divStyle","style","innerHTML","position","left","top","useNativeCheck","push","setInterval","fontHandle","ttfIndex","lastIndexOf","slashPos","substring","indexOf","createFont","id","data","out","TTFFont","_nativeUrl","_nativeAsset","downloader","factory","Object","create","nativeCheck","undefined","window","match","exec","navigator","userAgent","safari10Match","vendor","parseInt","register"],"mappings":"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"}