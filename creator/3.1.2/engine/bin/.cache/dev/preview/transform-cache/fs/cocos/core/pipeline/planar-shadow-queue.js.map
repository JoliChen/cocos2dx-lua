{"version":3,"sources":["../../../../../../../../../cocos/core/pipeline/planar-shadow-queue.ts"],"names":["AABB","intersect","SetIndex","InstancedBuffer","PipelineStateManager","DSPool","ShaderPool","PassPool","PassView","RenderInstancedQueue","ShadowType","Layers","_ab","PlanarShadowQueue","pipeline","_pendingModels","_instancedQueue","_pipeline","gatherShadowPasses","camera","cmdBuff","pipelineSceneData","pipelineUBO","shadows","clear","length","enabled","type","Planar","updateShadowUBO","scene","frustum","shadowVisible","visibility","BitMask","DEFAULT","mainLight","renderObjects","instancedBuffer","get","instancingMaterial","passes","queue","add","i","model","node","castShadow","worldBounds","transform","matLight","aabbFrustum","isInstancingEnabled","subModels","m","subModel","merge","instancedAttributes","planarInstanceShaderHandle","push","uploadBuffers","recordCommandBuffer","device","renderPass","pass","material","descriptorSet","handle","DESCRIPTOR_SET","bindDescriptorSet","MATERIAL","modelCount","j","shader","planarShaderHandle","ia","inputAssembler","pso","getOrCreatePipelineState","bindPipelineState","LOCAL","bindInputAssembler","draw"],"mappings":"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"}