{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/scene/spot-light.ts"],"names":["AABB","Frustum","Mat4","Quat","Vec3","Light","LightType","nt2lm","AABBPool","AABBView","FrustumPool","LightPool","LightView","NULL_HANDLE","recordFrustumToSharedMemory","_forward","_qt","_matView","_matProj","_matViewProj","_matViewProjInv","SpotLight","_dir","_range","_spotAngle","Math","cos","PI","_pos","_aabb","_frustum","_angle","_needUpdate","_hAABB","_hFrustum","create","initialize","alloc","size","set","_handle","TYPE","SPOT","SIZE","ILLUMINANCE","RANGE","ASPECT","setVec3","DIRECTION","FRUSTUM","update","_node","hasChangedFlags","getWorldPosition","transformQuat","getWorldRotation","normalize","x","y","z","getWorldRT","invert","perspective","multiply","POSITION","CENTER","center","HALF_EXTENSION","halfExtents","destroy","free","get","range","lum","SPOT_ANGLE","val"],"mappings":"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"}