{"version":3,"sources":["../../../../../../../../../cocos/2d/utils/text-utils.ts"],"names":["getBaselineOffset","_BASELINE_OFFSET","isUnicodeCJK","ch","__CHINESE_REG","__JAPANESE_REG","__KOREAN_REG","test","isUnicodeSpace","chCode","charCodeAt","safeMeasureText","ctx","string","desc","font","key","cache","measureCache","get","metric","measureText","width","put","_safeSubstring","targetString","startIndex","endIndex","newStartIndex","newEndIndex","startChar","undefined","endChar","substring","fragmentText","stringToken","allWidth","maxWidth","wrappedWords","length","push","text","fuzzyLen","tmpText","sLine","pushNum","checkWhile","checkCount","exec","WORD_REG","sText","result","WRAP_INSPECTION","SYMBOL_REG","LAST_WORD_REG","FIRST_ENGLISH_REG","LAST_ENGLISH_REG","trim","RUNTIME_BASED","Pool","BASELINE_RATIO","MIDDLE_RATIO","MAX_CACHE_SIZE","pool","_get","value","prev","next","LRUCache","size","count","limit","datas","moveToHead","node","head","tail","discard","remove","clear","has","highSurrogateRex","lowSurrogateRex"],"mappings":"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"}