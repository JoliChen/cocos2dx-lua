{"version":3,"sources":["../../../../../../../../../cocos/core/asset-manager/downloader.ts"],"names":["BUILD","EDITOR","sys","js","callInNextTick","basename","Cache","downloadDomImage","downloadFile","downloadScript","files","retry","urlAppendTimestamp","legacyCC","REGEX","downloadImage","url","options","onComplete","func","capabilities","imageBitmap","assetManager","allowImageBitmap","downloadBlob","xhrResponseType","onFileProgress","downloadJson","downloadArrayBuffer","downloadText","downloadBundle","nameOrUrl","bundleName","test","downloader","remoteBundles","indexOf","remoteServerAddress","version","bundleVers","count","config","out","error","err","response","base","jspath","Downloader","maxConcurrency","maxRequestsPerFrame","maxRetryCount","appendTimeStamp","limited","retryInterval","downloadDomAudio","_downloaders","bundle","_downloading","_queue","_queueDirty","_totalNum","_totalNumThisPeriod","_lastDate","_checkNextPeriod","_remoteServerAddress","_maxInterval","init","clear","length","register","type","handler","mixin","download","id","file","get","downloadCallbacks","push","request","find","x","priority","process","index","callback","add","_updateTime","done","data","_handleQueueInNextFrame","finale","result","callbacks","remove","i","l","loadSubpackage","name","completeCallback","loadBundle","now","Date","deltaTime","director","getDeltaTime","interval","_handleQueue","sort","a","b","pop","bind"],"mappings":"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"}