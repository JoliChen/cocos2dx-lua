{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/cocos/core/pipeline/planar-shadow-queue.ts"],"names":["_ab","AABB","PlanarShadowQueue","constructor","pipeline","_pendingModels","_instancedQueue","RenderInstancedQueue","_pipeline","gatherShadowPasses","camera","cmdBuff","pipelineSceneData","pipelineUBO","shadows","clear","length","enabled","type","ShadowType","Planar","updateShadowUBO","scene","frustum","shadowVisible","visibility","Layers","BitMask","DEFAULT","mainLight","renderObjects","instancedBuffer","InstancedBuffer","get","instancingMaterial","passes","queue","add","i","model","node","castShadow","worldBounds","transform","matLight","intersect","aabbFrustum","isInstancingEnabled","subModels","m","subModel","merge","instancedAttributes","planarInstanceShaderHandle","push","uploadBuffers","recordCommandBuffer","device","renderPass","pass","material","descriptorSet","DSPool","PassPool","handle","PassView","DESCRIPTOR_SET","bindDescriptorSet","SetIndex","MATERIAL","modelCount","j","shader","ShaderPool","planarShaderHandle","ia","inputAssembler","pso","PipelineStateManager","getOrCreatePipelineState","bindPipelineState","LOCAL","bindInputAssembler","draw"],"mappings":"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"}