{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/cocos/core/pipeline/forward/forward-stage.ts"],"names":["colors","Color","ForwardStage","RenderQueueDesc","RenderStage","constructor","_renderQueues","_renderArea","Rect","_batchedQueue","_instancedQueue","_phaseID","_clearFlag","RenderBatchedQueue","RenderInstancedQueue","_uiPhase","UIPhase","initialize","info","renderQueues","activate","pipeline","flow","i","length","_additiveLightQueue","RenderAdditiveLightQueue","_pipeline","_planarQueue","PlanarShadowQueue","destroy","render","camera","clear","device","forEach","renderQueueClearFunc","renderObjects","pipelineSceneData","m","p","k","ro","subModels","model","subModel","passes","pass","phase","batchingScheme","BatchingSchemes","INSTANCING","instancedBuffer","InstancedBuffer","get","merge","instancedAttributes","queue","add","VB_MERGING","batchedBuffer","BatchedBuffer","insertRenderPass","renderQueueSortFunc","cmdBuff","commandBuffers","uploadBuffers","gatherLightPasses","gatherShadowPasses","sceneData","generateRenderArea","clearFlag","ClearFlagBit","COLOR","isHDR","clearColor","scale","fpScale","exposure","x","y","z","w","framebuffer","window","renderPass","colorTextures","getRenderPass","beginRenderPass","clearDepth","clearStencil","bindDescriptorSet","SetIndex","GLOBAL","descriptorSet","recordCommandBuffer","endRenderPass","initInfo","name","priority","ForwardStagePriority","FORWARD","tag","isTransparent","sortMode","RenderQueueSortMode","FRONT_TO_BACK","stages","BACK_TO_FRONT","serializable"],"mappings":"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"}