{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/cocos/2d/utils/font-loader.ts"],"names":["_canvasContext","_intervalId","_testString","_fontFaces","Object","create","_loadingFonts","_timeout","useNativeCheck","nativeCheck","undefined","window","match","exec","navigator","userAgent","safari10Match","vendor","parseInt","checkFontLoaded","allFontsLoaded","now","Date","i","length","fontLoadHandle","fontFamily","fontFamilyName","startTime","onComplete","splice","oldWidth","refWidth","fontDesc","font","newWidth","clearInterval","nativeCheckFontLoaded","start","callback","loader","Promise","resolve","reject","check","document","fonts","load","then","setTimeout","timeoutId","timer","race","clearTimeout","loadFont","url","options","getFontFamily","labelCanvas","createElement","width","height","getContext","fontStyle","type","fontStr","Number","isNaN","textContent","body","appendChild","preloadDiv","divStyle","style","innerHTML","position","left","top","push","setInterval","fontHandle","ttfIndex","lastIndexOf","slashPos","substring","indexOf","createFont","id","data","out","TTFFont","_nativeUrl","_nativeAsset","downloader","register","factory"],"mappings":";;;;;;;;AA8BA;;AACA;;AAEA;;AACA;;AACA;;;;AAnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAgBA,IAAIA,cAA+C,GAAG,IAAtD;;AACA,IAAIC,WAAW,GAAG,CAAC,CAAnB,C,CACA;;;AACA,MAAMC,WAAW,GAAG,mCAApB;;AAEA,MAAMC,UAAU,GAAGC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAnB;;AAEA,MAAMC,aAAgC,GAAG,EAAzC,C,CACA;;AACA,MAAMC,QAAQ,GAAG,IAAjB,C,CAEA;;AACA,MAAMC,cAAc,GAAG,CAAC,MAAM;AAC1B,MAAIC,WAAJ;AACA,SAAO,MAAe;AAClB,QAAIA,WAAW,KAAKC,SAApB,EAA+B;AAC3B,UAAI,cAAcC,MAAlB,EAA0B;AACtB,cAAMC,KAAK,GAAG,wBAAwBC,IAAxB,CAA6BF,MAAM,CAACG,SAAP,CAAiBC,SAA9C,CAAd;AACA,cAAMC,aAAa,GAAG,8BAA8BH,IAA9B,CAAmCF,MAAM,CAACG,SAAP,CAAiBC,SAApD,KAAkE,QAAQF,IAAR,CAAaF,MAAM,CAACG,SAAP,CAAiBG,MAA9B,CAAxF;;AAEA,YAAIL,KAAJ,EAAW;AACPH,UAAAA,WAAW,GAAGS,QAAQ,CAACN,KAAK,CAAC,CAAD,CAAN,EAAW,EAAX,CAAR,GAAyB,EAAvC;AACH,SAFD,MAEO,IAAII,aAAJ,EAAmB;AACtBP,UAAAA,WAAW,GAAG,KAAd;AACH,SAFM,MAEA;AACHA,UAAAA,WAAW,GAAG,IAAd;AACH;AACJ,OAXD,MAWO;AACHA,QAAAA,WAAW,GAAG,KAAd;AACH;AACJ;;AAED,WAAOA,WAAP;AACH,GAnBD;AAoBH,CAtBsB,GAAvB;;AAwBA,SAASU,eAAT,GAA4B;AACxB,MAAIC,cAAc,GAAG,IAArB;AACA,QAAMC,GAAG,GAAGC,IAAI,CAACD,GAAL,EAAZ;;AAEA,OAAK,IAAIE,CAAC,GAAGjB,aAAa,CAACkB,MAAd,GAAuB,CAApC,EAAuCD,CAAC,IAAI,CAA5C,EAA+CA,CAAC,EAAhD,EAAoD;AAChD,UAAME,cAAc,GAAGnB,aAAa,CAACiB,CAAD,CAApC;AACA,UAAMG,UAAU,GAAGD,cAAc,CAACE,cAAlC,CAFgD,CAGhD;;AACA,QAAIN,GAAG,GAAGI,cAAc,CAACG,SAArB,GAAiCrB,QAArC,EAA+C;AAC3C,yBAAO,IAAP,EAAamB,UAAb;AACAD,MAAAA,cAAc,CAACI,UAAf,CAA0B,IAA1B,EAAgCH,UAAhC;;AACApB,MAAAA,aAAa,CAACwB,MAAd,CAAqBP,CAArB,EAAwB,CAAxB;;AACA;AACH;;AAED,UAAMQ,QAAQ,GAAGN,cAAc,CAACO,QAAhC;AACA,UAAMC,QAAQ,GAAI,QAAOP,UAAW,EAApC;AACA1B,IAAAA,cAAc,CAAEkC,IAAhB,GAAuBD,QAAvB;AACA,UAAME,QAAQ,GAAG,gCAAgBnC,cAAhB,EAAiCE,WAAjC,EAA8C+B,QAA9C,CAAjB,CAdgD,CAehD;;AACA,QAAIF,QAAQ,KAAKI,QAAjB,EAA2B;AACvB7B,MAAAA,aAAa,CAACwB,MAAd,CAAqBP,CAArB,EAAwB,CAAxB;;AACAE,MAAAA,cAAc,CAACI,UAAf,CAA0B,IAA1B,EAAgCH,UAAhC;AACH,KAHD,MAGO;AACHN,MAAAA,cAAc,GAAG,KAAjB;AACH;AACJ;;AAED,MAAIA,cAAJ,EAAoB;AAChBgB,IAAAA,aAAa,CAACnC,WAAD,CAAb;AACAA,IAAAA,WAAW,GAAG,CAAC,CAAf;AACH;AACJ,C,CAED;;;AACA,SAASoC,qBAAT,CAAgCC,KAAhC,EAA+CJ,IAA/C,EAA6DK,QAA7D,EAA+F;AAC3F,QAAMC,MAAM,GAAG,IAAIC,OAAJ,CAAkB,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAClD,UAAMC,KAAK,GAAG,MAAM;AAChB,YAAMvB,GAAG,GAAGC,IAAI,CAACD,GAAL,EAAZ;;AAEA,UAAIA,GAAG,GAAGiB,KAAN,IAAe/B,QAAnB,EAA6B;AACzBoC,QAAAA,MAAM;AACT,OAFD,MAEO;AACH;AACAE,QAAAA,QAAQ,CAACC,KAAT,CAAeC,IAAf,CAAqB,QAAOb,IAAK,EAAjC,EAAoCc,IAApC,CAA0CF,KAAD,IAAW;AAChD,cAAIA,KAAK,CAACtB,MAAN,IAAgB,CAApB,EAAuB;AACnBkB,YAAAA,OAAO;AACV,WAFD,MAEO;AACHO,YAAAA,UAAU,CAACL,KAAD,EAAQ,GAAR,CAAV;AACH;AACJ,SAND,EAMG,MAAM;AACLD,UAAAA,MAAM;AACT,SARD;AASH;AACJ,KAjBD;;AAmBAC,IAAAA,KAAK;AACR,GArBc,CAAf;AAuBA,MAAIM,SAAwB,GAAG,IAA/B;AACA,QAAMC,KAAK,GAAG,IAAIV,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC3CO,IAAAA,SAAS,GAAGD,UAAU,CAACN,MAAD,EAASpC,QAAT,CAAtB;AACH,GAFa,CAAd;AAIAkC,EAAAA,OAAO,CAACW,IAAR,CAAa,CAACD,KAAD,EAAQX,MAAR,CAAb,EAA8BQ,IAA9B,CAAmC,MAAM;AACrC,QAAIE,SAAJ,EAAe;AACXG,MAAAA,YAAY,CAACH,SAAD,CAAZ;AACAA,MAAAA,SAAS,GAAG,IAAZ;AACH;;AAEDX,IAAAA,QAAQ,CAAC,IAAD,EAAOL,IAAP,CAAR;AACH,GAPD,EAOG,MAAM;AACL,uBAAO,IAAP,EAAaA,IAAb;AACAK,IAAAA,QAAQ,CAAC,IAAD,EAAOL,IAAP,CAAR;AACH,GAVD;AAWH;;AAEM,SAASoB,QAAT,CAAmBC,GAAnB,EAAgCC,OAAhC,EAAgE3B,UAAhE,EAA8F;AACjG,QAAMF,cAAc,GAAG8B,aAAa,CAACF,GAAD,CAApC,CADiG,CAGjG;;AACA,MAAIpD,UAAU,CAACwB,cAAD,CAAd,EAAgC;AAC5BE,IAAAA,UAAU,CAAC,IAAD,EAAOF,cAAP,CAAV;AACA;AACH;;AAED,MAAI,CAAC3B,cAAL,EAAqB;AACjB,UAAM0D,WAAW,GAAGb,QAAQ,CAACc,aAAT,CAAuB,QAAvB,CAApB;AACAD,IAAAA,WAAW,CAACE,KAAZ,GAAoB,GAApB;AACAF,IAAAA,WAAW,CAACG,MAAZ,GAAqB,GAArB;AACA7D,IAAAA,cAAc,GAAG0D,WAAW,CAACI,UAAZ,CAAuB,IAAvB,CAAjB;AACH,GAdgG,CAgBjG;;;AACA,QAAM7B,QAAQ,GAAI,QAAON,cAAe,EAAxC;AACA,QAAMK,QAAQ,GAAG,gCAAgBhC,cAAhB,EAAiCE,WAAjC,EAA8C+B,QAA9C,CAAjB,CAlBiG,CAoBjG;;AACA,QAAM8B,SAAS,GAAGlB,QAAQ,CAACc,aAAT,CAAuB,OAAvB,CAAlB;AACAI,EAAAA,SAAS,CAACC,IAAV,GAAiB,UAAjB;AACA,MAAIC,OAAO,GAAG,EAAd;;AACA,MAAIC,MAAM,CAACC,KAAP,CAAaxC,cAAb,CAAJ,EAAkC;AAC9BsC,IAAAA,OAAO,IAAK,4BAA2BtC,cAAe,QAAtD;AACH,GAFD,MAEO;AACHsC,IAAAA,OAAO,IAAK,6BAA4BtC,cAAe,SAAvD;AACH;;AACDsC,EAAAA,OAAO,IAAK,QAAOV,GAAI,KAAvB;AACAQ,EAAAA,SAAS,CAACK,WAAV,GAAyB,GAAEH,OAAQ,GAAnC;AACApB,EAAAA,QAAQ,CAACwB,IAAT,CAAcC,WAAd,CAA0BP,SAA1B,EA/BiG,CAiCjG;;AACA,QAAMQ,UAAU,GAAG1B,QAAQ,CAACc,aAAT,CAAuB,KAAvB,CAAnB;AACA,QAAMa,QAAQ,GAAGD,UAAU,CAACE,KAA5B;AACAD,EAAAA,QAAQ,CAAC9C,UAAT,GAAsBC,cAAtB;AACA4C,EAAAA,UAAU,CAACG,SAAX,GAAuB,GAAvB;AACAF,EAAAA,QAAQ,CAACG,QAAT,GAAoB,UAApB;AACAH,EAAAA,QAAQ,CAACI,IAAT,GAAgB,QAAhB;AACAJ,EAAAA,QAAQ,CAACK,GAAT,GAAe,QAAf;AACAhC,EAAAA,QAAQ,CAACwB,IAAT,CAAcC,WAAd,CAA0BC,UAA1B;;AAEA,MAAI/D,cAAc,EAAlB,EAAsB;AAClB6B,IAAAA,qBAAqB,CAACf,IAAI,CAACD,GAAL,EAAD,EAAaM,cAAb,EAA6BE,UAA7B,CAArB;AACH,GAFD,MAEO;AACH;AACA,UAAMJ,cAAc,GAAG;AACnBE,MAAAA,cADmB;AAEnBK,MAAAA,QAFmB;AAGnBH,MAAAA,UAHmB;AAInBD,MAAAA,SAAS,EAAEN,IAAI,CAACD,GAAL;AAJQ,KAAvB;;AAMAf,IAAAA,aAAa,CAACwE,IAAd,CAAmBrD,cAAnB;;AACA,QAAIxB,WAAW,KAAK,CAAC,CAArB,EAAwB;AACpBA,MAAAA,WAAW,GAAG8E,WAAW,CAAC5D,eAAD,EAAkB,GAAlB,CAAzB;AACH;AACJ;;AACDhB,EAAAA,UAAU,CAACwB,cAAD,CAAV,GAA6BoC,SAA7B;AACH;;AAEM,SAASN,aAAT,CAAwBuB,UAAxB,EAAoD;AACvD,QAAMC,QAAQ,GAAGD,UAAU,CAACE,WAAX,CAAuB,MAAvB,CAAjB;;AACA,MAAID,QAAQ,KAAK,CAAC,CAAlB,EAAqB;AAAE,WAAOD,UAAP;AAAoB;;AAE3C,QAAMG,QAAQ,GAAGH,UAAU,CAACE,WAAX,CAAuB,GAAvB,CAAjB;AACA,MAAIvD,cAAJ;;AACA,MAAIwD,QAAQ,KAAK,CAAC,CAAlB,EAAqB;AACjBxD,IAAAA,cAAc,GAAI,GAAEqD,UAAU,CAACI,SAAX,CAAqB,CAArB,EAAwBH,QAAxB,CAAkC,QAAtD;AACH,GAFD,MAEO;AACHtD,IAAAA,cAAc,GAAI,GAAEqD,UAAU,CAACI,SAAX,CAAqBD,QAAQ,GAAG,CAAhC,EAAmCF,QAAnC,CAA6C,QAAjE;AACH;;AACD,MAAItD,cAAc,CAAC0D,OAAf,CAAuB,GAAvB,MAAgC,CAAC,CAArC,EAAwC;AACpC1D,IAAAA,cAAc,GAAI,IAAGA,cAAe,GAApC;AACH;;AACD,SAAOA,cAAP;AACH;;AAED,SAAS2D,UAAT,CAAqBC,EAArB,EAAiCC,IAAjC,EAA+ChC,OAA/C,EAA+E3B,UAA/E,EAAsH;AAClH,QAAM4D,GAAG,GAAG,IAAIC,gBAAJ,EAAZ;AACAD,EAAAA,GAAG,CAACE,UAAJ,GAAiBJ,EAAjB;AACAE,EAAAA,GAAG,CAACG,YAAJ,GAAmBJ,IAAnB;AACA3D,EAAAA,UAAU,CAAC,IAAD,EAAO4D,GAAP,CAAV;AACH;;AAEDI,oBAAWC,QAAX,CAAoB;AAChB;AACA,WAASxC,QAFO;AAGhB,UAAQA,QAHQ;AAIhB,UAAQA,QAJQ;AAKhB,WAASA,QALO;AAMhB,UAAQA,QANQ;AAOhB,UAAQA;AAPQ,CAApB;;AAUAyC,iBAAQD,QAAR,CAAiB;AACb;AACA,WAASR,UAFI;AAGb,UAAQA,UAHK;AAIb,UAAQA,UAJK;AAKb,WAASA,UALI;AAMb,UAAQA,UANK;AAOb,UAAQA;AAPK,CAAjB"}