{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/cocos/core/pipeline/render-additive-light-queue.ts"],"names":["_lightPassPool","Pool","subModel","passIdx","dynamicOffsets","lights","_vec4Array","Float32Array","_sphere","Sphere","create","_dynamicOffsets","_lightIndices","_matShadowView","Mat4","_matShadowViewProj","cullSphereLight","light","model","worldBounds","intersect","aabbWithAABB","aabb","cullSpotLight","aabbFrustum","frustum","_phaseID","_lightPassIndices","getLightPassIndices","subModels","lightPassIndices","length","hasValidLightPass","j","passes","lightPassIndex","k","phase","push","RenderAdditiveLightQueue","constructor","pipeline","_pipeline","_device","_validLights","_lightPasses","_shadowUBO","UBOShadow","COUNT","_lightBufferCount","_lightBufferStride","_lightBufferElementCount","_lightBuffer","_firstLightBufferView","_lightBufferData","_instancedQueue","_batchedQueue","_lightMeterScale","device","RenderInstancedQueue","RenderBatchedQueue","alignment","capabilities","uboOffsetAlignment","Math","ceil","UBOForwardLight","SIZE","BYTES_PER_ELEMENT","createBuffer","BufferInfo","BufferUsageBit","UNIFORM","TRANSFER_DST","MemoryUsageBit","HOST","DEVICE","BufferViewInfo","clear","i","lp","freeArray","destroy","descriptorSetMap","globalDSManager","keys","key","descriptorSet","get","getBuffer","BINDING","getSampler","UNIFORM_SHADOWMAP_BINDING","UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING","getTexture","delete","gatherLightPasses","camera","cmdBuff","validLights","_gatherValidLights","_updateUBOs","_updateLightDescriptorSet","renderObjects","pipelineSceneData","ro","_lightCulling","lightPassIdx","pass","bindBuffer","update","_addRenderQueue","uploadBuffers","recordCommandBuffer","renderPass","shader","ShaderPool","SubModelPool","handle","SubModelView","SHADER_0","ia","inputAssembler","pso","PipelineStateManager","getOrCreatePipelineState","matDS","DSPool","PassPool","PassView","DESCRIPTOR_SET","localDS","bindPipelineState","bindDescriptorSet","SetIndex","MATERIAL","bindInputAssembler","getOrCreateDescriptorSet","GLOBAL","LOCAL","draw","sphereLights","scene","baked","set","position","x","y","z","range","sphereFrustum","spotLights","l","isCulled","type","LightType","SPHERE","SPOT","batchingScheme","BatchingSchemes","INSTANCING","idx","buffer","InstancedBuffer","merge","instancedAttributes","queue","add","VB_MERGING","BatchedBuffer","alloc","sceneData","shadowInfo","shadows","shadowFrameBufferMap","mainLight","isSupportHalfFloat","linear","packing","SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET","size","pcf","bias","SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET","normalBias","Color","toArray","shadowColor","SHADOW_COLOR_OFFSET","node","getWorldMatrix","MAT_LIGHT_VIEW_OFFSET","invert","perspective","spotAngle","aspect","multiply","MAT_LIGHT_VIEW_PROJ_OFFSET","SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET","selfShadow","has","texture","colorTextures","bindTexture","updateBuffer","exposure","isHDR","fpScale","resize","initialize","offset","Vec3","LIGHT_POS_OFFSET","LIGHT_SIZE_RANGE_ANGLE_OFFSET","color","useColorTemperature","tempRGB","colorTemperatureRGB","luminance","LIGHT_COLOR_OFFSET","direction","LIGHT_DIR_OFFSET"],"mappings":"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"}