{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/cocos/3d/models/skinning-model.ts"],"names":["myPatches","name","value","getRelevantBuffers","outIndices","outBuffers","jointMaps","targetJoint","i","length","idxMap","index","j","push","v3_min","Vec3","v3_max","v3_1","v3_2","m4_1","Mat4","ab_1","AABB","SkinningModel","MorphModel","constructor","uploadAnimation","_buffers","_dataArray","_joints","_bufferIndices","type","ModelType","SKINNING","destroy","bindSkeleton","skeleton","skinningRoot","mesh","target","transform","boneSpaceBounds","getBoneSpaceBounds","struct","_ensureEnoughBuffers","jointBufferIndices","joints","bound","getChildByPath","bindpose","bindposes","indices","buffers","updateTransform","stamp","root","hasChangedFlags","_dirtyFlags","updateWorldTransform","_transformUpdated","set","Infinity","worldMatrix","getBoundary","min","max","worldBounds","_worldBounds","_modelBounds","fromPoints","_mat","_pos","_rot","_scale","AABBPool","setVec3","_hWorldBounds","AABBView","CENTER","center","HALF_EXTENSION","halfExtents","updateUBOs","multiply","world","b","update","initSubModel","idx","subMeshData","mat","original","vertexBuffers","iaInfo","jointMappedBuffers","getMacroPatches","subModelIndex","superMacroPatches","concat","_updateLocalDescriptors","submodelIdx","descriptorSet","buffer","bindBuffer","UBOSkinning","BINDING","count","_device","createBuffer","BufferInfo","BufferUsageBit","UNIFORM","TRANSFER_DST","MemoryUsageBit","HOST","DEVICE","SIZE","Float32Array","COUNT"],"mappings":"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"}