{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/cocos/2d/utils/text-utils.ts"],"names":["BASELINE_RATIO","_BASELINE_OFFSET","RUNTIME_BASED","MIDDLE_RATIO","getBaselineOffset","MAX_CACHE_SIZE","pool","Pool","get","_get","key","value","prev","next","LRUCache","constructor","size","count","limit","datas","moveToHead","node","head","tail","put","discard","remove","clear","has","delete","measureCache","WORD_REG","SYMBOL_REG","LAST_WORD_REG","LAST_ENGLISH_REG","FIRST_ENGLISH_REG","WRAP_INSPECTION","highSurrogateRex","lowSurrogateRex","isUnicodeCJK","ch","__CHINESE_REG","__JAPANESE_REG","__KOREAN_REG","test","isUnicodeSpace","chCode","charCodeAt","safeMeasureText","ctx","string","desc","font","cache","metric","measureText","width","_safeSubstring","targetString","startIndex","endIndex","newStartIndex","newEndIndex","startChar","undefined","endChar","substring","fragmentText","stringToken","allWidth","maxWidth","wrappedWords","length","push","text","fuzzyLen","tmpText","sLine","pushNum","checkWhile","checkCount","exec","sText","result","trim"],"mappings":";;;;;;;;;;;;AA0BA;;AACA;;;;AA3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAKA;AACA;AACA;AACA;AAEO,MAAMA,cAAc,GAAG,IAAvB;;AACP,IAAIC,gBAAgB,GAAG,CAAvB;;AACA,IAAIC,oCAAJ,EAAmB;AACfD,EAAAA,gBAAgB,GAAGD,cAAc,GAAG,CAAjB,GAAqB,CAAxC;AACH;;AACM,MAAMG,YAAY,GAAG,CAACH,cAAc,GAAG,CAAlB,IAAuB,CAAvB,GAA2BA,cAAhD;;;AACA,SAASI,iBAAT,GAA8B;AACjC,SAAOH,gBAAP;AACH;;AAED,MAAMI,cAAc,GAAG,GAAvB;AASA,MAAMC,IAAI,GAAG,IAAIC,aAAJ,CAAqB,CAArB,CAAb;;AACAD,IAAI,CAACE,GAAL,GAAW,YAAY;AACnB,SAAO,KAAKC,IAAL,MAAe;AAClBC,IAAAA,GAAG,EAAE,EADa;AAElBC,IAAAA,KAAK,EAAE,CAFW;AAGlBC,IAAAA,IAAI,EAAE,IAHY;AAIlBC,IAAAA,IAAI,EAAE;AAJY,GAAtB;AAMH,CAPD;;AASA,MAAMC,QAAN,CAAe;AAOXC,EAAAA,WAAW,CAAEC,IAAF,EAAQ;AAAA,SANXC,KAMW,GANH,CAMG;AAAA,SALXC,KAKW,GALH,CAKG;AAAA,SAJXC,KAIW,GAJyB,EAIzB;AACf,SAAKD,KAAL,GAAaF,IAAb;AACH;;AAEMI,EAAAA,UAAU,CAAEC,IAAF,EAAQ;AACrBA,IAAAA,IAAI,CAACR,IAAL,GAAY,KAAKS,IAAjB;AACAD,IAAAA,IAAI,CAACT,IAAL,GAAY,IAAZ;AACA,QAAI,KAAKU,IAAT,EAAe,KAAKA,IAAL,CAAUV,IAAV,GAAiBS,IAAjB;AACf,SAAKC,IAAL,GAAYD,IAAZ;AACA,QAAI,CAAC,KAAKE,IAAV,EAAgB,KAAKA,IAAL,GAAYF,IAAZ;AAChB,SAAKJ,KAAL;AACA,SAAKE,KAAL,CAAWE,IAAI,CAACX,GAAhB,IAAuBW,IAAvB;AACH;;AAEMG,EAAAA,GAAG,CAAEd,GAAF,EAAOC,KAAP,EAAc;AACpB,UAAMU,IAAI,GAAGf,IAAI,CAACE,GAAL,EAAb;AACAa,IAAAA,IAAI,CAAEX,GAAN,GAAYA,GAAZ;AACAW,IAAAA,IAAI,CAAEV,KAAN,GAAcA,KAAd;;AAEA,QAAI,KAAKM,KAAL,IAAc,KAAKC,KAAvB,EAA8B;AAC1B,YAAMO,OAAO,GAAG,KAAKF,IAArB;AACA,aAAO,KAAKJ,KAAL,CAAWM,OAAO,CAACf,GAAnB,CAAP;AACA,WAAKO,KAAL;AACA,WAAKM,IAAL,GAAYE,OAAO,CAACb,IAApB;AACA,WAAKW,IAAL,CAAUV,IAAV,GAAiB,IAAjB;AACAY,MAAAA,OAAO,CAACb,IAAR,GAAe,IAAf;AACAa,MAAAA,OAAO,CAACZ,IAAR,GAAe,IAAf;AACAP,MAAAA,IAAI,CAACkB,GAAL,CAASC,OAAT;AACH;;AACD,SAAKL,UAAL,CAAgBC,IAAhB;AACH;;AAEMK,EAAAA,MAAM,CAAEL,IAAF,EAAQ;AACjB,QAAIA,IAAI,CAACT,IAAT,EAAe;AACXS,MAAAA,IAAI,CAACT,IAAL,CAAUC,IAAV,GAAiBQ,IAAI,CAACR,IAAtB;AACH,KAFD,MAEO;AACH,WAAKS,IAAL,GAAYD,IAAI,CAACR,IAAjB;AACH;;AACD,QAAIQ,IAAI,CAACR,IAAT,EAAe;AACXQ,MAAAA,IAAI,CAACR,IAAL,CAAUD,IAAV,GAAiBS,IAAI,CAACT,IAAtB;AACH,KAFD,MAEO;AACH,WAAKW,IAAL,GAAYF,IAAI,CAACT,IAAjB;AACH;;AACD,WAAO,KAAKO,KAAL,CAAWE,IAAI,CAACX,GAAhB,CAAP;AACA,SAAKO,KAAL;AACH;;AAEMT,EAAAA,GAAG,CAAEE,GAAF,EAAO;AACb,UAAMW,IAAI,GAAG,KAAKF,KAAL,CAAWT,GAAX,CAAb;;AACA,QAAIW,IAAJ,EAAU;AACN,WAAKK,MAAL,CAAYL,IAAZ;AACA,WAAKD,UAAL,CAAgBC,IAAhB;AACA,aAAOA,IAAI,CAACV,KAAZ;AACH;;AACD,WAAO,IAAP;AACH;;AAEMgB,EAAAA,KAAK,GAAI;AACZ,SAAKV,KAAL,GAAa,CAAb;AACA,SAAKE,KAAL,GAAa,EAAb;AACA,SAAKG,IAAL,GAAY,IAAZ;AACA,SAAKC,IAAL,GAAY,IAAZ;AACH;;AAEMK,EAAAA,GAAG,CAAElB,GAAF,EAAO;AACb,WAAO,CAAC,CAAC,KAAKS,KAAL,CAAWT,GAAX,CAAT;AACH;;AAEMmB,EAAAA,MAAM,CAAEnB,GAAF,EAAO;AAChB,UAAMW,IAAI,GAAG,KAAKF,KAAL,CAAWT,GAAX,CAAb;AACA,SAAKgB,MAAL,CAAYL,IAAZ;AACH;;AA9EU;;AAiFf,MAAMS,YAAY,GAAG,IAAIhB,QAAJ,CAAaT,cAAb,CAArB;AAEA,MAAM0B,QAAQ,GAAG,4CAAjB,C,CACA;;AACA,MAAMC,UAAU,GAAG,0BAAnB;AACA,MAAMC,aAAa,GAAG,0HAAtB;AACA,MAAMC,gBAAgB,GAAG,qHAAzB;AACA,MAAMC,iBAAiB,GAAG,oHAA1B;AACA,MAAMC,eAAe,GAAG,IAAxB,C,CACA;AACA;AACA;;AACA,MAAMC,gBAAgB,GAAG,iBAAzB;AACA,MAAMC,eAAe,GAAG,iBAAxB;;AAEO,SAASC,YAAT,CAAuBC,EAAvB,EAAmC;AACtC,QAAMC,aAAa,GAAG,iCAAtB;AACA,QAAMC,cAAc,GAAG,yHAAvB;AACA,QAAMC,YAAY,GAAG,oFAArB;AACA,SAAOF,aAAa,CAACG,IAAd,CAAmBJ,EAAnB,KAA0BE,cAAc,CAACE,IAAf,CAAoBJ,EAApB,CAA1B,IAAqDG,YAAY,CAACC,IAAb,CAAkBJ,EAAlB,CAA5D;AACH,C,CAED;;;AACO,SAASK,cAAT,CAAyBL,EAAzB,EAAqC;AACxC,QAAMM,MAAM,GAAGN,EAAE,CAACO,UAAH,CAAc,CAAd,CAAf;AACA,SAASD,MAAM,IAAI,CAAV,IAAeA,MAAM,IAAI,EAA1B,IACLA,MAAM,KAAK,EADN,IAELA,MAAM,KAAK,GAFN,IAGLA,MAAM,KAAK,GAHN,IAILA,MAAM,KAAK,IAJN,IAKJA,MAAM,IAAI,IAAV,IAAkBA,MAAM,IAAI,IALxB,IAMLA,MAAM,KAAK,IANN,IAOLA,MAAM,KAAK,IAPN,IAQLA,MAAM,KAAK,IARN,IASLA,MAAM,KAAK,IATN,IAULA,MAAM,KAAK,KAVd;AAWH;;AAEM,SAASE,eAAT,CAA0BC,GAA1B,EAAyDC,MAAzD,EAAyEC,IAAzE,EAAwF;AAC3F,QAAMC,IAAI,GAAGD,IAAI,IAAIF,GAAG,CAACG,IAAzB;AACA,QAAM1C,GAAG,GAAI,GAAE0C,IAAK,eAAcF,MAAO,EAAzC;AACA,QAAMG,KAAK,GAAGvB,YAAY,CAACtB,GAAb,CAAiBE,GAAjB,CAAd;;AACA,MAAI2C,KAAK,KAAK,IAAd,EAAoB;AAChB,WAAOA,KAAP;AACH;;AAED,QAAMC,MAAM,GAAGL,GAAG,CAACM,WAAJ,CAAgBL,MAAhB,CAAf;AACA,QAAMM,KAAK,GAAGF,MAAM,IAAIA,MAAM,CAACE,KAAjB,IAA0B,CAAxC;AACA1B,EAAAA,YAAY,CAACN,GAAb,CAAiBd,GAAjB,EAAsB8C,KAAtB;AAEA,SAAOA,KAAP;AACH,C,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASC,cAAT,CAAyBC,YAAzB,EAAuCC,UAAvC,EAAmDC,QAAnD,EAA8D;AAC1D,MAAIC,aAAa,GAAGF,UAApB;AACA,MAAIG,WAAW,GAAGF,QAAlB;AACA,QAAMG,SAAS,GAAGL,YAAY,CAACC,UAAD,CAA9B,CAH0D,CAI1D;;AACA,MAAII,SAAS,IAAI,QAAb,IAAyBA,SAAS,IAAI,QAA1C,EAAoD;AAChDF,IAAAA,aAAa;AAChB;;AACD,MAAID,QAAQ,KAAKI,SAAjB,EAA4B;AACxB,QAAIJ,QAAQ,GAAG,CAAX,KAAiBD,UAArB,EAAiC;AAC7B,YAAMM,OAAO,GAAGP,YAAY,CAACE,QAAQ,GAAG,CAAZ,CAA5B,CAD6B,CAE7B;;AACA,UAAIK,OAAO,IAAI,QAAX,IAAuBA,OAAO,IAAI,QAAtC,EAAgD;AAC5CH,QAAAA,WAAW;AACd;AACJ,KAND,MAMO,IAAIC,SAAS,IAAI,QAAb,IAAyBA,SAAS,IAAI,QAA1C,EAAoD;AACvD;AACAD,MAAAA,WAAW;AACd;AACJ;;AACD,SAAOJ,YAAY,CAACQ,SAAb,CAAuBL,aAAvB,EAAsCC,WAAtC,CAAP;AACH;;AAEM,SAASK,YAAT,CAAuBC,WAAvB,EAA4CC,QAA5C,EAA8DC,QAA9D,EAAgFf,WAAhF,EAAyH;AAC5H;AACA,QAAMgB,YAAsB,GAAG,EAA/B,CAF4H,CAG5H;;AACA,MAAIH,WAAW,CAACI,MAAZ,KAAuB,CAAvB,IAA4BF,QAAQ,GAAG,CAA3C,EAA8C;AAC1CC,IAAAA,YAAY,CAACE,IAAb,CAAkB,EAAlB;AACA,WAAOF,YAAP;AACH;;AAED,MAAIG,IAAI,GAAGN,WAAX;;AACA,SAAOC,QAAQ,GAAGC,QAAX,IAAuBI,IAAI,CAACF,MAAL,GAAc,CAA5C,EAA+C;AAC3C,QAAIG,QAAQ,GAAGD,IAAI,CAACF,MAAL,IAAeF,QAAQ,GAAGD,QAA1B,IAAsC,CAArD;;AACA,QAAIO,OAAO,GAAGnB,cAAc,CAACiB,IAAD,EAAOC,QAAP,CAA5B;;AACA,QAAInB,KAAK,GAAGa,QAAQ,GAAGd,WAAW,CAACqB,OAAD,CAAlC;AACA,QAAIC,KAAK,GAAGD,OAAZ;AACA,QAAIE,OAAO,GAAG,CAAd;AAEA,QAAIC,UAAU,GAAG,CAAjB;AACA,UAAMC,UAAU,GAAG,EAAnB,CAR2C,CAU3C;;AACA,WAAOxB,KAAK,GAAGc,QAAR,IAAoBS,UAAU,KAAKC,UAA1C,EAAsD;AAClDL,MAAAA,QAAQ,IAAIL,QAAQ,GAAGd,KAAvB;AACAmB,MAAAA,QAAQ,IAAI,CAAZ;AACAC,MAAAA,OAAO,GAAGnB,cAAc,CAACiB,IAAD,EAAOC,QAAP,CAAxB;AACAnB,MAAAA,KAAK,GAAGa,QAAQ,GAAGd,WAAW,CAACqB,OAAD,CAA9B;AACH;;AAEDG,IAAAA,UAAU,GAAG,CAAb,CAlB2C,CAoB3C;;AACA,WAAOvB,KAAK,IAAIc,QAAT,IAAqBS,UAAU,KAAKC,UAA3C,EAAuD;AACnD,UAAIJ,OAAJ,EAAa;AACT,cAAMK,IAAI,GAAGlD,QAAQ,CAACkD,IAAT,CAAcL,OAAd,CAAb;AACAE,QAAAA,OAAO,GAAGG,IAAI,GAAGA,IAAI,CAAC,CAAD,CAAJ,CAAQT,MAAX,GAAoB,CAAlC;AACAK,QAAAA,KAAK,GAAGD,OAAR;AACH;;AAEDD,MAAAA,QAAQ,IAAIG,OAAZ;AACAF,MAAAA,OAAO,GAAGnB,cAAc,CAACiB,IAAD,EAAOC,QAAP,CAAxB;AACAnB,MAAAA,KAAK,GAAGa,QAAQ,GAAGd,WAAW,CAACqB,OAAD,CAA9B;AACH;;AAEDD,IAAAA,QAAQ,IAAIG,OAAZ,CAjC2C,CAkC3C;;AACA,QAAIH,QAAQ,KAAK,CAAjB,EAAoB;AAChBA,MAAAA,QAAQ,GAAG,CAAX;AACAE,MAAAA,KAAK,GAAGpB,cAAc,CAACiB,IAAD,EAAO,CAAP,CAAtB;AACH,KAHD,MAGO,IAAIC,QAAQ,KAAK,CAAb,IAAkBD,IAAI,CAAC,CAAD,CAAJ,IAAW,QAA7B,IAAyCA,IAAI,CAAC,CAAD,CAAJ,IAAW,QAAxD,EAAkE;AACrE;AACAC,MAAAA,QAAQ,GAAG,CAAX;AACAE,MAAAA,KAAK,GAAGpB,cAAc,CAACiB,IAAD,EAAO,CAAP,CAAtB;AACH;;AAED,QAAIQ,KAAK,GAAGzB,cAAc,CAACiB,IAAD,EAAO,CAAP,EAAUC,QAAV,CAA1B;;AACA,QAAIQ,MAAJ,CA7C2C,CA+C3C;;AACA,QAAI/C,eAAJ,EAAqB;AACjB,UAAIJ,UAAU,CAACY,IAAX,CAAgBiC,KAAK,IAAID,OAAzB,CAAJ,EAAuC;AACnCO,QAAAA,MAAM,GAAGlD,aAAa,CAACgD,IAAd,CAAmBC,KAAnB,CAAT;AACAP,QAAAA,QAAQ,IAAIQ,MAAM,GAAGA,MAAM,CAAC,CAAD,CAAN,CAAUX,MAAb,GAAsB,CAAxC;;AACA,YAAIG,QAAQ,KAAK,CAAjB,EAAoB;AAAEA,UAAAA,QAAQ,GAAG,CAAX;AAAe;;AAErCE,QAAAA,KAAK,GAAGpB,cAAc,CAACiB,IAAD,EAAOC,QAAP,CAAtB;AACAO,QAAAA,KAAK,GAAGzB,cAAc,CAACiB,IAAD,EAAO,CAAP,EAAUC,QAAV,CAAtB;AACH;AACJ,KAzD0C,CA2D3C;;;AACA,QAAIxC,iBAAiB,CAACS,IAAlB,CAAuBiC,KAAvB,CAAJ,EAAmC;AAC/BM,MAAAA,MAAM,GAAGjD,gBAAgB,CAAC+C,IAAjB,CAAsBC,KAAtB,CAAT;;AACA,UAAIC,MAAM,IAAID,KAAK,KAAKC,MAAM,CAAC,CAAD,CAA9B,EAAmC;AAC/BR,QAAAA,QAAQ,IAAIQ,MAAM,CAAC,CAAD,CAAN,CAAUX,MAAtB;AACAK,QAAAA,KAAK,GAAGpB,cAAc,CAACiB,IAAD,EAAOC,QAAP,CAAtB;AACAO,QAAAA,KAAK,GAAGzB,cAAc,CAACiB,IAAD,EAAO,CAAP,EAAUC,QAAV,CAAtB;AACH;AACJ,KAnE0C,CAqE3C;;;AACA,QAAIJ,YAAY,CAACC,MAAb,KAAwB,CAA5B,EAA+B;AAC3BD,MAAAA,YAAY,CAACE,IAAb,CAAkBS,KAAlB;AACH,KAFD,MAEO;AACHA,MAAAA,KAAK,GAAGA,KAAK,CAACE,IAAN,EAAR;;AACA,UAAIF,KAAK,CAACV,MAAN,GAAe,CAAnB,EAAsB;AAClBD,QAAAA,YAAY,CAACE,IAAb,CAAkBS,KAAlB;AACH;AACJ;;AACDR,IAAAA,IAAI,GAAGG,KAAK,IAAID,OAAhB;AACAP,IAAAA,QAAQ,GAAGd,WAAW,CAACmB,IAAD,CAAtB;AACH;;AAED,MAAIH,YAAY,CAACC,MAAb,KAAwB,CAA5B,EAA+B;AAC3BD,IAAAA,YAAY,CAACE,IAAb,CAAkBC,IAAlB;AACH,GAFD,MAEO;AACHA,IAAAA,IAAI,GAAGA,IAAI,CAACU,IAAL,EAAP;;AACA,QAAIV,IAAI,CAACF,MAAL,GAAc,CAAlB,EAAqB;AACjBD,MAAAA,YAAY,CAACE,IAAb,CAAkBC,IAAlB;AACH;AACJ;;AACD,SAAOH,YAAP;AACH"}