{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/cocos/3d/models/baked-skinning-model.ts"],"names":["myPatches","name","value","BakedSkinningModel","MorphModel","constructor","uploadedAnim","undefined","_jointsMedium","_skeleton","_mesh","_dataPoolManager","_instAnimInfoIdx","type","ModelType","BAKED_SKINNING","legacyCC","director","root","dataPoolManager","jointTextureInfo","Float32Array","animInfo","jointAnimationInfo","getData","buffer","texture","boundsInfo","destroy","_applyJointTexture","bindSkeleton","skeleton","skinningRoot","mesh","transform","resMgr","uuid","_device","createBuffer","BufferInfo","BufferUsageBit","UNIFORM","TRANSFER_DST","MemoryUsageBit","HOST","DEVICE","UBOSkinningTexture","SIZE","updateTransform","stamp","skelBound","data","worldBounds","_worldBounds","node","_mat","_pos","_rot","_scale","AABBPool","setVec3","_hWorldBounds","AABBView","CENTER","center","HALF_EXTENSION","halfExtents","updateUBOs","info","idx","view","instancedAttributes","views","dirty","update","uploadAnimation","anim","jointTexturePool","getSequencePoseTexture","bounds","get","hash","_modelBounds","getDefaultPoseTexture","oldTex","releaseHandle","handle","width","joints","length","pixelOffset","updateInstancedJointTextureInfo","tex","i","_subModels","descriptorSet","bindTexture","UNIFORM_JOINT_TEXTURE_BINDING","getMacroPatches","subModelIndex","patches","concat","_updateLocalDescriptors","submodelIdx","bindBuffer","BINDING","UBOSkinningAnimation","sampler","samplerLib","getSampler","jointTextureSamplerHash","bindSampler","_updateInstancedAttributes","attributes","pass","_getInstancedAttributeIndex","INST_JOINT_ANIM_INFO"],"mappings":"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"}