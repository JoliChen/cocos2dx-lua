{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/cocos/core/pipeline/render-shadow-map-batched-queue.ts"],"names":["_phaseID","_shadowPassIndices","getShadowPassIndex","subModels","shadowPassIndices","length","hasShadowPass","j","passes","shadowPassIndex","k","phase","push","RenderShadowMapBatchedQueue","constructor","pipeline","_pipeline","_subModelsArray","_passArray","_shaderArray","_instancedQueue","_batchedQueue","RenderInstancedQueue","RenderBatchedQueue","gatherLightPasses","light","cmdBuff","clear","shadowInfo","pipelineSceneData","shadows","shadowObjects","enabled","type","ShadowType","ShadowMap","pipelineUBO","updateShadowUBOLight","i","ro","model","LightType","DIRECTIONAL","add","SPOT","worldBounds","intersect","aabbWithAABB","aabb","aabbFrustum","frustum","subModel","shadowPassIdx","pass","batchingScheme","BatchingSchemes","INSTANCING","buffer","InstancedBuffer","get","merge","instancedAttributes","queue","VB_MERGING","BatchedBuffer","shader","ShaderPool","SubModelPool","handle","SubModelView","SHADER_0","uploadBuffers","recordCommandBuffer","device","renderPass","ia","inputAssembler","pso","PipelineStateManager","getOrCreatePipelineState","descriptorSet","bindPipelineState","bindDescriptorSet","SetIndex","MATERIAL","LOCAL","bindInputAssembler","draw"],"mappings":"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"}