{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/cocos/core/pipeline/scene-culling.ts"],"names":["_tempVec3","Vec3","_dir_negate","_vec3_p","_mat4_trans","Mat4","_castWorldBounds","AABB","_castBoundsInited","_validLights","_sphere","Sphere","create","roPool","Pool","model","depth","shadowPool","getRenderObject","camera","node","subtract","worldPosition","position","dot","forward","ro","alloc","getCastShadowRenderObject","getShadowWorldMatrix","pipeline","rotation","dir","out","shadows","pipelineSceneData","negate","distance","sphere","radius","Shadows","COEFFICIENT_OF_EXPANSION","multiplyScalar","add","center","set","fromRT","updateSphereLight","light","pos","n","normal","d","NdL","lx","x","ly","y","lz","z","nx","ny","nz","m","matLight","m00","m01","m02","m03","m04","m05","m06","m07","m08","m09","m10","m11","m12","m13","m14","m15","pipelineUBO","updateShadowUBORange","UBOShadow","MAT_LIGHT_PLANE_PROJ_OFFSET","updateDirLight","direction","scale","updatePlanarPROJ","shadowInfo","shadowUBO","toArray","lightCollecting","lightNumber","length","scene","push","mainLight","spotLights","i","range","intersect","sphereFrustum","frustum","sceneCulling","sceneData","skybox","renderObjects","freeArray","shadowObjects","enabled","SHADOW_COLOR_OFFSET","shadowColor","type","ShadowType","ShadowMap","Planar","clearFlag","SKYBOX_FLAG","models","visibility","layer","visFlags","castShadow","worldBounds","copy","merge","aabbFrustum","toBoundingSphere"],"mappings":"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"}