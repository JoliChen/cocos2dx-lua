{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/pal/audio/web/player-dom.ts"],"names":["ensurePlaying","domAudio","Promise","resolve","promise","play","undefined","then","catch","onGesture","e","canvas","document","getElementById","addEventListener","once","OneShotAudioDOM","onPlay","_onPlayCb","cb","onEnd","_onEndCb","_domAudio","removeEventListener","constructor","nativeAudio","volume","stop","pause","AudioPlayerDOM","_state","AudioState","INIT","_onHide","_onShow","_onEnded","_eventTarget","EventTarget","_operationQueue","PLAYING","INTERRUPTED","emit","AudioEvent","INTERRUPTION_BEGIN","legacyCC","game","on","Game","EVENT_HIDE","INTERRUPTION_END","EVENT_SHOW","seek","ENDED","destroy","off","load","url","loadNative","reject","createElement","sys","loadedEvent","system","os","OS","IOS","browserType","BrowserType","FIREFOX","timer","setTimeout","readyState","failure","success","clearEvent","clearTimeout","message","src","loadOneShotAudio","oneShotAudio","type","AudioType","DOM_AUDIO","state","loop","val","duration","currentTime","time","PAUSED","STOPPED","onInterruptionBegin","offInterruptionBegin","onInterruptionEnd","offInterruptionEnd","onEnded","offEnded","enqueueOperation"],"mappings":"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"}