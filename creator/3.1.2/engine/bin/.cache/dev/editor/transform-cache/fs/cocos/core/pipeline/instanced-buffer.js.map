{"version":3,"sources":["file:///Users/mac/jenkins/workspace/Creator_3D/daily_build_mac/resources/3d/engine/cocos/core/pipeline/instanced-buffer.ts"],"names":["INITIAL_CAPACITY","MAX_CAPACITY","InstancedBuffer","get","pass","extraKey","buffers","_buffers","has","set","record","constructor","instances","hasPendingModels","dynamicOffsets","_device","device","destroy","i","length","instance","vb","ia","merge","subModel","attrs","passIdx","hShaderImplant","stride","buffer","sourceIA","inputAssembler","lightingMap","descriptorSet","getTexture","UNIFORM_LIGHTMAP_TEXTURE_BINDING","hShader","SubModelPool","handle","SubModelView","SHADER_0","hDescriptorSet","DESCRIPTOR_SET","indexBuffer","count","capacity","newSize","oldData","data","Uint8Array","resize","createBuffer","BufferInfo","BufferUsageBit","VERTEX","TRANSFER_DST","MemoryUsageBit","HOST","DEVICE","vertexBuffers","slice","attributes","attr","newAttr","Attribute","name","format","isNormalized","push","iaInfo","InputAssemblerInfo","createInputAssembler","uploadBuffers","cmdBuff","instanceCount","updateBuffer","clear","Map"],"mappings":"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"}