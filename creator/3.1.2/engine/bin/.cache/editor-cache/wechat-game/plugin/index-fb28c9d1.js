System.register(["./fog-01fb8507.js","./index-7f8a4e60.js","./sprite-frame-b3070608.js","./sprite-4b5143b3.js","./renderable-2d-de4bd246.js","./graphics-4817077e.js","./vertex-format-ddc9eb17.js","./deprecated-6da0b23e.js","./deprecated-6d1a0072.js"],(function(t){"use strict";var e,r,a,i,n,s,o,h,u,l,c,f,d,v,p,_,x,g,y,m,S,D,w,B,C,b,M,T,F,L,A,R,E,P,O,H,I,N,k,z,V,U,W,Z,q,G,X,j,K,Q,Y,J,$,tt,et,rt,at,it,nt,st,ot,ht,ut,lt,ct;return{setters:[function(t){e=t.cY,r=t.d3,a=t.da,i=t.d8,n=t.d6,s=t.cW,o=t.gf,h=t.g1,u=t.V,l=t.l,c=t.t,f=t.c,d=t.f,v=t.cb,p=t.ca,_=t.eg,x=t.ew,g=t.bX,y=t.gr,m=t.gZ,S=t.aS,D=t.R,w=t.e7,B=t.C,C=t.P,b=t.ap,M=t.z,T=t.G,F=t.d},function(t){L=t.i,A=t.x,R=t.y},function(t){E=t.d,P=t.S},function(t){O=t.h,H=t.O,I=t.e,N=t.i,k=t.H,z=t.V,V=t.j,U=t.k,W=t.c,Z=t.s,q=t.f,G=t.d,X=t.g,j=t.B,K=t.a,Q=t.T},function(t){Y=t.S,J=t.a},function(t){$=t.L,tt=t.a,et=t.P,rt=t.b,at=t.G},function(t){it=t.c,nt=t.g},function(t){st=t.L,ot=t.c,ht=t.a,ut=t.e,lt=t.M,ct=t.D},function(){}],execute:function(){t("e",Ht);var ft=new e,dt=new r;function vt(t,r,i,n){var s=i.data,o=r.acquireBufferBatch(),h=o.byteOffset>>2,u=i.vertexCount,l=o.indicesOffset,c=o.vertexOffset;o.request(u,i.indicesCount)||(o=r.currBufferBatch,u=0,l=0,c=0);var f=o.vData,d=o.iData;t.getWorldMatrix(dt);for(var v=0;v<u;v++){var p=s[v];e.set(ft,p.x,p.y,0),e.transformMat4(ft,ft,dt),f[h++]=ft.x,f[h++]=ft.y,f[h++]=ft.z,f[h++]=p.u,f[h++]=p.v,a.toArray(f,n,h),h+=4}for(var _=0,x=u/4;_<x;_++){var g=c+4*_;d[l++]=g,d[l++]=g+1,d[l++]=g+2,d[l++]=g+1,d[l++]=g+3,d[l++]=g+2}}var pt=function(t,e,r){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=r};function _t(t,e,r,a,i){var n=0,s=null;if(i===function(t,e,r,a){for(var i=0,n=e,s=r-a;n<r;n+=a)i+=(t[s]-t[n])*(t[n+1]+t[s+1]),s=n;return i}(t,e,r,a)>0)for(n=e;n<r;n+=a)s=Pt(n,t[n],t[n+1],s);else for(n=r-a;n>=e;n-=a)s=Pt(n,t[n],t[n+1],s);return s&&Lt(s,s.next)&&(Ot(s),s=s.next),s}function xt(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var r=t,a=!1;do{if(a=!1,r.steiner||!Lt(r,r.next)&&0!==Ft(r.prev,r,r.next))r=r.next;else{if(Ot(r),(r=e=r.prev)===r.next)return null;a=!0}}while(a||r!==e);return e}function gt(t,e,r,a,i,n,s){if(void 0===s&&(s=0),t){!s&&n&&function(t,e,r,a){var i=t;do{null===i.z&&(i.z=Ct(i.x,i.y,e,r,a)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e=0,r=null,a=null,i=null,n=null,s=0,o=0,h=0,u=1;do{for(r=t,t=null,n=null,s=0;r;){for(s++,a=r,o=0,e=0;e<u&&(o++,a=a.nextZ);e++);for(h=u;o>0||h>0&&a;)0===o?(i=a,a=a.nextZ,h--):0!==h&&a?r.z<=a.z?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,h--):(i=r,r=r.nextZ,o--),n?n.nextZ=i:t=i,i.prevZ=n,n=i;r=a}n.nextZ=null,u*=2}while(s>1)}(i)}(t,a,i,n);for(var o=t,h=null,u=null;t.prev!==t.next;)if(h=t.prev,u=t.next,n?mt(t,a,i,n):yt(t))e.push(h.i/r),e.push(t.i/r),e.push(u.i/r),Ot(t),t=u.next,o=u.next;else if((t=u)===o){s?1===s?gt(t=St(t,e,r),e,r,a,i,n,2):2===s&&Dt(t,e,r,a,i,n):gt(xt(t),e,r,a,i,n,1);break}}}function yt(t){var e=t.prev,r=t,a=t.next;if(Ft(e,r,a)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Mt(e.x,e.y,r.x,r.y,a.x,a.y,i.x,i.y)&&Ft(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function mt(t,e,r,a){var i=t.prev,n=t,s=t.next;if(Ft(i,n,s)>=0)return!1;for(var o=i.x<n.x?i.x<s.x?i.x:s.x:n.x<s.x?n.x:s.x,h=i.y<n.y?i.y<s.y?i.y:s.y:n.y<s.y?n.y:s.y,u=i.x>n.x?i.x>s.x?i.x:s.x:n.x>s.x?n.x:s.x,l=i.y>n.y?i.y>s.y?i.y:s.y:n.y>s.y?n.y:s.y,c=Ct(o,h,e,r,a),f=Ct(u,l,e,r,a),d=t.nextZ;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&Mt(i.x,i.y,n.x,n.y,s.x,s.y,d.x,d.y)&&Ft(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&Mt(i.x,i.y,n.x,n.y,s.x,s.y,d.x,d.y)&&Ft(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function St(t,e,r){var a=t;do{var i=a.prev,n=a.next.next;!Lt(i,n)&&At(i,a,a.next,n)&&Rt(i,n)&&Rt(n,i)&&(e.push(i.i/r),e.push(a.i/r),e.push(n.i/r),Ot(a),Ot(a.next),a=t=n),a=a.next}while(a!==t);return a}function Dt(t,e,r,a,i,n){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&Tt(s,o)){var h=Et(s,o);return s=xt(s,s.next),h=xt(h,h.next),gt(s,e,r,a,i,n),void gt(h,e,r,a,i,n)}o=o.next}s=s.next}while(s!==t)}function wt(t,e){return t.x-e.x}function Bt(t,e){if(e=function(t,e){var r=e,a=t.x,i=t.y,n=-1/0,s=null;do{if(i<=r.y&&i>=r.next.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=a&&o>n){if(n=o,o===a){if(i===r.y)return r;if(i===r.next.y)return r.next}s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!s)return null;if(a===n)return s.prev;var h,u=s,l=s.x,c=s.y,f=1/0;for(r=s.next;r!==u;)a>=r.x&&r.x>=l&&Mt(i<c?a:n,i,l,c,i<c?n:a,i,r.x,r.y)&&((h=Math.abs(i-r.y)/(a-r.x))<f||h===f&&r.x>s.x)&&Rt(r,t)&&(s=r,f=h),r=r.next;return s}(t,e)){var r=Et(e,t);xt(r,r.next)}}function Ct(t,e,r,a,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)/i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)/i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function bt(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function Mt(t,e,r,a,i,n,s,o){return(i-s)*(e-o)-(t-s)*(n-o)>=0&&(t-s)*(a-o)-(r-s)*(e-o)>=0&&(r-s)*(n-o)-(i-s)*(a-o)>=0}function Tt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&At(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&Rt(t,e)&&Rt(e,t)&&function(t,e){var r=t,a=!1,i=(t.x+e.x)/2,n=(t.y+e.y)/2;do{r.y>n!=r.next.y>n&&i<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(a=!a),r=r.next}while(r!==t);return a}(t,e)}function Ft(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Lt(t,e){return t.x===e.x&&t.y===e.y}function At(t,e,r,a){return!!(Lt(t,e)&&Lt(r,a)||Lt(t,a)&&Lt(r,e))||Ft(t,e,r)>0!=Ft(t,e,a)>0&&Ft(r,a,t)>0!=Ft(r,a,e)>0}function Rt(t,e){return Ft(t.prev,t,t.next)<0?Ft(t,e,t.next)>=0&&Ft(t,t.prev,e)>=0:Ft(t,e,t.prev)<0||Ft(t,t.next,e)<0}function Et(t,e){var r=new pt(t.i,t.x,t.y),a=new pt(e.i,e.x,e.y),i=t.next,n=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,a.next=r,r.prev=a,n.next=a,a.prev=n,a}function Pt(t,e,r,a){var i=new pt(t,e,r);return a?(i.next=a.next,i.prev=a,a.next.prev=i,a.next=i):(i.prev=i,i.next=i),i}function Ot(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ht(t,e,r){r=r||3;var a=e?e.length:0,i=a?e[0]*r:t.length,n=_t(t,0,i,r,!0),s=[];if(!n)return s;var o=0,h=0,u=0,l=0,c=0,f=0,d=0;if(a&&(n=function(t,e,r,a){var i,n=[],s=0,o=null;for(s=0,i=e.length;s<i;s++)(o=_t(t,e[s]*a,s<i-1?e[s+1]*a:t.length,a,!1))&&(o===o.next&&(o.steiner=!0),n.push(bt(o)));if(n.sort(wt),!r)return r;for(s=0;s<n.length;s++)Bt(n[s],r),r=xt(r,r.next);return r}(t,e,n,r)),t.length>80*r){o=u=t[0],h=l=t[1];for(var v=r;v<i;v+=r)(c=t[v])<o&&(o=c),(f=t[v+1])<h&&(h=f),c>u&&(u=c),f>l&&(l=f);d=Math.max(u-o,l-h)}return gt(n,s,r,o,h,d),s}for(var It=Math.PI,Nt=Math.min,kt=Math.max,zt=Math.ceil,Vt=Math.acos,Ut=Math.cos,Wt=Math.sin,Zt=Math.atan2,qt=null,Gt=null,Xt=new a,jt=[],Kt=0;Kt<4;Kt++)jt.push(new e);function Qt(t,e,r){return t<e?e:t>r?r:t}var Yt={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!Gt)return null;var r=Gt.getRenderDataList(),a=r[Gt.dataOffset];if(!a)return null;var i=a,n=i?i.vertexStart+e:0;return(n>65535||3*n>131070)&&(++Gt.dataOffset,Gt.dataOffset<r.length?a=r[Gt.dataOffset]:(a=Gt.requestRenderData(),r[Gt.dataOffset]=a),i=a),i&&i.vertexCount<n&&i.request(e,3*e),a},stroke:function(t){a.copy(Xt,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){a.copy(Xt,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e=.5*t.lineWidth,r=t.lineCap,a=t.lineJoin,i=t.miterLimit;if(Gt=t.impl){var n,s,o,h,u=(n=e,s=It,o=Gt.tessTol,h=2*Vt(n/(n+o)),kt(2,zt(s/h)));this._calculateJoins(Gt,e,a,i);for(var l=Gt.paths,c=0,f=Gt.pathOffset,d=Gt.pathLength;f<d;f++){var v=l[f],p=v.points.length;a===$.ROUND?c+=2*(p+v.bevel*(u+2)+1):c+=2*(p+5*v.bevel+1),v.closed||(r===tt.ROUND?c+=2*(2*u+2):c+=12)}var _=qt=this.getRenderData(t,c);if(_){for(var x=_.vData,g=_.iData,y=Gt.pathOffset,m=Gt.pathLength;y<m;y++){var S=l[y],D=S.points,w=D.length,B=_.vertexStart,C=void 0,b=void 0,M=0,T=0,F=S.closed;if(F?(C=D[w-1],b=D[0],M=0,T=w):(C=D[0],b=D[1],M=1,T=w-1),b=b||C,!F){var L=new et(b.x,b.y);L.subtract(C),L.normalize();var A=L.x,R=L.y;r===tt.BUTT?this._buttCapStart(C,A,R,e,0):r===tt.SQUARE?this._buttCapStart(C,A,R,e,e):r===tt.ROUND&&this._roundCapStart(C,A,R,e,u)}for(var E=M;E<T;++E)a===$.ROUND?this._roundJoin(C,b,e,e,u):0!=(b.flags&(rt.PT_BEVEL|rt.PT_INNERBEVEL))?this._bevelJoin(C,b,e,e):(this._vSet(b.x+b.dmx*e,b.y+b.dmy*e,1),this._vSet(b.x-b.dmx*e,b.y-b.dmy*e,-1)),C=b,b=D[E+1];if(F){var P=8*B;this._vSet(x[P],x[P+1],1),this._vSet(x[P+8],x[P+8+1],-1)}else{var O=new et(b.x,b.y);O.subtract(C),O.normalize();var H=O.x,I=O.y;r===tt.BUTT?this._buttCapEnd(b,H,I,e,0):r===tt.SQUARE?this._buttCapEnd(b,H,I,e,e):r===tt.ROUND&&this._roundCapEnd(b,H,I,e,u)}for(var N=_.indicesStart,k=B+2,z=_.vertexStart;k<z;k++)g[N++]=k-2,g[N++]=k-1,g[N++]=k;_.indicesStart=N}qt=null,Gt=null}}},_expandFill:function(t){if(Gt=t.impl){for(var e=Gt.paths,r=0,a=Gt.pathOffset,i=Gt.pathLength;a<i;a++)r+=e[a].points.length;var n=qt=this.getRenderData(t,r);if(n){for(var s=n,o=s.vData,h=s.iData,u=Gt.pathOffset,l=Gt.pathLength;u<l;u++){var c=e[u],f=c.points,d=f.length;if(0!==d){for(var v=n.vertexStart,p=0;p<d;++p)this._vSet(f[p].x,f[p].y);var _=n.indicesStart;if(c.complex){for(var x=[],g=v,y=n.vertexStart;g<y;g++){var m=8*g;x.push(o[m++]),x.push(o[m++]),x.push(o[m++])}var S=Ht(x,null,3);if(!S||0===S.length)continue;for(var D=0,w=S.length;D<w;D++)h[_++]=S[D]+v}else for(var B=v,C=v+2,b=s.vertexStart;C<b;C++)h[_++]=B,h[_++]=C-1,h[_++]=C;s.indicesStart=_}}qt=null,Gt=null}}},_calculateJoins:function(t,e,r,a){var i=0;e>0&&(i=1/e);for(var n=t.paths,s=t.pathOffset,o=t.pathLength;s<o;s++){var h=n[s],u=h.points,l=u.length,c=u[l-1],f=u[0];h.bevel=0;for(var d=0;d<l;d++){var v,p,_=c.dy,x=-c.dx,g=f.dy,y=-f.dx;if(f.dmx=.5*(_+g),f.dmy=.5*(x+y),(v=f.dmx*f.dmx+f.dmy*f.dmy)>1e-6){var m=1/v;m>600&&(m=600),f.dmx*=m,f.dmy*=m}f.dx*c.dy-c.dx*f.dy>0&&(f.flags|=rt.PT_LEFT),v*(p=kt(11,Nt(c.len,f.len)*i))*p<1&&(f.flags|=rt.PT_INNERBEVEL),f.flags&rt.PT_CORNER&&(v*a*a<1||r===$.BEVEL||r===$.ROUND)&&(f.flags|=rt.PT_BEVEL),0!=(f.flags&(rt.PT_BEVEL|rt.PT_INNERBEVEL))&&h.bevel++,c=f,f=u[d+1]}}},_flattenPaths:function(t){for(var e=t.paths,r=t.pathOffset,a=t.pathLength;r<a;r++){var i=e[r],n=i.points,s=n[n.length-1],o=n[0];n.length>2&&s.equals(o)&&(i.closed=!0,n.pop(),s=n[n.length-1]);for(var h=0,u=n.length;h<u;h++){var l=new et(o.x,o.y);l.subtract(s),s.len=l.length(),(l.x||l.y)&&l.normalize(),s.dx=l.x,s.dy=l.y,s=o,o=n[h+1]}}},_chooseBevel:function(t,e,r,a){var i=r.x,n=r.y,s=0,o=0,h=0,u=0;return 0!==t?(s=i+e.dy*a,o=n-e.dx*a,h=i+r.dy*a,u=n-r.dx*a):(s=h=i+r.dmx*a,o=u=n+r.dmy*a),[s,o,h,u]},_buttCapStart:function(t,e,r,a,i){var n=t.x-e*i,s=t.y-r*i,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_buttCapEnd:function(t,e,r,a,i){var n=t.x+e*i,s=t.y+r*i,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_roundCapStart:function(t,e,r,a,i){for(var n=t.x,s=t.y,o=r,h=-e,u=0;u<i;u++){var l=u/(i-1)*It,c=Ut(l)*a,f=Wt(l)*a;this._vSet(n-o*c-e*f,s-h*c-r*f,1),this._vSet(n,s,0)}this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_roundCapEnd:function(t,e,r,a,i){var n=t.x,s=t.y,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1);for(var u=0;u<i;u++){var l=u/(i-1)*It,c=Ut(l)*a,f=Wt(l)*a;this._vSet(n,s,0),this._vSet(n-o*c+e*f,s-h*c+r*f,1)}},_roundJoin:function(t,e,r,a,i){var n=t.dy,s=-t.dx,o=e.dy,h=-e.dx,u=e.x,l=e.y;if(0!=(e.flags&rt.PT_LEFT)){var c=this._chooseBevel(e.flags&rt.PT_INNERBEVEL,t,e,r),f=c[0],d=c[1],v=c[2],p=c[3],_=Zt(-s,-n),x=Zt(-h,-o);x>_&&(x-=2*It),this._vSet(f,d,1),this._vSet(u-n*a,e.y-s*a,-1);for(var g=Qt(zt((_-x)/It)*i,2,i),y=0;y<g;y++){var m=_+y/(g-1)*(x-_),S=u+Ut(m)*a,D=l+Wt(m)*a;this._vSet(u,l,0),this._vSet(S,D,-1)}this._vSet(v,p,1),this._vSet(u-o*a,l-h*a,-1)}else{var w=this._chooseBevel(e.flags&rt.PT_INNERBEVEL,t,e,-a),B=w[0],C=w[1],b=w[2],M=w[3],T=Zt(s,n),F=Zt(h,o);F<T&&(F+=2*It),this._vSet(u+n*a,l+s*a,1),this._vSet(B,C,-1);for(var L=Qt(zt((F-T)/It)*i,2,i),A=0;A<L;A++){var R=T+A/(L-1)*(F-T),E=u+Ut(R)*r,P=l+Wt(R)*r;this._vSet(E,P,1),this._vSet(u,l,0)}this._vSet(u+o*a,l+h*a,1),this._vSet(b,M,-1)}},_bevelJoin:function(t,e,r,a){var i=0,n=0,s=0,o=0,h=0,u=0,l=0,c=0,f=t.dy,d=-t.dx,v=e.dy,p=-e.dx;if(e.flags&rt.PT_LEFT){var _=this._chooseBevel(e.flags&rt.PT_INNERBEVEL,t,e,r);h=_[0],u=_[1],l=_[2],c=_[3],this._vSet(h,u,1),this._vSet(e.x-f*a,e.y-d*a,-1),this._vSet(l,c,1),this._vSet(e.x-v*a,e.y-p*a,-1)}else{var x=this._chooseBevel(e.flags&rt.PT_INNERBEVEL,t,e,-a);i=x[0],n=x[1],s=x[2],o=x[3],this._vSet(e.x+f*r,e.y+d*r,1),this._vSet(i,n,-1),this._vSet(e.x+v*r,e.y+p*r,1),this._vSet(s,o,-1)}},_vSet:function(t,e,r){if(void 0===r&&(r=0),qt){var i=qt,n=8*i.vertexStart,s=i.vData;s[n++]=t,s[n++]=e,s[n++]=0,a.toArray(s,Xt,n),n+=4,s[n++]=r,i.vertexStart++}}},Jt=t("g",{getAssembler:function(){return Yt}});at.Assembler=Jt;var $t=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},te=new i,ee=null,re=null,ae=[],ie=[],ne=[],se=[],oe=new n,he=new n,ue=new s,le=null,ce=0,fe=0,de=0,ve=0,pe=0,_e=1,xe=null,ge="",ye=0,me=0,Se=0,De=0,we=0,Be=0,Ce=0,be=!1,Me=0,Te=0,Fe=0,Le={updateRenderData:function(t){t.renderData&&t.renderData.vertDirty&&ee!==t&&(re=(ee=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),ee.actualFontSize=ye,re.setContentSize(he),ee.renderData.vertDirty=ee.renderData.uvDirty=!1,ee.markForUpdateRenderData(!1),ee=null,this._resetProperties())},_updateFontScale:function(){_e=ye/me},_updateFontFamily:function(t){var e=t.font;xe=e.spriteFrame,le=e.fntConfig,O.fontAtlas=e.fontDefDictionary,E.packToDynamicAtlas(t,xe)},_updateLabelInfo:function(){O.hash="",O.margin=0},_updateProperties:function(t){ge=t.string.toString(),ye=t.fontSize,me=le?le.fontSize:t.fontSize,Se=t.horizontalAlign,De=t.verticalAlign,we=t.spacingX,Ce=t.overflow,Be=t._lineHeight;var e=re.contentSize;he.width=e.width,he.height=e.height,Ce===H.NONE?(be=!1,he.width+=2*O.margin,he.height+=2*O.margin):Ce===H.RESIZE_HEIGHT?(be=!0,he.height+=2*O.margin):be=t.enableWrapText,O.lineHeight=Be,O.fontSize=ye,this._setupBMFontOverflowMetrics()},_resetProperties:function(){le=null,xe=null,O.hash="",O.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=ge,e=t.length,r=le.kerningDict,a=ae,i=-1,n=0;n<e;++n){var s=t.charCodeAt(n),o=r[i<<16|65535&s]||0;a[n]=n<e-1?o:0,i=s}},_multilineTextWrap:function(t){for(var e=ge.length,r=0,a=0,i=0,n=0,s=0,o=0,h=0,u=null,l=0;l<e;){var c=ge.charAt(l);if("\n"!==c){for(var f=t(ge,l,e),d=o,v=h,p=s,_=a,x=!1,g=0;g<f;++g){var y=l+g;if("\r"!==(c=ge.charAt(y)))if(u=O.fontAtlas.getLetterDefinitionForChar(c,O)){var m=_+u.offsetX*_e-O.margin;if(be&&Fe>0&&a>0&&m+u.w*_e>Fe&&!I(c)){ne.push(s),s=0,r++,a=0,i-=Be*this._getFontScale()+0,x=!0;break}ue.x=m,ue.y=i-u.offsetY*_e,this._recordLetterInfo(ue,c,y,r),y+1<ae.length&&y<e-1&&(_+=ae[y+1]),_+=u.xAdvance*_e+we,p=ue.x+u.w*_e,d<ue.y&&(d=ue.y),v>ue.y-u.h*_e&&(v=ue.y-u.h*_e)}else this._recordPlaceholderInfo(y,c),console.log("Can't find letter definition in texture atlas "+le.atlasName+" for letter:"+c);else this._recordPlaceholderInfo(y,c)}x||(a=_,o<d&&(o=d),h>v&&(h=v),n<(s=p)&&(n=s),l+=f)}else ne.push(s),s=0,r++,a=0,i-=Be*this._getFontScale()+0,this._recordPlaceholderInfo(l,c),l++}return ne.push(s),fe=(ce=r+1)*Be*this._getFontScale(),ce>1&&(fe+=0*(ce-1)),he.width=Me,he.height=Te,Me<=0&&(he.width=parseFloat(n.toFixed(2))+2*O.margin),Te<=0&&(he.height=parseFloat(fe.toFixed(2))+2*O.margin),ve=he.height,pe=0,o>0&&(ve=he.height+o),h<-fe&&(pe=fe+h),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return Ce===H.SHRINK?_e:1},_getFirstWordLen:function(t,e,r){var a=t.charAt(e);if(N(a)||"\n"===a||I(a))return 1;var i=1,n=O.fontAtlas.getLetterDefinitionForChar(a,O);if(!n)return i;for(var s=n.xAdvance*_e+we,o=e+1;o<r&&(a=t.charAt(o),n=O.fontAtlas.getLetterDefinitionForChar(a,O));++o){if(s+n.offsetX*_e+n.w*_e>Fe&&!I(a)&&Fe>0)return i;if(s+=n.xAdvance*_e+we,"\n"===a||I(a)||N(a))break;i++}return i},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=ie.length){var r=new $t;ie.push(r)}ie[t].char=e,ie[t].hash=e.charCodeAt(0)+O.hash,ie[t].valid=!1},_recordLetterInfo:function(t,e,r,a){if(r>=ie.length){var i=new $t;ie.push(i)}var n=e.charCodeAt(0)+O.hash;ie[r].line=a,ie[r].char=e,ie[r].hash=n,ie[r].valid=O.fontAtlas.getLetter(n).valid,ie[r].x=t.x,ie[r].y=t.y},_alignText:function(){fe=0,ne.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),Ce===H.SHRINK&&ye>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||Ce===H.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),ye=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,r=0|ye,a=0;e<r;){var i=a=e+r+1>>1;if(i<=0)break;_e=i/me,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?r=a-1:e=a}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return fe>he.height},_isHorizontalClamp:function(){for(var t=!1,e=0,r=ge.length;e<r;++e){var a=ie[e];if(a.valid){var i=O.fontAtlas.getLetterDefinitionForChar(a.char,O);if(!i)continue;var n=a.x+i.w/2*_e,s=a.line;if(Me>0)if(be){if(ne[s]>he.width&&(n>he.width||n<0)){t=!0;break}}else if(n>he.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var r=ne[e],a=t>he.width||t<0;return be?r>he.width&&a:a},_updateQuads:function(){if(!ee)return!1;var t=xe?xe.texture:O.fontAtlas.getTexture(),e=ee.renderData;e.dataLength=e.vertexCount=e.indicesCount=0;for(var r=re.anchorPoint,a=he,i=r.x*a.width,n=r.y*a.height,s=!0,o=0,h=ge.length;o<h;++o){var u=ie[o];if(u.valid){var l=O.fontAtlas.getLetter(u.hash);if(l){te.height=l.h,te.width=l.w,te.x=l.u,te.y=l.v;var c=u.y+de;if(Te>0){if(c>ve){var f=c-ve;te.y+=f,te.height-=f,c-=f}c-l.h*_e<pe&&Ce===H.CLAMP&&(te.height=c<pe?0:(c-pe)/_e)}var d=u.line,v=u.x+l.w/2*_e+se[d];if(Me>0&&this._isHorizontalClamped(v,d))if(Ce===H.CLAMP)te.width=0;else if(Ce===H.SHRINK){if(he.width>l.w){s=!1;break}te.width=0}if(te.height>0&&te.width>0){var p=this._determineRect(),_=u.x+se[u.line];this.appendQuad(ee,t,te,p,_-i,c-n,_e)}}else console.warn("Can't find letter in this bitmap-font")}}return s},appendQuad:function(){},_determineRect:function(){var t=xe.isRotated(),e=xe.getOriginalSize(),r=xe.getRect(),a=xe.getOffset(),i=a.x+(e.width-r.width)/2,n=a.y-(e.height-r.height)/2;if(t){var s=te.x;te.x=r.x+r.height-te.y-te.height-n,te.y=s+r.y-i,te.y<0&&(te.height+=n)}else te.x+=r.x-i,te.y+=r.y+n;return t},_computeAlignmentOffset:function(){switch(se.length=0,Se){case k.LEFT:for(var t=0;t<ce;++t)se.push(0);break;case k.CENTER:for(var e=0,r=ne.length;e<r;e++)se.push((he.width-ne[e])/2);break;case k.RIGHT:for(var a=0,i=ne.length;a<i;a++)se.push(he.width-ne[a])}if(de=he.height,De!==z.TOP){var n=he.height-fe+Be*this._getFontScale()-me*_e;De===z.BOTTOM?de-=n:de-=n/2}},_setupBMFontOverflowMetrics:function(){var t=he.width,e=he.height;Ce===H.RESIZE_HEIGHT&&(e=0),Ce===H.NONE&&(t=0,e=0),Me=t,Te=e,oe.width=t,oe.height=e,Fe=t}},Ae=new a(255,255,255,255),Re={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){var r=t.node;t._setCacheAlpha(r._uiProps.opacity),Ae.set(t.color),Ae.a=255*r._uiProps.opacity,vt(r,e,t.renderData,Ae)},appendQuad:function(t,e,r,a,i,n,s){var o=t.renderData;if(o){var h=o.dataLength;o.dataLength+=4,o.vertexCount=o.dataLength,o.indicesCount=o.dataLength/2*3;var u=o.data,l=e.width,c=e.height,f=r.width,d=r.height,v=0,p=0,_=0,x=0;a?(v=r.x/l,x=(r.x+d)/l,p=(r.y+f)/c,_=r.y/c,u[h].u=v,u[h].v=_,u[h+1].u=v,u[h+1].v=p,u[h+2].u=x,u[h+2].v=_,u[h+3].u=x,u[h+3].v=p):(v=r.x/l,x=(r.x+f)/l,p=(r.y+d)/c,_=r.y/c,u[h].u=v,u[h].v=p,u[h+1].u=x,u[h+1].v=p,u[h+2].u=v,u[h+2].v=_,u[h+3].u=x,u[h+3].v=_),u[h].x=i,u[h].y=n-d*s,u[h+1].x=i+f*s,u[h+1].y=n-d*s,u[h+2].x=i,u[h+2].y=n,u[h+3].x=i+f*s,u[h+3].y=n}}};o(Re,Le);var Ee=null,Pe=h(Le,{getAssemblerData:function(){return Ee||(Ee=new V(1024,1024)),Ee.getTexture()},_updateFontFamily:function(t){O.fontAtlas=Ee,O.fontFamily=this._getFontFamily(t);var e=t.getComponent(st);e&&e.enabled?(O.isOutlined=!0,O.margin=e.width,O.out=e.color.clone(),O.out.a=e.color.a*t.color.a/255):(O.isOutlined=!1,O.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(t.font._nativeAsset?e=t.font._nativeAsset:L.postLoadNative(t.font,(function(){t.isValid&&(e=t.font._nativeAsset||"Arial",t.updateRenderData(!0))}))),e},_updateLabelInfo:function(t){O.fontDesc=this._getFontDesc(),O.color=t.color,O.hash=U(O)},_getFontDesc:function(){return O.fontSize.toString()+"px "+O.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),Oe=new a(255,255,255,255),He={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){if(t.renderData){var r=t.node;t._setCacheAlpha(r._uiProps.opacity),Oe.a=255*r._uiProps.opacity,vt(r,e,t.renderData,Oe)}},appendQuad:Re.appendQuad};o(He,Pe);var Ie=W.Overflow,Ne=X(),ke=(1/255).toFixed(3),ze=null,Ve=null,Ue=null,We="",Ze="",qe=0,Ge=0,Xe=[],je=new n,Ke=0,Qe=0,Ye=0,Je=new a,$e=1,tr="",er=Ie.NONE,rr=!1,ar=null,ir=a.BLACK.clone(),nr=null,sr=a.BLACK.clone(),or=new i,hr=n.ZERO.clone(),ur=n.ZERO.clone(),lr=s.ZERO.clone(),cr=s.ZERO.clone(),fr=0,dr=0,vr=!1,pr=!1,_r=!1,xr=["left","center","right"],gr={getAssemblerData:function(){return W._canvasPool.get()},resetAssemblerData:function(t){t&&W._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData&&t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._resetDynamicAtlas(t),this._updateTexture(t),this.updateOpacity(t),t._setCacheAlpha($e),this._calDynamicAtlas(t),t.actualFontSize=qe,e.setContentSize(je),this.updateVertexData(t),this.updateUvs(t),t.markForUpdateRenderData(!1),ze=null,Ve=null,Ue=null}},updateVertexData:function(){},updateUvs:function(){},updateOpacity:function(t){for(var e=t.renderData.vData,r=5,a=t.node._uiProps.opacity,i=0;i<4;i++)e[r+3]=a,r+=9},_updateFontFamily:function(t){t.useSystemFont?tr=t.fontFamily||"Arial":t.font?t.font._nativeAsset?tr=t.font._nativeAsset:(L.postLoadNative(t.font,(function(){t.isValid&&(tr=t.font._nativeAsset||"Arial",t.updateRenderData(!0))})),tr="Arial"):tr="Arial"},_updateProperties:function(t,e){var r=t.assemblerData;r&&(ze=r.context,Ve=r.canvas,Ue=t.spriteFrame,Ze=t.string.toString(),qe=t.fontSize,Ge=qe,er=t.overflow,ur.width=je.width=e.width,ur.height=je.height=e.height,dr=t.underlineHeight,Ke=t.lineHeight,Qe=t.horizontalAlign,Ye=t.verticalAlign,Je=t.color,$e=t.node._uiProps.opacity,vr=t.isBold,pr=t.isItalic,_r=t.isUnderline,rr=er!==Ie.NONE&&(er===Ie.RESIZE_HEIGHT||t.enableWrapText),(ar=(ar=st&&t.getComponent(st))&&ar.enabled&&ar.width>0?ar:null)&&ir.set(ar.color),(nr=(nr=ot&&t.getComponent(ot))&&nr.enabled?nr:null)&&sr.set(nr.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,r=0,a=0,i=0;if(hr.width=hr.height=0,ar&&(t=e=r=a=i=ar.width,hr.width=hr.height=2*i),nr){var n=nr.blur+i,s=nr.offset.x,o=nr.offset.y;r=Math.max(r,-s+n),a=Math.max(a,s+n),t=Math.max(t,o+n),e=Math.max(e,-o+n)}if(pr){var h=Ge*Math.tan(.20943951);a+=h,hr.width+=h}or.x=r,or.y=t,or.width=r+a,or.height=t+e},_calculateFillTextStartPosition:function(){var t=0;Qe===k.RIGHT?t=je.width-or.width:Qe===k.CENTER&&(t=(je.width-or.width)/2);var e=this._getLineHeight()*(Xe.length-1),r=qe*(1-G/2);if(Ye!==z.TOP){var a=e+or.height+qe-je.height;Ye===z.BOTTOM?r-=a+=G/2*qe:r-=a/2}r+=Ne*qe,lr.set(t+or.x,r+or.y)},_updateTexture:function(t){if(ze&&Ve){ze.clearRect(0,0,Ve.width,Ve.height),ze.font=We,this._calculateFillTextStartPosition();var e=this._getLineHeight();ze.lineJoin="round",t._srcBlendFactor===u.SRC_ALPHA&&(ze.fillStyle="rgba("+Je.r+", "+Je.g+", "+Je.b+", "+ke+")",ze.fillRect(0,0,Ve.width,Ve.height)),ze.fillStyle="rgb("+Je.r+", "+Je.g+", "+Je.b+")";var r,a=lr.x,n=0;this._drawTextEffect(lr,e);for(var s=0;s<Xe.length;++s)n=lr.y+s*e,ar&&ze.strokeText(Xe[s],a,n),ze.fillText(Xe[s],a,n);nr&&(ze.shadowColor="transparent"),Ue&&(r=Ue instanceof P?Ue.texture:Ue,0!==Ve.width&&0!==Ve.height&&(r.reset({width:Ve.width,height:Ve.height,mipmapLevel:1}),r.uploadData(Ve),Ue instanceof P&&(Ue.rect=new i(0,0,Ve.width,Ve.height),Ue._calculateUV()),l.director.root&&l.director.root.batcher2D&&l.director.root.batcher2D._releaseDescriptorSetCache(r.getHash())))}},_resetDynamicAtlas:function(t){if(t.cacheMode===W.CacheMode.BITMAP){var e=t.ttfSpriteFrame;E.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}},_calDynamicAtlas:function(t){if(t.cacheMode===W.CacheMode.BITMAP){var e=t.ttfSpriteFrame;E.packToDynamicAtlas(t,e),t.renderData.uvDirty=!0}},_setupOutline:function(){ze.strokeStyle="rgba("+ir.r+", "+ir.g+", "+ir.b+", "+ir.a/255+")",ze.lineWidth=2*ar.width},_setupShadow:function(){ze.shadowColor="rgba("+sr.r+", "+sr.g+", "+sr.b+", "+sr.a/255+")",ze.shadowBlur=nr.blur,ze.shadowOffsetX=nr.offset.x,ze.shadowOffsetY=-nr.offset.y},_drawTextEffect:function(t,e){if(nr||ar||_r){var r=Xe.length>1&&nr,a=this._measureText(ze,We),i=0,n=0;nr&&this._setupShadow(),ar&&this._setupOutline();for(var s=0;s<Xe.length;++s)i=t.x,n=t.y+s*e,r&&(ar&&ze.strokeText(Xe[s],i,n),ze.fillText(Xe[s],i,n)),_r&&(fr=a(Xe[s]),Qe===k.RIGHT?cr.x=t.x-fr:Qe===k.CENTER?cr.x=t.x-fr/2:cr.x=t.x,cr.y=n+Ge/8,ze.fillRect(cr.x,cr.y,fr,dr));r&&(ze.shadowColor="transparent")}},_updateLabelDimensions:function(){je.width=Math.min(je.width,2048),je.height=Math.min(je.height,2048);var t=!1;Ve.width!==je.width&&(Ve.width=je.width,t=!0),Ve.height!==je.height&&(Ve.height=je.height,t=!0),t&&(ze.font=We),ze.textAlign=xr[Qe],ze.textBaseline="alphabetic"},_getFontDesc:function(){var t=qe.toString()+"px ";return t+=tr,vr&&(t="bold "+t),pr&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===Ke?qe:Ke*qe/Ge)},_calculateParagraphLength:function(t,e){for(var r,a=[],i=c(t);!(r=i()).done;){var n=r.value,s=Z(e,n,We);a.push(s)}return a},_measureText:function(t,e){return function(r){return Z(t,r,e)}},_calculateShrinkFont:function(t){if(ze){var e=this._calculateParagraphLength(t,ze),r=0,a=0,i=0;if(rr){var n=ur.width,s=ur.height;if(n<0||s<0)return;a=s+1;for(var o=0,h=0|qe+1,u=0;o<h;){if((u=o+h+1>>1)<=0){f(4003);break}qe=u,We=this._getFontDesc(),ze.font=We;var l=this._getLineHeight();for(a=0,r=0;r<t.length;++r){var c=Z(ze,t[r],We);a+=q(t[r],c,n,this._measureText(ze,We)).length*l}a>s?h=u-1:o=u}0===o?f(4003):(qe=o,We=this._getFontDesc(),ze.font=We)}else{for(a=t.length*this._getLineHeight(),r=0;r<t.length;++r)i<e[r]&&(i=e[r]);var d=(je.width-or.width)/i,v=je.height/a;qe=Ge*Math.min(1,d,v)|0,We=this._getFontDesc(),ze.font=We}}},_calculateWrapText:function(t){if(rr&&ze){Xe=[];for(var e=ur.width,r=0;r<t.length;++r){var a=Z(ze,t[r],We),i=q(t[r],a,e,this._measureText(ze,We));Xe=Xe.concat(i)}}},_calculateLabelFont:function(){if(ze){var t=Ze.split("\n");switch(Xe=t,We=this._getFontDesc(),ze.font=We,er){case Ie.NONE:for(var e=0,r=0,a=0;a<t.length;++a){var i=Z(ze,t[a],We);e=e>i?e:i}r=(Xe.length+G)*this._getLineHeight();var n=parseFloat(e.toFixed(2)),s=parseFloat(r.toFixed(2));je.width=n+or.width,je.height=s+or.height,ur.width=n+hr.width,ur.height=s+hr.height;break;case Ie.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case Ie.CLAMP:this._calculateWrapText(t);break;case Ie.RESIZE_HEIGHT:this._calculateWrapText(t);var o=(Xe.length+G)*this._getLineHeight();je.height=o+or.height,ur.height=o+hr.height}}}},yr=a.WHITE.clone(),mr={createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.vertexCount=4,e.indicesCount=6;var r=e.vData=new Float32Array(36);r[3]=r[21]=r[22]=r[31]=0,r[4]=r[12]=r[13]=r[30]=1;for(var i=5,n=0;n<4;n++)a.toArray(r,yr,i),i+=9;return e},fillBuffers:function(t,e){var r=t.renderData,a=r.data,i=t.node,n=e.acquireBufferBatch(),s=n.byteOffset>>2,o=n.indicesOffset,h=n.vertexOffset;n.request()||(n=e.currBufferBatch,o=0,h=0,s=0);var u=n.vData,l=n.iData,c=r.vData,f=a[0],d=a[3];i.updateWorldTransform();var v=i._pos,p=i._rot,_=i._scale,x=f.x*_.x,g=d.x*_.x,y=f.y*_.y,m=d.y*_.y,S=p.x,D=p.y,w=p.z,B=p.w,C=S*D,b=w*B,M=S*S-D*D,T=B*B-w*w,F=T+M,L=2*(C-b),A=T-M,R=2*(C+b),E=v.x,P=v.y;c[0]=F*x+L*y+E,c[1]=A*y+R*x+P,c[9]=F*g+L*y+E,c[10]=A*y+R*g+P,c[18]=F*x+L*m+E,c[19]=A*m+R*x+P,c[27]=F*g+L*m+E,c[28]=A*m+R*g+P,u.set(c,s),l[o++]=h,l[o++]=h+1,l[o++]=h+2,l[o++]=h+2,l[o++]=h+1,l[o++]=h+3},updateVertexData:function(t){var e=t.renderData;if(e){var r=t.node._uiProps.uiTransformComp,a=r.width,i=r.height,n=r.anchorX*a,s=r.anchorY*i,o=e.data;o[0].x=-n,o[0].y=-s,o[3].x=a-n,o[3].y=i-s}},updateUvs:function(t){var e=t.renderData;if(e){var r=e.vData;if(r&&e.uvDirty){var a=t.ttfSpriteFrame.uv;r[3]=a[0],r[4]=a[1],r[12]=a[2],r[13]=a[3],r[21]=a[4],r[22]=a[5],r[30]=a[6],r[31]=a[7],e.uvDirty=!1}}}};o(mr,gr);var Sr=t("l",{getAssembler:function(t){var e=mr;return t.font instanceof j?e=Re:t.cacheMode===W.CacheMode.CHAR&&(e=He),e}});W.Assembler=Sr;var Dr=K.FillType,wr=new r,Br=new a(255,255,255,255),Cr={useModel:!1,updateRenderData:function(t){var e=t.spriteFrame;E.packToDynamicAtlas(t,e);var r=t.renderData;if(r&&e){var a=r.uvDirty,i=r.vertDirty;if(!a&&!i)return;var n=t.fillStart,s=t.fillRange;s<0&&(n+=s,s=-s),s=(s=(s=n+s)>1?1:s)<0?0:s;var o=(n=(n=n>1?1:n)<0?0:n)+(s=(s-=n)<0?0:s);o=o>1?1:o,a&&this.updateUVs(t,n,o),i&&(this.updateVertexData&&this.updateVertexData(t,n,o),this.updateWorldVertexData(t))}},updateUVs:function(t,e,r){var a=t.spriteFrame,i=t.renderData,n=i.data,s=a.width,o=a.height,h=a.getRect(),u=0,l=0,c=0,f=0,v=0,p=0,_=0,x=0,g=0,y=0;switch(a.isRotated()?(u=h.x/s,l=(h.y+h.width)/o,c=v=u,_=g=(h.x+h.height)/s,p=y=l,f=x=h.y/o):(u=h.x/s,l=(h.y+h.height)/o,c=_=u,v=g=(h.x+h.width)/s,f=p=l,x=y=h.y/o),t.fillType){case Dr.HORIZONTAL:n[0].u=c+(v-c)*e,n[0].v=f+(p-f)*e,n[1].u=c+(v-c)*r,n[1].v=f+(p-f)*r,n[2].u=_+(g-_)*e,n[2].v=x+(y-x)*e,n[3].u=_+(g-_)*r,n[3].v=x+(y-x)*r;break;case Dr.VERTICAL:n[0].u=c+(_-c)*e,n[0].v=f+(x-f)*e,n[1].u=v+(g-v)*e,n[1].v=p+(y-p)*e,n[2].u=c+(_-c)*r,n[2].v=f+(x-f)*r,n[3].u=v+(g-v)*r,n[3].v=p+(y-p)*r;break;default:d(2626)}i.uvDirty=!1},updateVertexData:function(t,e,r){var a=t.renderData,i=a.data,n=t.node._uiProps.uiTransformComp,s=n.width,o=n.height,h=n.anchorX*s,u=n.anchorY*o,l=-h,c=-u,f=s-h,v=o-u,p=0;switch(t.fillType){case Dr.HORIZONTAL:p=l+(f-l)*r,l+=(f-l)*e,f=p;break;case Dr.VERTICAL:p=c+(v-c)*r,c+=(v-c)*e,v=p;break;default:d(2626)}i[4].x=l,i[4].y=c,i[5].x=f,i[5].y=c,i[6].x=l,i[6].y=v,i[7].x=f,i[7].y=v,a.vertDirty=!1},createData:function(t){var e=t.requestRenderData();e.dataLength=8,e.vertexCount=4,e.indicesCount=6;for(var r,a=e.data,i=c(a);!(r=i()).done;)r.value.z=0;return e},updateWorldVertexData:function(t){var r=t.node,a=t.renderData.data;r.getWorldMatrix(wr);for(var i=0;i<4;i++){var n=a[i+4],s=a[i];e.transformMat4(s,n,wr)}},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var r=t.node;Br.set(t.color),Br.a=255*r._uiProps.opacity,function(t,e,r,i){var n=r.data,s=e.acquireBufferBatch(),o=s.byteOffset>>2,h=r.vertexCount,u=s.indicesOffset,l=s.vertexOffset;s.request(h,r.indicesCount)||(s=e.currBufferBatch,h=0,u=0,l=0);for(var c=s.vData,f=0;f<h;f++){var d=n[f];c[o++]=d.x,c[o++]=d.y,c[o++]=d.z,c[o++]=d.u,c[o++]=d.v,a.toArray(c,i,o),o+=4}var v=s.iData;v[u++]=l,v[u++]=l+1,v[u++]=l+2,v[u++]=l+1,v[u++]=l+3,v[u++]=l+2}(0,e,t.renderData,Br)},updateColor:function(){}},br=2*Math.PI,Mr=1e-6,Tr=new a(255,255,255,255),Fr=[new s,new s,new s,new s],Lr=new Array(4),Ar=new Array(8),Rr=[new s,new s,new s,new s],Er=[new s,new s,new s,new s],Pr=new s,Or=[new s,new s,new s,new s];function Hr(t,e,r,a,i,n,s){var o=Math.sin(n);o=Math.abs(o)>Mr?o:0;var h=Math.cos(n),u=0,l=0;if(0!==(h=Math.abs(h)>Mr?h:0)){if(u=o/h,(t-i.x)*h>0){var c=i.y+u*(t-i.x);s[0].x=t,s[0].y=c}if((e-i.x)*h>0){var f=i.y+u*(e-i.x);s[2].x=e,s[2].y=f}}if(0!==o){if(l=h/o,(a-i.y)*o>0){var d=i.x+l*(a-i.y);s[3].x=d,s[3].y=a}if((r-i.y)*o>0){var v=i.x+l*(r-i.y);s[1].x=v,s[1].y=r}}}function Ir(t,e){var r=e.x-t.x,a=e.y-t.y;if(0===r&&0===a)return 0;if(0===r)return a>0?.5*Math.PI:1.5*Math.PI;var i=Math.atan(a/r);return r<0&&(i+=Math.PI),i}function Nr(t,e,r,a,i){var n=Lr,s=n[0],o=n[1],h=n[2],u=n[3];t[e].x=r.x,t[e].y=r.y,t[e+1].x=a.x,t[e+1].y=a.y,t[e+2].x=i.x,t[e+2].y=i.y,kr((r.x-s)/(h-s),(r.y-o)/(u-o),t,e),kr((a.x-s)/(h-s),(a.y-o)/(u-o),t,e+1),kr((i.x-s)/(h-s),(i.y-o)/(u-o),t,e+2)}function kr(t,e,r,a){var i=Ar,n=i[0]+(i[2]-i[0])*t,s=i[4]+(i[6]-i[4])*t,o=i[1]+(i[3]-i[1])*t,h=i[5]+(i[7]-i[5])*t,u=r[a];u.u=n+(s-n)*e,u.v=o+(h-o)*e}for(var zr={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;E.packToDynamicAtlas(t,e);var r,a,i,n,o,h,u,l,f,d=t.renderData;if(d&&e&&(d.vertDirty||d.uvDirty)){var v=d.data,p=t.fillStart,_=t.fillRange;for(_<0&&(p+=_,_=-_);p>=1;)p-=1;for(;p<0;)p+=1;var x=(p*=br)+(_*=br);!function(t){var e=t.node._uiProps.uiTransformComp,r=e.width,a=e.height,i=e.anchorX*r,n=e.anchorY*a,o=-i,h=-n,u=r-i,l=a-n,f=Lr;f[0]=o,f[1]=h,f[2]=u,f[3]=l;var d=t.fillCenter,v=Pr.x=Math.min(Math.max(0,d.x),1)*(u-o)+o,p=Pr.y=Math.min(Math.max(0,d.y),1)*(l-h)+h;Fr[0].x=Fr[3].x=o,Fr[1].x=Fr[2].x=u,Fr[0].y=Fr[1].y=h,Fr[2].y=Fr[3].y=l;for(var _,x=c(Or);!(_=x()).done;){var g=_.value;s.set(g,0,0)}v!==f[0]&&s.set(Or[0],3,0),v!==f[2]&&s.set(Or[2],1,2),p!==f[1]&&s.set(Or[1],0,1),p!==f[3]&&s.set(Or[3],2,3)}(t),a=(r=e).width,i=r.height,n=r.getRect(),o=0,h=0,u=0,l=0,f=Ar,r.isRotated()?(o=n.x/a,h=(n.x+n.height)/a,u=n.y/i,l=(n.y+n.width)/i,f[0]=f[2]=o,f[4]=f[6]=h,f[3]=f[7]=l,f[1]=f[5]=u):(o=n.x/a,h=(n.x+n.width)/a,u=n.y/i,l=(n.y+n.height)/i,f[0]=f[4]=o,f[2]=f[6]=h,f[1]=f[3]=l,f[5]=f[7]=u),Hr(Lr[0],Lr[2],Lr[1],Lr[3],Pr,p,Rr),Hr(Lr[0],Lr[2],Lr[1],Lr[3],Pr,p+_,Er);for(var g=0,y=0;y<4;++y){var m=Or[y];if(m)if(_>=br)d.dataLength=g+3,Nr(v,g,Pr,Fr[m.x],Fr[m.y]),g+=3;else{var S=Ir(Pr,Fr[m.x]),D=Ir(Pr,Fr[m.y]);D<S&&(D+=br),S-=br,D-=br;for(var w=0;w<3;++w)S>=x||(S>=p?(d.dataLength=g+3,Nr(v,g,Pr,Fr[m.x],D>=x?Er[y]:Fr[m.y]),g+=3):D>p&&(D<=x?(d.dataLength=g+3,Nr(v,g,Pr,Rr[y],Fr[m.y]),g+=3):(d.dataLength=g+3,Nr(v,g,Pr,Rr[y],Er[y]),g+=3))),S+=br,D+=br}}d.indicesCount=d.vertexCount=g,d.vertDirty=d.uvDirty=!1}},fillBuffers:function(t,r){var i=t.node,n=t.renderData;Tr.set(t.color),Tr.a=255*i._uiProps.opacity,function(t,r,i,n){var s=i.data,o=r.acquireBufferBatch(),h=o.byteOffset>>2,u=i.vertexCount,l=o.indicesOffset,c=o.vertexOffset;o.request(u,i.indicesCount)||(o=r.currBufferBatch,u=0,l=0,c=0);var f=o.vData;t.getWorldMatrix(dt);for(var d=0;d<u;d++){var v=s[d];e.set(ft,v.x,v.y,0),e.transformMat4(ft,ft,dt),f[h++]=ft.x,f[h++]=ft.y,f[h++]=ft.z,f[h++]=v.u,f[h++]=v.v,a.toArray(f,n,h),h+=4}for(var p=o.iData,_=0;_<i.dataLength;_++)p[l+_]=c+_}(i,r,n,Tr)},updateColor:function(){}},Vr=[],Ur=0;Ur<4;Ur++)Vr.push(new e);for(var Wr={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){var e=t.spriteFrame;E.packToDynamicAtlas(t,e);var r=t.renderData;r&&e&&(r.vertDirty&&this.updateVertexData(t),r.uvDirty&&this.updateUvs(t))},updateWorldVerts:function(t,e){var r=t.renderData.data,a=t.node,i=r[0],n=r[3],s=a.worldMatrix,o=s.m00,h=s.m01,u=s.m04,l=s.m05,c=1===o&&0===h&&0===u&&1===l,f=s.m12,d=s.m13,v=i.x,p=n.x,_=i.y,x=n.y;if(c){var g=v+f,y=p+f,m=_+d,S=x+d;e[0]=g,e[1]=m,e[9]=y,e[10]=m,e[18]=g,e[19]=S,e[27]=y,e[28]=S}else{var D=o*v,w=o*p,B=h*v,C=h*p,b=u*_+f,M=u*x+f,T=l*_+d,F=l*x+d;e[0]=D+b,e[1]=B+T,e[9]=w+b,e[10]=C+T,e[18]=D+M,e[19]=B+F,e[27]=w+M,e[28]=C+F}a._uiProps.uiTransformDirty=!1},fillBuffers:function(t,e){if(null!==t){var r=t.renderData.vData;t.node._uiProps.uiTransformDirty&&this.updateWorldVerts(t,r);var a=e.acquireBufferBatch(),i=a.byteOffset>>2,n=a.indicesOffset,s=a.vertexOffset;a.request()||(a=e.currBufferBatch,i=0,n=0,s=0);var o=a.vData,h=a.iData;o.set(r,i);var u=s,l=s+1,c=s+2,f=s+3;h[n++]=u,h[n++]=l,h[n++]=c,h[n++]=c,h[n++]=l,h[n++]=f}},updateVertexData:function(t){var e=t.renderData;if(e){var r=t.node._uiProps.uiTransformComp,a=e.data,i=r.width,n=r.height,s=r.anchorX*i,o=r.anchorY*n,h=0,u=0,l=0,c=0;if(t.trim)h=-s,u=-o,l=i-s,c=n-o;else{var f=t.spriteFrame,d=f.getOriginalSize(),v=f.getRect(),p=d.width,_=d.height,x=v.width,g=v.height,y=f.getOffset(),m=i/p,S=n/_,D=y.x+(p-x)/2,w=y.x-(p-x)/2;h=D*m-s,u=(y.y+(_-g)/2)*S-o,l=i+w*m-s,c=n+(y.y-(_-g)/2)*S-o}a[0].x=h,a[0].y=u,a[3].x=l,a[3].y=c,e.vertDirty=!1,this.updateWorldVerts(t,e.vData)}},updateUvs:function(t){var e=t.renderData,r=e.vData,a=t.spriteFrame.uv;r[3]=a[0],r[4]=a[1],r[12]=a[2],r[13]=a[3],r[21]=a[4],r[22]=a[5],r[30]=a[6],r[31]=a[7],e.uvDirty=!1},updateColor:function(t){for(var e=t.renderData.vData,r=5,a=t.color,i=a.r/255,n=a.g/255,s=a.b/255,o=t.node._uiProps.opacity,h=0;h<4;h++)e[r]=i,e[r+1]=n,e[r+2]=s,e[r+3]=o,r+=9}},Zr=new e,qr=new r,Gr={useModel:!1,createData:function(t){var e=t.requestRenderData();return e.dataLength=20,e.vertexCount=16,e.indicesCount=54,e},updateRenderData:function(t){var e=t.spriteFrame;E.packToDynamicAtlas(t,e);var r=t.renderData;r&&e&&r.vertDirty&&(this.updateVertexData(t),this.updateWorldVertexData(t))},updateVertexData:function(t){var e=t.renderData,r=e.data,a=t.node._uiProps.uiTransformComp,i=a.width,n=a.height,s=a.anchorX*i,o=a.anchorY*n,h=t.spriteFrame,u=h.insetLeft,l=h.insetRight,c=h.insetTop,f=h.insetBottom,d=i-u-l,v=n-c-f,p=i/(u+l),_=n/(c+f);p=Number.isNaN(p)||p>1?1:p,_=Number.isNaN(_)||_>1?1:_,d=d<0?0:d,v=v<0?0:v,r[0].x=-s,r[0].y=-o,r[1].x=u*p-s,r[1].y=f*_-o,r[2].x=r[1].x+d,r[2].y=r[1].y+v,r[3].x=i-s,r[3].y=n-o,e.vertDirty=!1},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var r=e.acquireBufferBatch(),i=t.renderData,n=i.data,s=r.byteOffset>>2,o=i.vertexCount,h=r.indicesOffset,u=r.vertexOffset,l=t.spriteFrame.uvSliced;r.request(o,i.indicesCount)||(r=e.currBufferBatch,s=0,h=0,u=0);for(var c=r.vData,f=r.iData,d=4;d<20;++d){var v=n[d],p=l[d-4];c[s++]=v.x,c[s++]=v.y,c[s++]=v.z,c[s++]=p.u,c[s++]=p.v,a.toArray(c,n[d].color,s),s+=4}for(var _=0;_<3;++_)for(var x=0;x<3;++x){var g=u+4*_+x;f[h++]=g,f[h++]=g+1,f[h++]=g+4,f[h++]=g+1,f[h++]=g+5,f[h++]=g+4}},updateWorldVertexData:function(t){var r=t.node,a=t.renderData.data;r.getWorldMatrix(qr);for(var i=0;i<4;++i)for(var n=a[i],s=0;s<4;++s){var o=a[s],h=a[4+4*i+s];e.set(Zr,o.x,n.y,0),e.transformMat4(h,Zr,qr)}},updateColor:function(t){for(var e=t.renderData.data,r=t.color,a=r.r,i=r.g,n=r.b,s=255*t.node._uiProps.opacity,o=4;o<20;o++)e[o].color.r=a,e[o].color.g=i,e[o].color.b=n,e[o].color.a=s}},Xr=[],jr=0;jr<4;jr++)Xr.push(new e);var Kr={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,r=t.spriteFrame;if(r&&e&&(e.uvDirty||e.vertDirty)){var a=t.node._uiProps.uiTransformComp,i=Math.abs(a.width),n=Math.abs(a.height),s=r.getRect(),o=r.insetLeft,h=r.insetRight,u=s.width-o-h,l=r.insetTop,c=r.insetBottom,f=s.height-l-c,d=i-o-h,v=n-l-c;d=d>0?d:0,v=v>0?v:0;var p=0===u?d:d/u,_=0===f?v:v/f,x=Math.ceil(_+2),g=Math.ceil(p+2);e.dataLength=Math.max(8,x+1,g+1),this.updateVerts(t,d,v,x,g),e.vertexCount=x*g*4,e.indicesCount=x*g*6,e.uvDirty=!1,e.vertDirty=!1,this.updateColor(t)}},fillBuffers:function(t,e){var r=t.node,i=t.node._uiProps.uiTransformComp,n=Math.abs(i.width),s=Math.abs(i.height),o=t.renderData,h=e.acquireBufferBatch(),u=h.indicesOffset,l=h.byteOffset>>2,c=h.vertexOffset,f=o.vertexCount,d=o.indicesCount,v=h.vData,p=h.iData;h.request(f,d)||(h=e.currBufferBatch,l=0,u=0,c=0);var _=t.spriteFrame,x=_.isRotated(),g=_.uv,y=t.spriteFrame.uvSliced,m=_.getRect(),S=_.insetLeft,D=_.insetRight,w=m.width-S-D,B=_.insetTop,C=_.insetBottom,b=m.height-B-C,M=n-S-D,T=s-B-C;M=M>0?M:0,T=T>0?T:0;var F=0===w?M:M/w,L=0===b?T:T/b,A=Math.ceil(L+2),R=Math.ceil(F+2),E=r.worldMatrix,P=o.data;this.fillVertices(v,l,E,A,R,P);for(var O=0,H=0,I=[],N=[],k=0,z=A;k<z;++k){H=T>b?T>=k*b?1:L%1:L;for(var V=0,U=R;V<U;++V){O=M>w?M>=V*w?1:F%1:F;var W=l+3,Z=W+1;x?(0===k?(I[0]=y[0].u,I[1]=y[0].u,I[2]=y[4].u+(y[8].u-y[4].u)*H):k<A-1?(I[0]=y[4].u,I[1]=y[4].u,I[2]=y[4].u+(y[8].u-y[4].u)*H):k===A-1&&(I[0]=y[8].u,I[1]=y[8].u,I[2]=y[12].u),0===V?(N[0]=y[0].v,N[1]=y[1].v+(y[2].v-y[1].v)*O,N[2]=y[0].v):V<R-1?(N[0]=y[1].v,N[1]=y[1].v+(y[2].v-y[1].v)*O,N[2]=y[1].v):V===R-1&&(N[0]=y[2].v,N[1]=y[3].v,N[2]=y[2].v),I[3]=I[2],N[3]=N[1]):(0===V?(I[0]=y[0].u,I[1]=y[1].u+(y[2].u-y[1].u)*O,I[2]=g[0]):V<R-1?(I[0]=y[1].u,I[1]=y[1].u+(y[2].u-y[1].u)*O,I[2]=y[1].u):V===R-1&&(I[0]=y[2].u,I[1]=y[3].u,I[2]=y[2].u),0===k?(N[0]=y[0].v,N[1]=y[0].v,N[2]=y[4].v+(y[8].v-y[4].v)*H):k<A-1?(N[0]=y[4].v,N[1]=y[4].v,N[2]=y[4].v+(y[8].v-y[4].v)*H):k===A-1&&(N[0]=y[8].v,N[1]=y[8].v,N[2]=y[12].v),I[3]=I[1],N[3]=N[2]),v[W]=I[0],v[Z]=N[0],v[W+9]=I[1],v[Z+9]=N[1],v[W+18]=I[2],v[Z+18]=N[2],v[W+27]=I[3],v[Z+27]=N[3],a.toArray(v,P[0].color,Z+1),a.toArray(v,P[0].color,Z+9+1),a.toArray(v,P[0].color,Z+18+1),a.toArray(v,P[0].color,Z+27+1),l+=36}}for(var q=0;q<d;q+=6)p[u++]=c,p[u++]=c+1,p[u++]=c+2,p[u++]=c+1,p[u++]=c+3,p[u++]=c+2,c+=4},fillVertices:function(t,r,a,i,n,s){for(var o=0,h=0,u=0,l=0,c=0,f=i;c<f;++c){u=s[c].y,l=s[c+1].y;for(var d=0,v=n;d<v;++d){o=s[d].x,h=s[d+1].x,e.set(Xr[0],o,u,0),e.set(Xr[1],h,u,0),e.set(Xr[2],o,l,0),e.set(Xr[3],h,l,0);for(var p=0;p<4;p++){var _=Xr[p];e.transformMat4(_,_,a);var x=9*p;t[r+x]=_.x,t[r+x+1]=_.y,t[r+x+2]=_.z}r+=36}}},updateVerts:function(t,e,r,a,i){var n,s,o=t.node._uiProps.uiTransformComp,h=t.renderData.data,u=t.spriteFrame,l=u.getRect(),c=Math.abs(o.width),f=Math.abs(o.height),d=o.anchorX*c,v=o.anchorY*f,p=u.insetLeft,_=u.insetRight,x=l.width-p-_,g=u.insetTop,y=u.insetBottom,m=l.height-g-y,S=o.width/(p+_)>1?1:o.width/(p+_),D=o.height/(g+y)>1?1:o.height/(g+y);n=x>0?Math.floor(1e3*e)/1e3%x==0?x:e%x:e,s=m>0?Math.floor(1e3*r)/1e3%m==0?m:r%m:r;for(var w=0;w<=i;w++)0===w?h[w].x=-d:w>0&&w<i?h[w].x=1===w?p*S+Math.min(x,e)-d:x>0?w===i-1?p+n+x*(w-2)-d:p+Math.min(x,e)+x*(w-2)-d:p+e-d:w===i&&(h[w].x=Math.min(p+e+_,c)-d);for(var B=0;B<=a;B++)0===B?h[B].y=-v:B>0&&B<a?h[B].y=1===B?y*D+Math.min(m,r)-v:m>0?B===a-1?y+s+(B-2)*m-v:y+Math.min(m,r)+(B-2)*m-v:y+r-v:B===a&&(h[B].y=Math.min(y+r+g,f)-v)},updateColor:function(t){var e=t.renderData.data,r=e.length;if(0!==r)for(var a=t.color,i=a.r,n=a.g,s=a.b,o=255*t.node._uiProps.opacity,h=0;h<r;h++)e[h].color.r=i,e[h].color.g=n,e[h].color.b=s,e[h].color.a=o}},Qr=K.Type,Yr=K.FillType,Jr=t("s",{getAssembler:function(t){var e=Wr,r=t;switch(r.type){case Qr.SLICED:e=Gr;break;case Qr.TILED:e=Kr;break;case Qr.FILLED:e=r.fillType===Yr.RADIAL?zr:Cr}return e}});K.Assembler=Jr;var $r=Y.sharedManager,ta={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){t.type===ut.IMAGE_STENCIL&&(Wr.updateRenderData(t),Wr.updateColor(t))},fillBuffers:function(t,e){(t.type!==ut.IMAGE_STENCIL||t.spriteFrame)&&($r.pushMask(t),e.finishMergeBatches(),function(t,e){$r.clear(t),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if($r.enterLevel(t),t.type===ut.IMAGE_STENCIL){Wr.fillBuffers(t,e);var r=t.graphics.getMaterialInstance(0);e.forceMergeBatches(r,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),$r.enableMask())}},ea={fillBuffers:function(){$r.exitMask()}},ra={getAssembler:function(){return ta}},aa={getAssembler:function(){return ea}};ht.Assembler=ra,ht.PostAssembler=aa;var ia=new S(null),na=new r,sa=t("B",function(){var t=e.prototype;function e(t){var e=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new D((function(){return new lt(e)}),128),this._drawBatchPool=void 0,this._meshBuffers=new Map,this._customMeshBuffers=new Map,this._meshBufferUseCount=new Map,this._batches=void 0,this._doUploadBuffersCall=new Map,this._emptyMaterial=new w,this._currScene=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currBlendTargetHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._descriptorSetCache=new ha,this._root=t,this.device=t.device,this._batches=new B(64),this._drawBatchPool=new C((function(){return new ct}),128)}return t.acquireBufferBatch=function(t){void 0===t&&(t=it);var e=t===it?36:nt(t);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===e||this._requireBufferBatch(t),this._currMeshBuffer},t.registerCustomBuffer=function(t,e){var r;t instanceof lt?r=t:(r=this._bufferBatchPool.add()).initialize(t,e||this._recreateMeshBuffer.bind(this,t));var a=r.vertexFormatBytes,i=this._customMeshBuffers.get(a);return i||(i=[],this._customMeshBuffers.set(a,i)),i.push(r),r},t.unRegisterCustomBuffer=function(t){var e=this._customMeshBuffers.get(t.vertexFormatBytes);if(e)for(var r=0;r<e.length;r++)if(e[r]===t){e.splice(r,1);break}},t.initialize=function(){return!0},t.destroy=function(){for(var t=this,e=0;e<this._batches.length;e++)this._batches.array[e]&&this._batches.array[e].destroy(this);this._batches.destroy();for(var r,a=c(this._meshBuffers.keys());!(r=a()).done;){var i=r.value,n=this._meshBuffers.get(i);n&&n.forEach((function(t){return t.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy((function(e){e.destroy(t)})),this._descriptorSetCache.destroy(),this._meshBuffers.clear(),Y.sharedManager.destroy()},t.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},t.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,r=0;r<e.length;r++){var a=e[r];if(a.visibility&t.layer)return a}return null},t.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},t.sortScreens=function(){this._screens.sort(this._screenSort)},t.addUploadBuffersFunc=function(t,e){this._doUploadBuffersCall.set(t,e)},t.removeUploadBuffersFunc=function(t){this._doUploadBuffersCall.delete(t)},t.update=function(){for(var t=this._screens,e=0;e<t.length;++e){var r=t[e];r.enabledInHierarchy&&this._recursiveScreenNode(r.node)}var a=0;if(this._batches.length)for(var i=0;i<this._batches.length;++i){var n=this._batches.array[i];if(n.renderScene){if(n.model)for(var s=n.model.subModels,o=0;o<s.length;o++)s[o].priority=a++;else n.hDescriptorSet=this._descriptorSetCache.getDescriptorSet(n);n.renderScene.addBatch(n)}}},t.uploadBuffers=function(){var t=this;this._batches.length>0&&(this._doUploadBuffersCall.forEach((function(e,r){e.call(r,t)})),this._meshBuffers.forEach((function(t){t.forEach((function(t){t.uploadBuffers(),t.reset()}))})),this._customMeshBuffers.forEach((function(t){t.forEach((function(t){t.uploadBuffers(),t.reset()}))})),this._descriptorSetCache.update())},t.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._currLayer=0,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._currScene=null,this._currMeshBuffer=null,this._meshBufferUseCount.clear(),this._batches.clear(),Y.sharedManager.reset(),this._descriptorSetCache.reset()},t.commitComp=function(t,e,r,a){var i,n,s=t,o=0,h=0;e?(i=e.getGFXTexture(),n=e.getGFXSampler(),o=e.getHash(),h=e.getSamplerHash()):(i=null,n=null);var u=s._getRenderScene(),l=s.getRenderMaterial(0);s.stencilStage=Y.sharedManager.stage;var c=s.blendHash,f=s.stencilStage;this._currScene===u&&this._currLayer===t.node.layer&&this._currMaterial===l&&this._currBlendTargetHash===c&&this._currDepthStencilStateStage===f&&this._currTextureHash===o&&this._currSamplerHash===h&&this._currTransform===a||(this.autoMergeBatches(this._currComponent),this._currScene=u,this._currComponent=s,this._currTransform=a,this._currMaterial=l,this._currTexture=i,this._currSampler=n,this._currTextureHash=o,this._currSamplerHash=h,this._currBlendTargetHash=c,this._currDepthStencilStateStage=f,this._currLayer=t.node.layer),r&&r.fillBuffers(s,this)},t.commitModel=function(t,e,r){var a;this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent);var i=0;r&&(t.stencilStage!==J.ENABLED&&t.stencilStage!==J.DISABLED||(t.stencilStage=Y.sharedManager.stage),a=Y.sharedManager.getStencilStage(t.stencilStage,r),i=Y.sharedManager.getStencilHash(t.stencilStage));var n=l.director.getTotalFrames();e&&(e.updateTransform(n),e.updateUBOs(n));for(var s=0;s<e.subModels.length;s++){var o=this._drawBatchPool.alloc(),h=e.subModels[s];o.renderScene=t._getRenderScene(),o.visFlags=t.node.layer,o.model=e,o.bufferBatch=null,o.texture=null,o.sampler=null,o.useLocalData=null,a||(a=null),o.fillPasses(r,a,i,null,0,h.patches),o.hDescriptorSet=v.get(h.handle,p.DESCRIPTOR_SET),o.hInputAssembler=v.get(h.handle,p.INPUT_ASSEMBLER),o.model.visFlags=o.visFlags,this._batches.push(o)}this._currMaterial=this._emptyMaterial,this._currScene=null,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},t.autoMergeBatches=function(t){var e=this.currBufferBatch,r=null==e?void 0:e.recordBatch(),a=this._currMaterial;if(r&&a&&e){var i,n,s=0,o=0;t&&(i=-1===t.blendHash?null:t.getBlendState(),o=t.blendHash,n=null!==t.customMaterial?Y.sharedManager.getStencilStage(t.stencilStage,a):Y.sharedManager.getStencilStage(t.stencilStage),s=Y.sharedManager.getStencilHash(t.stencilStage));var h=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();h.renderScene=this._currScene,h.visFlags=this._currLayer,h.bufferBatch=e,h.texture=this._currTexture,h.sampler=this._currSampler,h.hInputAssembler=r,h.useLocalData=this._currTransform,h.textureHash=this._currTextureHash,h.samplerHash=this._currSamplerHash,h.fillPasses(a,n,s,i,o,null),this._batches.push(h),e.vertexStart=e.vertexOffset,e.indicesStart=e.indicesOffset,e.byteStart=e.byteOffset,_.__isWebIOS14OrIPadOS14Env&&!this._currIsStatic&&(this._currMeshBuffer=null)}},t.forceMergeBatches=function(t,e,r){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=e.getSamplerHash()):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=r.node.layer,this._currScene=r._getRenderScene(),this.autoMergeBatches(r)},t.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.flushMaterial=function(t){this._currMaterial=t},t.walk=function(t,e){void 0===e&&(e=0);var r=t.children.length;if(this._preProcess(t),r>0&&!t._static)for(var a=t.children,i=0;i<a.length;++i){var n=a[i];this.walk(n,e)}this._postProcess(t),e+=1},t._preProcess=function(t){var e=t._uiProps.uiComp;if(!e){var r=t._uiProps.localOpacity;t._uiProps.opacity=t.parent&&t.parent._uiProps?t.parent._uiProps.opacity*r:r}t._uiProps.uiTransformComp&&e&&e.enabledInHierarchy&&e.updateAssembler(this)},t._postProcess=function(t){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.postUpdateAssembler(this)},t._recursiveScreenNode=function(t){this.walk(t),this.autoMergeBatches(this._currComponent)},t._createMeshBuffer=function(t){var e=this._bufferBatchPool.add();e.initialize(t,this._recreateMeshBuffer.bind(this,t));var r=nt(t),a=this._meshBuffers.get(r);return a||(a=[],this._meshBuffers.set(r,a)),a.push(e),e},t._recreateMeshBuffer=function(t,e,r){this.autoMergeBatches(),this._requireBufferBatch(t,e,r)},t._requireBufferBatch=function(t,e,r){var a=nt(t),i=this._meshBuffers.get(a);i||(i=[],this._meshBuffers.set(a,i));var n=this._meshBufferUseCount.get(a)||0;n>=i.length?this._currMeshBuffer=this._createMeshBuffer(t):this._currMeshBuffer=i[n],this._meshBufferUseCount.set(a,n+1),e&&r&&this._currMeshBuffer.request(e,r)},t._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},t._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},x(e,[{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(t){t&&(this._currMeshBuffer=t)}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}},{key:"currIsStatic",set:function(t){this._currIsStatic=t}}]),e}()),oa=function(){function t(){this._handle=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=l.director.root.device;this._localData=new Float32Array(y.COUNT),this._localBuffer=t.createBuffer(new b(M.UNIFORM|M.TRANSFER_DST,T.HOST|T.DEVICE,y.SIZE,y.SIZE))}var e=t.prototype;return e.initialize=function(t){var e=l.director.root.device;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,ia.layout=t.passes[0].localSetLayout,this._handle&&(g.free(this._handle),this._handle=null),this._handle=g.alloc(e,ia),this._descriptorSet=g.get(this._handle),this._descriptorSet.bindBuffer(y.BINDING,this._localBuffer);var r=m.SAMPLER_SPRITE;this._descriptorSet.bindTexture(r,t.texture),this._descriptorSet.bindSampler(r,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.updateLocal=function(){this._transform&&this.uploadLocalData()},e.equals=function(t,e,r){return this._transform===t&&this._textureHash===e&&this._samplerHash===r},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._handle&&(g.free(this._handle),this._handle=null),this._localData=null},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&t.updateWorldTransform(),this._transformUpdate){var e=t._mat;r.toArray(this._localData,e,y.MAT_WORLD_OFFSET),r.inverseTranspose(na,e),r.toArray(this._localData,na,y.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},x(t,[{key:"handle",get:function(){return this._handle}}]),t}(),ha=function(){function t(){this._descriptorSetCache=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new C((function(){return new oa}),16)}var e=t.prototype;return e.getDescriptorSet=function(t){var e=l.director.root;if(t.useLocalData){for(var r=this._localDescriptorSetCache,a=0,i=r.length;a<i;a++){var n=r[a];if(n.equals(t.useLocalData,t.textureHash,t.samplerHash))return n.handle}var s=this._localCachePool.alloc();return s.initialize(t),this._localDescriptorSetCache.push(s),s.handle}var o=this._descriptorSetCache.get(t.textureHash);if(o&&o.has(t.samplerHash))return o.get(t.samplerHash);ia.layout=t.passes[0].localSetLayout;var h=g.alloc(e.device,ia),u=g.get(h),c=m.SAMPLER_SPRITE;return u.bindTexture(c,t.texture),u.bindSampler(c,t.sampler),u.update(),o?this._descriptorSetCache.get(t.textureHash).set(t.samplerHash,h):this._descriptorSetCache.set(t.textureHash,new Map([[t.samplerHash,h]])),h},e.update=function(){this._localDescriptorSetCache.forEach((function(t){t.updateLocal()}))},e.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},e.releaseDescriptorSetCache=function(t){this._descriptorSetCache.has(t)&&(this._descriptorSetCache.get(t).forEach((function(t){g.free(t)})),this._descriptorSetCache.delete(t))},e.destroy=function(){this._descriptorSetCache.forEach((function(t){t.forEach((function(t){g.free(t)}))})),this._descriptorSetCache.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy((function(t){t.destroy()}))},t}();l.internal.Batcher2D=sa;var ua,la=null,ca=-1,fa="BES bswy:->@123",da=Object.create(null),va=[],pa=3e3;function _a(){for(var t=!0,e=Date.now(),r=va.length-1;r>=0;r--){var a=va[r],i=a.fontFamilyName;if(e-a.startTime>pa)F(4933,i),a.onComplete(null,i),va.splice(r,1);else{var n=a.refWidth,s="40px "+i;la.font=s,n!==Z(la,fa,s)?(va.splice(r,1),a.onComplete(null,i)):t=!1}}t&&(clearInterval(ca),ca=-1)}function xa(t,e,r){var a=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var r,a=t.lastIndexOf("/");return-1!==(r=-1===a?t.substring(0,e)+"_LABEL":t.substring(a+1,e)+"_LABEL").indexOf(" ")&&(r='"'+r+'"'),r}(t);if(da[a])r(null,a);else{if(!la){var i=document.createElement("canvas");i.width=100,i.height=100,la=i.getContext("2d")}var n=Z(la,fa,"40px "+a),s=document.createElement("style");s.type="text/css";var o="";Number.isNaN(a)?o+="@font-face { font-family:"+a+"; src:":o+='@font-face { font-family:"'+a+'"; src:',o+='url("'+t+'");',s.textContent=o+"}",document.body.appendChild(s);var h,u,l,c,f,d,v=document.createElement("div"),p=v.style;if(p.fontFamily=a,v.innerHTML=".",p.position="absolute",p.left="-100px",p.top="-100px",document.body.appendChild(v),function(){if(void 0===ua)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);ua=t?parseInt(t[1],10)>42:!e}else ua=!1;return ua}())h=Date.now(),u=a,l=r,c=new Promise((function(t,e){!function r(){Date.now()-h>=pa?e():document.fonts.load("40px "+u).then((function(e){e.length>=1?t():setTimeout(r,100)}),(function(){e()}))}()})),f=null,d=new Promise((function(t,e){f=setTimeout(e,pa)})),Promise.race([d,c]).then((function(){f&&(clearTimeout(f),f=null),l(null,u)}),(function(){F(4933,u),l(null,u)}));else{var _={fontFamilyName:a,refWidth:n,onComplete:r,startTime:Date.now()};va.push(_),-1===ca&&(ca=setInterval(_a,100))}da[a]=s}}function ga(t,e,r,a){var i=new Q;i._nativeUrl=t,i._nativeAsset=e,a(null,i)}A.register({".font":xa,".eot":xa,".ttf":xa,".woff":xa,".svg":xa,".ttc":xa}),R.register({".font":ga,".eot":ga,".ttf":ga,".woff":ga,".svg":ga,".ttc":ga}),l.UI={MeshBuffer:lt,spriteAssembler:Jr,graphicsAssembler:Jt,labelAssembler:Sr}}}}));
