System.register(["./fog-01fb8507.js","./index-7f8a4e60.js","./screen-3553948d.js","./renderable-component-a695dbe3.js","./transform-utils-753c4611.js","./json-asset-60ef8fb2.js","./camera-component-262e4a52.js"],(function(t){"use strict";var e,n,o,i,r,a,u,s,l,c,p,d,_,h,f,y,v,g,m,A,E,P,I,T,N,O;return{setters:[function(t){e=t.ew,n=t.l,o=t.df,i=t.ex,r=t.d$,a=t.eX,u=t.dg,s=t.eu,l=t.ev,c=t.e1,p=t.ey,d=t.eE,_=t.eN,h=t.eF,f=t.h9,y=t.eA,v=t.go,g=t.gp,m=t.gl,A=t.eH,E=t.eq,P=t.dG,I=t.dI,T=t.fU},function(t){N=t.x,O=t.y},function(){},function(){},function(){},function(){},function(){}],execute:function(){var D,S,C;!function(t){t.PLAYED="play",t.PAUSED="pause",t.STOPPED="stop",t.SEEKED="seeked",t.ENDED="ended",t.INTERRUPTION_BEGIN="interruptionBegin",t.INTERRUPTION_END="interruptionEnd",t.USER_GESTURE="on_gesture"}(D||(D={})),function(t){t[t.DOM_AUDIO=0]="DOM_AUDIO",t[t.WEB_AUDIO=1]="WEB_AUDIO",t[t.MINIGAME_AUDIO=2]="MINIGAME_AUDIO",t[t.NATIVE_AUDIO=3]="NATIVE_AUDIO",t[t.UNKNOWN_AUDIO=4]="UNKNOWN_AUDIO"}(S||(S={})),function(t){t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.STOPPED=3]="STOPPED",t[t.INTERRUPTED=4]="INTERRUPTED"}(C||(C={}));var w,k,b,L=0;function x(t,e){var n;e.invoking||(e.invoking=!0,(n=e.func).call.apply(n,[t].concat(e.args)).then((function(){e.invoking=!1,t._operationQueue.shift(),t._eventTarget.emit(e.id.toString());var n=t._operationQueue[0];n&&x(t,n)})).catch((function(){})))}function U(t,e,n){var o=n.value;n.value=function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new Promise((function(e){var i=L++,r=t;r._operationQueue.push({id:i,func:o,args:n,invoking:!1}),r._eventTarget.once(i.toString(),e),x(r,r._operationQueue[0])}))}}var R,M,G,j,B,H=function(){function t(t,e){this._innerAudioContext=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._innerAudioContext=t,t.volume=e}var n=t.prototype;return n.play=function(){this._innerAudioContext.play()},n.stop=function(){this._innerAudioContext.stop()},e(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb&&this._innerAudioContext.offPlay(this._onPlayCb),this._onPlayCb=t,t&&this._innerAudioContext.onPlay(t)}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb&&this._innerAudioContext.offEnded(this._onEndCb),this._onEndCb=t,t&&this._innerAudioContext.onEnded(t)}}]),t}(),V=(b=k=function(){function t(t){var e=this;this._innerAudioContext=void 0,this._state=C.INIT,this._onHide=void 0,this._onShow=void 0,this._onPlay=void 0,this._onPause=void 0,this._onStop=void 0,this._onSeeked=void 0,this._onEnded=void 0,this._eventTarget=new r,this._operationQueue=[],this._innerAudioContext=t,this._eventTarget=new r,this._onHide=function(){e._state===C.PLAYING&&e.pause().then((function(){e._state=C.INTERRUPTED,e._eventTarget.emit(D.INTERRUPTION_BEGIN)})).catch((function(){}))},n.game.on(n.Game.EVENT_HIDE,this._onHide),this._onShow=function(){e._state===C.INTERRUPTED&&e.play().then((function(){e._eventTarget.emit(D.INTERRUPTION_END)})).catch((function(){}))},n.game.on(n.Game.EVENT_SHOW,this._onShow);var o=this._eventTarget;this._onPlay=function(){e._state=C.PLAYING,o.emit(D.PLAYED)},t.onPlay(this._onPlay),this._onPause=function(){e._state=C.PAUSED,o.emit(D.PAUSED)},t.onPause(this._onPause),this._onStop=function(){e._state=C.STOPPED,o.emit(D.STOPPED)},t.onStop(this._onStop),this._onSeeked=function(){o.emit(D.SEEKED)},t.onSeeked(this._onSeeked),this._onEnded=function(){e._state=C.INIT,o.emit(D.ENDED)},t.onEnded(this._onEnded)}var i=t.prototype;return i.destroy=function(){var t=this;this._onShow&&(n.game.off(n.Game.EVENT_SHOW,this._onShow),this._onShow=void 0),this._onHide&&(n.game.off(n.Game.EVENT_HIDE,this._onHide),this._onHide=void 0),this._innerAudioContext&&(["Play","Pause","Stop","Seeked","Ended"].forEach((function(e){t._offEvent(e)})),this._innerAudioContext=null)},i._offEvent=function(t){this["_on"+t]&&(this._innerAudioContext["off"+t](this["_on"+t]),this["_on"+t]=void 0)},t.load=function(e){return new Promise((function(n){t.loadNative(e).then((function(e){n(new t(e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,n){var o=a.createInnerAudioContext(),i=setTimeout((function(){r(),e(o)}),8e3);function r(){o.offCanplay(u),o.offError(s)}function u(){r(),clearTimeout(i),e(o)}function s(t){r(),clearTimeout(i),console.error("failed to load innerAudioContext"),n(new Error(t))}o.onCanplay(u),o.onError(s),o.src=t}))},t.loadOneShotAudio=function(e,n){return new Promise((function(o,i){t.loadNative(e).then((function(t){o(new H(t,n))})).catch(i)}))},i.seek=function(t){var e=this;return new Promise((function(n){t=o(t,0,e.duration),e._eventTarget.once(D.SEEKED,n),e._innerAudioContext.seek(t)}))},i.play=function(){var t=this;return new Promise((function(e){t._eventTarget.once(D.PLAYED,e),t._innerAudioContext.play()}))},i.pause=function(){var t=this;return new Promise((function(e){t._eventTarget.once(D.PAUSED,e),t._innerAudioContext.pause()}))},i.stop=function(){var t=this;return new Promise((function(e){t._eventTarget.once(D.STOPPED,e),t._innerAudioContext.stop()}))},i.onInterruptionBegin=function(t){this._eventTarget.on(D.INTERRUPTION_BEGIN,t)},i.offInterruptionBegin=function(t){this._eventTarget.off(D.INTERRUPTION_BEGIN,t)},i.onInterruptionEnd=function(t){this._eventTarget.on(D.INTERRUPTION_END,t)},i.offInterruptionEnd=function(t){this._eventTarget.off(D.INTERRUPTION_END,t)},i.onEnded=function(t){this._eventTarget.on(D.ENDED,t)},i.offEnded=function(t){this._eventTarget.off(D.ENDED,t)},e(t,[{key:"src",get:function(){return this._innerAudioContext?this._innerAudioContext.src:""}},{key:"type",get:function(){return S.MINIGAME_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._innerAudioContext.loop},set:function(t){this._innerAudioContext.loop=t}},{key:"volume",get:function(){return this._innerAudioContext.volume},set:function(t){t=u(t),this._innerAudioContext.volume=t}},{key:"duration",get:function(){return this._innerAudioContext.duration}},{key:"currentTime",get:function(){return this._innerAudioContext.currentTime}}]),t}(),k.maxAudioChannel=10,i((w=b).prototype,"seek",[U],Object.getOwnPropertyDescriptor(w.prototype,"seek"),w.prototype),i(w.prototype,"play",[U],Object.getOwnPropertyDescriptor(w.prototype,"play"),w.prototype),i(w.prototype,"pause",[U],Object.getOwnPropertyDescriptor(w.prototype,"pause"),w.prototype),i(w.prototype,"stop",[U],Object.getOwnPropertyDescriptor(w.prototype,"stop"),w.prototype),w);n.AudioPlayer=V;var Y=t("AudioClip",s("cc.AudioClip")((B=j=function(t){function n(){var e;return e=t.call(this)||this,d(e,"_duration",G,_(e)),e._loadMode=S.UNKNOWN_AUDIO,e._meta=null,e._player=void 0,e.loaded=!1,e}l(n,t);var o=n.prototype;return o.destroy=function(){var e,n=t.prototype.destroy.call(this);return null===(e=this._player)||void 0===e||e.destroy(),n},o.validate=function(){return!!this._meta},o.getDuration=function(){return this._duration?this._duration:this._meta?this._meta.duration:0},o.getCurrentTime=function(){return this._player?this._player.currentTime:0},o.getVolume=function(){return this._player?this._player.volume:0},o.getLoop=function(){return!!this._player&&this._player.loop},o.setCurrentTime=function(t){var e;null===(e=this._player)||void 0===e||e.seek(t).catch((function(){}))},o.setVolume=function(t){this._player&&(this._player.volume=t)},o.setLoop=function(t){this._player&&(this._player.loop=t)},o.play=function(){var t;null===(t=this._player)||void 0===t||t.play().catch((function(){}))},o.pause=function(){var t;null===(t=this._player)||void 0===t||t.pause().catch((function(){}))},o.stop=function(){var t;null===(t=this._player)||void 0===t||t.stop().catch((function(){}))},o.playOneShot=function(t){void 0===t&&(t=1),this._nativeAsset&&V.loadOneShotAudio(this._nativeAsset.url,t).then((function(t){t.play()})).catch((function(){}))},e(n,[{key:"_nativeAsset",get:function(){return this._meta},set:function(t){this._meta=t,t?(this.loaded=!0,this._loadMode=t.type,this._player=t.player,this.emit("load")):(this._meta=null,this._loadMode=S.UNKNOWN_AUDIO,this._duration=0,this.loaded=!1)}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}},{key:"state",get:function(){return this._player?this._player.state:C.INIT}}]),n}(c),j.AudioType=S,G=i((M=B).prototype,"_duration",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),i(M.prototype,"_nativeDep",[p],Object.getOwnPropertyDescriptor(M.prototype,"_nativeDep"),M.prototype),R=M))||R);function W(t,e,n){V.load(t,{audioLoadMode:e.audioLoadMode}).then((function(e){var o={player:e,url:t,duration:e.duration,type:e.type};n(null,o)})).catch((function(t){n(t)}))}function K(t,e,n,o){var i=new Y;i._nativeUrl=t,i._nativeAsset=e,i._duration=e.duration,o(null,i)}n.AudioClip=Y,N.register({".mp3":W,".ogg":W,".wav":W,".m4a":W}),O.register({".mp3":K,".ogg":K,".wav":K,".m4a":K});var z,Q,q,F,X,$,J,Z,tt,et,nt,ot,it,rt,at,ut,st,lt,ct,pt=new(function(){function t(){this._oneShotAudioInfoList=[],this._audioPlayerInfoList=[]}var e=t.prototype;return e._findIndex=function(t,e){return t.findIndex((function(t){return t.audio===e}))},e._tryAddPlaying=function(t,e){var n=this._findIndex(t,e);return n>-1?(t[n].playTime=performance.now(),!1):(t.push({audio:e,playTime:performance.now()}),!0)},e.addPlaying=function(t){if(t instanceof V){if(this._tryAddPlaying(this._audioPlayerInfoList,t))return}else this._tryAddPlaying(this._oneShotAudioInfoList,t)},e._tryRemovePlaying=function(t,e){var n=this._findIndex(t,e);return-1!==n&&(f(t,n),!0)},e.removePlaying=function(t){if(t instanceof V){if(this._tryRemovePlaying(this._audioPlayerInfoList,t))return}else this._tryRemovePlaying(this._oneShotAudioInfoList,t)},e.discardOnePlayingIfNeeded=function(){var t;this._audioPlayerInfoList.length+this._oneShotAudioInfoList.length<V.maxAudioChannel||(this._oneShotAudioInfoList.length>0?this._oneShotAudioInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})):this._audioPlayerInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})),t&&(t.audio.stop(),this.removePlaying(t.audio)))},t}()),dt=(z=s("cc.AudioSource"),Q=v(),q=g(),F=y(Y),X=y(Y),$=m(),J=m(),Z=m(),tt=A(),et=m(),ct=z(nt=Q(nt=q((lt=st=function(t){function n(){for(var e,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return e=t.call.apply(t,[this].concat(o))||this,d(e,"_clip",it,_(e)),e._player=null,d(e,"_loop",rt,_(e)),d(e,"_playOnAwake",at,_(e)),d(e,"_volume",ut,_(e)),e._cachedCurrentTime=0,e._operationsBeforeLoading=[],e._isLoaded=!1,e._lastSetClip=void 0,e}l(n,t);var i=n.prototype;return i._syncPlayer=function(){var t=this,e=this._clip;this._isLoaded=!1,e&&this._lastSetClip!==e&&(e._nativeAsset?(this._lastSetClip=e,V.load(e._nativeAsset.url,{audioLoadMode:e.loadMode}).then((function(n){t._lastSetClip===e&&(t._isLoaded=!0,t._player&&(t._player.offEnded(),t._player.offInterruptionBegin(),t._player.offInterruptionEnd(),t._player.destroy()),t._player=n,n.onEnded((function(){pt.removePlaying(n)})),n.onInterruptionBegin((function(){pt.removePlaying(n)})),n.onInterruptionEnd((function(){pt.addPlaying(n)})),t._syncStates())})).catch((function(){}))):console.error("Invalid audio clip"))},i.onLoad=function(){this._syncPlayer()},i.onEnable=function(){this._playOnAwake&&!this.playing&&this.play()},i.onDisable=function(){this.pause()},i.onDestroy=function(){this.stop()},i.play=function(){var t,e,n=this;this._isLoaded?(pt.discardOnePlayingIfNeeded(),this.state===C.PLAYING&&(null===(e=this._player)||void 0===e||e.stop().catch((function(){}))),null===(t=this._player)||void 0===t||t.play().then((function(){pt.addPlaying(n._player)})).catch((function(){}))):this._operationsBeforeLoading.push("play")},i.pause=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.pause().then((function(){pt.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("pause")},i.stop=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.stop().then((function(){pt.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("stop")},i.playOneShot=function(t,e){void 0===e&&(e=1),t._nativeAsset?V.loadOneShotAudio(t._nativeAsset.url,this._volume*e,{audioLoadMode:t.loadMode}).then((function(t){pt.discardOnePlayingIfNeeded(),t.onPlay=function(){pt.addPlaying(t)},t.onEnd=function(){pt.removePlaying(t)},t.play()})).catch((function(){})):console.error("Invalid audio clip")},i._syncStates=function(){var t=this;this._player&&this._player.seek(this._cachedCurrentTime).then((function(){t._player&&(t._player.loop=t._loop,t._player.volume=t._volume,t._operationsBeforeLoading.forEach((function(e){var n;null===(n=t[e])||void 0===n||n.call(t)})),t._operationsBeforeLoading.length=0)})).catch((function(){}))},e(n,[{key:"clip",get:function(){return this._clip},set:function(t){t!==this._clip&&(this._clip=t,this._syncPlayer())}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._player&&(this._player.loop=t)}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"volume",get:function(){return this._volume},set:function(t){Number.isNaN(t)?console.warn("illegal audio volume!"):(t=o(t,0,1),this._player?(this._player.volume=t,this._volume=this._player.volume):this._volume=t)}},{key:"currentTime",get:function(){return this._player?this._player.currentTime:this._cachedCurrentTime},set:function(t){var e;Number.isNaN(t)?console.warn("illegal audio time!"):(t=o(t,0,this.duration),this._cachedCurrentTime=t,null===(e=this._player)||void 0===e||e.seek(this._cachedCurrentTime).catch((function(){})))}},{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._clip)||void 0===e?void 0:e.getDuration())&&void 0!==t?t:this._player?this._player.currentTime:0}},{key:"state",get:function(){return this._player?this._player.state:C.INIT}},{key:"playing",get:function(){return this.state===n.AudioState.PLAYING}}],[{key:"maxAudioChannel",get:function(){return V.maxAudioChannel}}]),n}(E),st.AudioState=C,it=i((ot=lt).prototype,"_clip",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=i(ot.prototype,"_loop",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),at=i(ot.prototype,"_playOnAwake",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ut=i(ot.prototype,"_volume",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),i(ot.prototype,"clip",[X,$],Object.getOwnPropertyDescriptor(ot.prototype,"clip"),ot.prototype),i(ot.prototype,"loop",[J],Object.getOwnPropertyDescriptor(ot.prototype,"loop"),ot.prototype),i(ot.prototype,"playOnAwake",[Z],Object.getOwnPropertyDescriptor(ot.prototype,"playOnAwake"),ot.prototype),i(ot.prototype,"volume",[tt,et],Object.getOwnPropertyDescriptor(ot.prototype,"volume"),ot.prototype),nt=ot))||nt)||nt)||nt,t({AudioSource:ct,AudioSourceComponent:ct}),ct);P(Y,"AudioClip",[{name:"PlayingState",newName:"AudioState",target:dt,targetName:"AudioSource"}]),I(Y.prototype,"AudioClip.prototype",["state","play","pause","stop","playOneShot","setCurrentTime","setVolume","setLoop","getCurrentTime","getVolume","getLoop"].map((function(t){return{name:t,suggest:"please use AudioSource.prototype."+t+" instead"}}))),n.AudioSourceComponent=dt,T.setClassAlias(dt,"cc.AudioSourceComponent")}}}));
