System.register(["./fog-01fb8507.js","./screen-3553948d.js","./renderable-component-a695dbe3.js","./transform-utils-753c4611.js","./json-asset-60ef8fb2.js","./camera-component-262e4a52.js"],(function(e,t){"use strict";var i,n,r,s,a,o,u,l,h,c,d,f,p,_,g,m,v,y,w,T,b,A,E,S,N,R,I,x,C,P,k,D,F,M,B,L,U,O,W,V,H,j,z,q,G,X,Y,Q,J,K,Z,$,ee,te,ie,ne,re,se,ae,oe,ue,le,he,ce,de,fe,pe,_e,ge,me,ve,ye,we,Te,be,Ae,Ee,Se,Ne,Re,Ie,xe,Ce,Pe,ke,De,Fe,Me,Be,Le,Ue,Oe,We,Ve,He,je,ze,qe,Ge,Xe,Ye,Qe,Je,Ke,Ze,$e,et,tt,it,nt,rt,st,at,ot,ut,lt,ht,ct,dt,ft,pt,_t,gt,mt,vt,yt,wt,Tt,bt,At,Et,St,Nt,Rt,It,xt,Ct,Pt,kt,Dt,Ft,Mt,Bt,Lt,Ut,Ot,Wt,Vt,Ht,jt,zt,qt,Gt,Xt,Yt,Qt,Jt,Kt,Zt,$t,ei,ti,ii,ni,ri,si,ai,oi,ui,li,hi,ci,di,fi,pi,_i,gi,mi,vi,yi,wi,Ti,bi,Ai,Ei,Si,Ni,Ri,Ii,xi,Ci,Pi,ki,Di,Fi,Mi,Bi,Li,Ui,Oi,Wi;return{setters:[function(e){i=e.cV,n=e.cW,r=e.cX,s=e.cY,a=e.cZ,o=e.c_,u=e.c$,l=e.d0,h=e.d1,c=e.d2,d=e.d3,f=e.d4,p=e.d5,_=e.d6,g=e.d7,m=e.d8,v=e.d9,y=e.da,w=e.db,T=e.dc,b=e.dd,A=e.de,E=e.df,S=e.dg,N=e.dh,R=e.di,I=e.dj,x=e.dk,C=e.dl,P=e.dm,k=e.dn,D=e.dp,F=e.dq,M=e.dr,B=e.ds,L=e.dt,U=e.du,O=e.dv,W=e.dw,V=e.fx,H=e.fy,j=e.e$,z=e.fz,q=e.fA,G=e.eU,X=e.fB,Y=e.e_,Q=e.eZ,J=e.fC,K=e.fD,Z=e.eV,$=e.fE,ee=e.fF,te=e.fG,ie=e.fH,ne=e.fI,re=e.fJ,se=e.fK,ae=e.fL,oe=e.fM,ue=e.fN,le=e.fO,he=e.fP,ce=e.e,de=e.an,fe=e.l,pe=e.af,_e=e.ap,ge=e.z,me=e.G,ve=e.aG,ye=e.x,we=e.aI,Te=e.e7,be=e.aw,Ae=e.N,Ee=e.au,Se=e.H,Ne=e.I,Re=e.bW,Ie=e.bX,xe=e.c9,Ce=e.c8,Pe=e.f9,ke=e.ew,De=e.v,Fe=e.al,Me=e.ev,Be=e.g,Le=e.f,Ue=e.d,Oe=e.c,We=e.fQ,Ve=e.fR,He=e.cr,je=e.cq,ze=e.b_,qe=e.aP,Ge=e.bV,Xe=e.t,Ye=e.cp,Qe=e.aJ,Je=e.aK,Ke=e.$,Ze=e.aM,$e=e.es,et=e.co,tt=e.P,it=e.dG,nt=e.dH,rt=e.ei,st=e.dP,at=e.eO,ot=e.en,ut=e.eN,lt=e.d$,ht=e.fS,ct=e.fT,dt=e.fU,ft=e.fV,pt=e.fW,_t=e.fX,gt=e.e1,mt=e.fY,vt=e.dQ,yt=e.fZ,wt=e.f_,Tt=e.f$,bt=e.g0,At=e.ee,Et=e.g1,St=e.g2,Nt=e.eM,Rt=e.eg,It=e.k,xt=e.e3,Ct=e.g3,Pt=e.g4,kt=e.e4,Dt=e.g5,Ft=e.g6,Mt=e.g7,Bt=e.g8,Lt=e.g9,Ut=e.ga,Ot=e.gb,Wt=e.gc,Vt=e.gd,Ht=e.ge,jt=e.gf,zt=e.gg,qt=e.i,Gt=e.gh,Xt=e.gi,Yt=e.gj,Qt=e.o,Jt=e.eh,Kt=e.gk,Zt=e.n,$t=e.eu,ei=e.eA,ti=e.ex,ii=e.eE,ni=e.eF,ri=e.eB,si=e.gl,ai=e.bL,oi=e.by,ui=e.T,li=e.bI,hi=e.w,ci=e.et,di=e.bR,fi=e.gm,pi=e.eP},function(e){_i=e.F,gi=e.J,mi=e.D,vi=e.L,yi=e.e,wi=e.k,Ti=e.G,bi=e.o},function(e){Ai=e.R,Ei=e.c},function(e){Si=e.m,Ni=e.c,Ri=e.n,Ii=e.o,xi=e.p,Ci=e.b,Pi=e.H,ki=e.C},function(e){Di=e.S,Fi=e.a,Mi=e.C,Bi=e.N,Li=e.J,Ui=e.T,Oi=e.B},function(e){Wi=e.C}],execute:function(){e({h:ji,s:ys,t:ws,v:Ts});var Vi=Object.freeze({__proto__:null,bits:i,Vec2:n,v2:r,Vec3:s,v3:a,Vec4:o,v4:u,Quat:l,quat:h,Mat3:c,Mat4:d,mat4:f,AffineTransform:p,Size:_,size:g,Rect:m,rect:v,Color:y,color:w,EPSILON:T,equals:b,approx:A,clamp:E,clamp01:S,lerp:N,toRadian:R,toDegree:I,random:x,randomRange:C,randomRangeInt:P,pseudoRandom:k,pseudoRandomRange:D,pseudoRandomRangeInt:F,nextPow2:M,repeat:B,pingPong:L,inverseLerp:U,absMaxComponent:O,absMax:W});e("m",Vi);var Hi=Object.freeze({__proto__:null,distance:V,enums:H,intersect:j,Line:z,Plane:q,Ray:G,Triangle:X,Sphere:Y,AABB:Q,OBB:J,Capsule:K,Frustum:Z,Keyframe:$,AnimationCurve:ee,get ERaycastMode(){return te},line:ie,plane:ne,ray:re,triangle:se,sphere:ae,aabb:oe,obb:ue,capsule:le,frustum:he});function ji(){var e=new _i;return e.initialize({flows:[]}),e}e("g",Hi);var zi=new n,qi=function(){var e=t.prototype;function t(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return e.main=function(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){var t=this.settings=window._CCSettings.splashScreen;t.totalTime=null!=this.settings.totalTime?this.settings.totalTime:3e3,t.base64src=this.settings.base64src||"",t.effect=this.settings.effect||"FADE-INOUT",t.clearColor=this.settings.clearColor||new de(.88,.88,.88,1),t.displayRatio=null!=this.settings.displayRatio?this.settings.displayRatio:.4,t.displayWatermark=null==this.settings.displayWatermark||this.settings.displayWatermark}else this.settings={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new de(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.settings.base64src||this.settings.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.settings=null,this._directCall=!0;else{fe.view.enableRetina(!0),fe.view.resizeWithBrowserSize(!0);var i=window._CCSettings.designResolution;i?fe.view.setDesignResolutionSize(i.width,i.height,i.policy):fe.view.setDesignResolutionSize(960,640,4),this.root=e,this.device=e.device,fe.game.once(fe.Game.EVENT_GAME_INITED,(function(){fe.director._lateUpdate=performance.now()}),fe.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.preInit(),this.logoImage=new Image,this.logoImage.onload=this.init.bind(this),this.logoImage.src=this.settings.base64src}}else ce("RENDER ROOT IS NULL.")},e.setOnFinish=function(e){if(this._directCall&&e)return t._ins=void 0,void e();this.callBack=e},e._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),fe.game.resume())},e.preInit=function(){var e=this.settings.clearColor;this.clearColors=[new de(e.x,e.y,e.z,e.w)];var t=this.device;this.renderArea=new pe(0,0,t.width,t.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=t.commandBuffer;var i=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),n=4*Float32Array.BYTES_PER_ELEMENT,r=4*n;this.vertexBuffers=t.createBuffer(new _e(ge.VERTEX|ge.TRANSFER_DST,me.HOST|me.DEVICE,r,n)),this.vertexBuffers.update(i);var s=new Uint16Array([0,1,2,1,3,2]),a=Uint16Array.BYTES_PER_ELEMENT,o=6*a;this.indicesBuffers=t.createBuffer(new _e(ge.INDEX|ge.TRANSFER_DST,me.HOST|me.DEVICE,o,a)),this.indicesBuffers.update(s);var u=[new ve("a_position",ye.RG32F),new ve("a_texCoord",ye.RG32F)],l=new we(u,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=t.createInputAssembler(l),this.projection=new d,d.ortho(this.projection,-1,1,-1,1,-1,1,t.capabilities.clipSpaceMinZ,t.capabilities.clipSpaceSignY,t.surfaceTransform)},e.init=function(){var e=this;this.initLogo(),this.settings.displayWatermark&&this.initWarterMark(),fe.game.pause(),this.handle=requestAnimationFrame((function t(i){if(!e.cancelAnimate){var n=e.settings,r=e.device;d.ortho(e.projection,-1,1,-1,1,-1,1,r.capabilities.clipSpaceMinZ,r.capabilities.clipSpaceSignY,r.surfaceTransform);var s=r.width,a=r.height,o=s<a?s:a;e.startTime<0&&(e.startTime=i);var u=i-e.startTime,l=S(u/n.totalTime),h=Si(l);"NONE"===n.effect&&(h=1);var c=e.logoTexture.width,f=e.logoTexture.height,p=o*n.displayRatio,_=p*c/f,g=p;if(r.surfaceTransform!==De.ROTATE_90&&r.surfaceTransform!==De.ROTATE_270||(_=p*s/a,g=p*f/c*a/s),e.logoMat.setProperty("resolution",zi.set(s,a),0),e.logoMat.setProperty("scale",zi.set(_,g),0),e.logoMat.setProperty("translate",zi.set(.5*s,.5*a),0),e.logoMat.setProperty("precent",h),e.logoMat.setProperty("u_projection",e.projection),e.logoMat.passes[0].update(),n.displayWatermark&&e.watermarkMat){var m=.5*o,v=e.watermarkTexture.width,y=m,w=m*e.watermarkTexture.height/v;r.surfaceTransform!==De.ROTATE_90&&r.surfaceTransform!==De.ROTATE_270||(y=.5*m,w=m*s/a*.5),e.watermarkMat.setProperty("resolution",zi.set(s,a),0),e.watermarkMat.setProperty("scale",zi.set(y,w),0),e.watermarkMat.setProperty("translate",zi.set(.5*s,.1*a),0),e.watermarkMat.setProperty("precent",h),e.watermarkMat.setProperty("u_projection",e.projection),e.watermarkMat.passes[0].update()}e.frame(),u>n.totalTime&&(e.splashFinish=!0),requestAnimationFrame(t)}}))},e.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},e.initLogo=function(){var e=this.device;this.logoMat=new Te,this.logoMat.initialize({effectName:"splash-screen"});var t=new be;t.addressU=Ae.CLAMP,t.addressV=Ae.CLAMP,t.addressW=Ae.CLAMP,this.sampler=e.createSampler(t),this.logoTexture=e.createTexture(new Ee(Se.TEX2D,Ne.SAMPLED|Ne.TRANSFER_DST,ye.RGBA8,this.logoImage.width,this.logoImage.height));var i=this.logoMat.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.logoTexture),this.shader=Re.get(i.getShaderVariant());var r=Ie.get(xe.get(i.handle,Ce.DESCRIPTOR_SET));r.bindSampler(n,this.sampler),r.update();var s=new Fe;s.texExtent.width=this.logoImage.width,s.texExtent.height=this.logoImage.height,s.texExtent.depth=1,e.copyTexImagesToTexture([this.logoImage],this.logoTexture,[s])},e.initWarterMark=function(){var e=document.createElement("canvas");e.width=330,e.height=30,e.style.width=""+e.width,e.style.height=""+e.height;var t=e.getContext("2d");t.font="18px Arial",t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";var i="Powered by Cocos Creator",n=t.measureText(i);t.fillText(i,(330-n.width)/2,6);var r=new Fe;r.texExtent.width=e.width,r.texExtent.height=e.height,r.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new Ee(Se.TEX2D,Ne.SAMPLED|Ne.TRANSFER_DST,ye.RGBA8,e.width,e.height)),this.device.copyTexImagesToTexture([e],this.watermarkTexture,[r]),this.watermarkMat=new Te,this.watermarkMat.initialize({effectName:"splash-screen"});var s=this.watermarkMat.passes[0],a=s.getBinding("mainTexture");s.bindTexture(a,this.watermarkTexture),Ie.get(xe.get(s.handle,Ce.DESCRIPTOR_SET)).update()},e.frame=function(){var e=this.device;e.acquire();var t=this.cmdBuff,i=this.framebuffer,n=this.renderArea;n.width=e.width,n.height=e.height,t.begin(),t.beginRenderPass(i.renderPass,i,n,this.clearColors,1,0);var r=this.logoMat.passes[0],s=gi.getOrCreatePipelineState(e,r,this.shader,i.renderPass,this.quadAssmebler);if(t.bindPipelineState(s),t.bindDescriptorSet(Pe.MATERIAL,r.descriptorSet),t.bindInputAssembler(this.quadAssmebler),t.draw(this.quadAssmebler),this.settings.displayWatermark&&this.watermarkMat){var a=this.watermarkMat.passes[0],o=gi.getOrCreatePipelineState(e,a,this.shader,i.renderPass,this.quadAssmebler);t.bindPipelineState(o),t.bindDescriptorSet(Pe.MATERIAL,a.descriptorSet),t.bindInputAssembler(this.quadAssmebler),t.draw(this.quadAssmebler)}t.endRenderPass(),t.end(),e.flushCommands([t]),e.queue.submit([t]),e.present()},e.destroy=function(){this.callBack=null,this.root=null,this.device=null,this.clearColors=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.framebuffer=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null,t._ins=void 0},ke(t,[{key:"splashFinish",set:function(e){this._splashFinish=e,this._tryToStart()}},{key:"loadFinish",set:function(e){this._loadFinish=e,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();qi._ins=void 0,fe.internal.SplashScreen=qi;var Gi=e("n",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(){},t.postUpdate=function(){},ke(e,[{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}}]),e}()),Xi=new Ve("Scheduler"),Yi=function(e,t,i,n){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=i,this.markedForDeletion=n};Yi.get=function(e,t,i,n){var r=Yi._listEntries.pop();return r?(r.target=e,r.priority=t,r.paused=i,r.markedForDeletion=n):r=new Yi(e,t,i,n),r},Yi.put=function(e){Yi._listEntries.length<20&&(e.target=null,Yi._listEntries.push(e))},Yi._listEntries=[];var Qi=function(e,t,i,n){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=i,this.callback=n};Qi.get=function(e,t,i,n){var r=Qi._hashUpdateEntries.pop();return r?(r.list=e,r.entry=t,r.target=i,r.callback=n):r=new Qi(e,t,i,n),r},Qi.put=function(e){Qi._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,Qi._hashUpdateEntries.push(e))},Qi._hashUpdateEntries=[];var Ji=function(e,t,i,n,r,s){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=i,this.currentTimer=n,this.currentTimerSalvaged=r,this.paused=s};Ji.get=function(e,t,i,n,r,s){var a=Ji._hashTimerEntries.pop();return a?(a.timers=e,a.target=t,a.timerIndex=i,a.currentTimer=n,a.currentTimerSalvaged=r,a.paused=s):a=new Ji(e,t,i,n,r,s),a},Ji.put=function(e){Ji._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,Ji._hashTimerEntries.push(e))},Ji._hashTimerEntries=[];var Ki=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,i,n,r,s){return this._lock=!1,this._scheduler=e,this._target=i,this._callback=t,this._elapsed=-1,this._interval=n,this._delay=s,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===fe.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();Ki._timers=[],Ki.get=function(){return Ki._timers.pop()||new Ki},Ki.put=function(e){Ki._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,Ki._timers.push(e))};var Zi=e("S",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=We(!0),t._hashForTimers=We(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}Me(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?Ue(1513):e.id=Xi.getNewId())};var i=t.prototype;return i.setTimeScale=function(e){this._timeScale=e},i.getTimeScale=function(){return this._timeScale},i.update=function(e){var t,i,n,r,s;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,n=(i=this._updatesNegList).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,n=(i=this._updates0List).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,n=(i=this._updatesPosList).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);var a=this._arrayForTimers;for(t=0;t<a.length;t++){if(s=a[t],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(e),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,i=this._updatesNegList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updates0List;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updatesPosList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;this._updateHashLocked=!1,this._currentTarget=null},i.schedule=function(e,t,i,n,r,s){if("function"!=typeof e){var a=e;e=t,t=a}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(s=!!n,n=fe.macro.REPEAT_FOREVER,r=0),Be(t,1502);var o=t.uuid||t.id;if(o){var u,l,h=this._hashForTimers[o];if(h?h.paused!==s&&Ue(1511):(h=Ji.get(null,t,0,null,null,s),this._arrayForTimers.push(h),this._hashForTimers[o]=h),null==h.timers)h.timers=[];else for(l=0;l<h.timers.length;++l)if((u=h.timers[l])&&e===u._callback)return Oe(1507,u.getInterval(),i),void(u._interval=i);(u=Ki.get()).initWithCallback(this,e,t,i,n,r),h.timers.push(u),this._currentTarget===h&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else Le(1510)},i.scheduleUpdate=function(e,t,i){var n=e.uuid||e.id;if(n){var r=this._hashForUpdates[n];if(r&&r.entry){if(r.entry.priority===t)return r.entry.markedForDeletion=!1,void(r.entry.paused=i);if(this._updateHashLocked)return Oe(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=i);this.unscheduleUpdate(e)}var s,a=Yi.get(e,t,i,!1);0===t?(s=this._updates0List,this._appendIn(s,a)):(s=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(s,a,t)),this._hashForUpdates[n]=Qi.get(s,a,e,null)}else Le(1510)},i.unschedule=function(e,t){if(t&&e){var i=t.uuid||t.id;if(i){var n=this,r=n._hashForTimers[i];if(r)for(var s=r.timers,a=0,o=s.length;a<o;a++){var u=s[a];if(e===u._callback)return u!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),s.splice(a,1),Ki.put(u),r.timerIndex>=a&&r.timerIndex--,void(0===s.length&&(n._currentTarget===r?n._currentTargetSalvaged=!0:n._removeHashElement(r)))}}else Le(1510)}},i.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForUpdates[t];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}else Le(1510)}},i.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];if(i){var n=i.timers;n.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var r=0,s=n.length;r<s;r++)Ki.put(n[r]);n.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(e)}else Le(1510)}},i.unscheduleAll=function(){this.unscheduleAllWithMinPriority(fe.Scheduler.PRIORITY_SYSTEM)},i.unscheduleAllWithMinPriority=function(e){var t,i,n,r=this._arrayForTimers;for(t=r.length-1;t>=0;t--)i=r[t],this.unscheduleAllForTarget(i.target);var s=0;if(e<0)for(t=0;t<this._updatesNegList.length;)s=this._updatesNegList.length,(n=this._updatesNegList[t])&&n.priority>=e&&this.unscheduleUpdate(n.target),s===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)s=this._updates0List.length,(n=this._updates0List[t])&&this.unscheduleUpdate(n.target),s===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)s=this._updatesPosList.length,(n=this._updatesPosList[t])&&n.priority>=e&&this.unscheduleUpdate(n.target),s===this._updatesPosList.length&&t++},i.isScheduled=function(e,t){Be(e,1508),Be(t,1509);var i=t.uuid||t.id;if(i){var n=this._hashForTimers[i];if(!n)return!1;if(null==n.timers)return!1;for(var r=n.timers,s=0;s<r.length;++s)if(e===r[s]._callback)return!0;return!1}Le(1510)},i.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(fe.Scheduler.PRIORITY_SYSTEM)},i.pauseAllTargetsWithMinPriority=function(e){var t,i,n,r,s=[],a=this._arrayForTimers;for(i=0,n=a.length;i<n;i++)(t=a[i])&&(t.paused=!0,s.push(t.target));if(e<0)for(i=0;i<this._updatesNegList.length;i++)(r=this._updatesNegList[i])&&r.priority>=e&&(r.paused=!0,s.push(r.target));if(e<=0)for(i=0;i<this._updates0List.length;i++)(r=this._updates0List[i])&&(r.paused=!0,s.push(r.target));for(i=0;i<this._updatesPosList.length;i++)(r=this._updatesPosList[i])&&r.priority>=e&&(r.paused=!0,s.push(r.target));return s},i.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},i.pauseTarget=function(e){Be(e,1503);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!0);var n=this._hashForUpdates[t];n&&(n.entry.paused=!0)}else Le(1510)},i.resumeTarget=function(e){Be(e,1504);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!1);var n=this._hashForUpdates[t];n&&(n.entry.paused=!1)}else Le(1510)},i.isTargetPaused=function(e){Be(e,1505);var t=e.uuid||e.id;if(!t)return Le(1510),!1;var i=this._hashForTimers[t];if(i)return i.paused;var n=this._hashForUpdates[t];return!!n&&n.entry.paused},i._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var i=this._arrayForTimers,n=0,r=i.length;n<r;n++)if(i[n]===e){i.splice(n,1);break}Ji.put(e)},i._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,i=this._hashForUpdates[t];if(i){for(var n=i.list,r=i.entry,s=0,a=n.length;s<a;s++)if(n[s]===r){n.splice(s,1);break}delete this._hashForUpdates[t],Yi.put(r),Qi.put(i)}},i._priorityIn=function(e,t,i){for(var n=0;n<e.length;n++)if(i<e[n].priority)return void e.splice(n,0,t);e.push(t)},i._appendIn=function(e,t){e.push(t)},t}(Gi));Zi.PRIORITY_SYSTEM=1<<31,Zi.PRIORITY_NON_SYSTEM=Zi.PRIORITY_SYSTEM+1,Zi.ID="scheduler",fe.Scheduler=Zi;var $i=function(){function e(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=Ge,this._cameras=[]}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}};var t=e.prototype;return t.initialize=function(e,t){this._poolHandle=He.alloc(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchainBufferIndices&&(this._swapchainBufferIndices=t.swapchainBufferIndices),void 0!==t.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=t.shouldSyncSizeWithSwapchain),this._width=t.width,this._height=t.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var i=t.renderPassInfo,n=i.colorAttachments,r=i.depthStencilAttachment,s=0;s<n.length;s++)n[s].format===ye.UNKNOWN&&(n[s].format=e.colorFormat);r&&r.format===ye.UNKNOWN&&(r.format=e.depthStencilFormat),this._renderPass=e.createRenderPass(t.renderPassInfo);for(var a=0;a<n.length;a++){var o=null;this._swapchainBufferIndices&1<<a?He.set(this._poolHandle,je.HAS_ON_SCREEN_ATTACHMENTS,1):(o=e.createTexture(new Ee(Se.TEX2D,Ne.COLOR_ATTACHMENT|Ne.SAMPLED,n[a].format,this._width,this._height)),He.set(this._poolHandle,je.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(o)}r&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=e.createTexture(new Ee(Se.TEX2D,Ne.DEPTH_STENCIL_ATTACHMENT|Ne.SAMPLED,r.format,this._width,this._height)),He.set(this._poolHandle,je.HAS_OFF_SCREEN_ATTACHMENTS,1)):He.set(this._poolHandle,je.HAS_ON_SCREEN_ATTACHMENTS,1));var u=ze.alloc(e,new qe(this._renderPass,this._colorTextures,this._depthStencilTexture));return He.set(this._poolHandle,je.FRAMEBUFFER,u),!0},t.destroy=function(){this.clearCameras(),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._poolHandle&&(ze.get(He.get(this._poolHandle,je.FRAMEBUFFER)).destroy(),this._poolHandle=Ge)},t.resize=function(e,t){if(this._width=e,this._height=t,e>this._nativeWidth||t>this._nativeHeight){this._nativeWidth=e,this._nativeHeight=t;var i=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(e,t),i=!0);for(var n=0;n<this._colorTextures.length;n++){var r=this._colorTextures[n];r&&(r.resize(e,t),i=!0)}var s=ze.get(He.get(this._poolHandle,je.FRAMEBUFFER));i&&s&&(s.destroy(),s.initialize(new qe(this._renderPass,this._colorTextures,this._depthStencilTexture)))}for(var a,o=Xe(this._cameras);!(a=o()).done;){var u=a.value;u.isWindowSize&&u.resize(e,t)}},t.extractRenderCameras=function(e){for(var t=0;t<this._cameras.length;t++){var i=this._cameras[t];i.enabled&&(i.update(),e.push(i))}},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(e,t){return e.priority-t.priority}))},ke(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return ze.get(He.get(this._poolHandle,je.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===He.get(this._poolHandle,je.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===He.get(this._poolHandle,je.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}},{key:"cameras",get:function(){return this._cameras}}]),e}(),en=function(){function e(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=Ge,this._useDeferredPipeline=!1,this._device=e,this._dataPoolMgr=fe.internal.DataPoolManager&&new fe.internal.DataPoolManager(e),Ai.registerCreateFunc(this),$i.registerCreateFunc(this),this._cameraPool=new tt((function(){return new yi(t._device)}),4)}var t=e.prototype;return t.initialize=function(){var e=this;this._poolHandle=Ye.alloc();var t=new Qe,i=new Je;i.depthStoreOp=Ke.DISCARD,i.stencilStoreOp=Ke.DISCARD;var n=new Ze([t],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:n,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve($e.initBuiltinRes(this._device)).then((function(){fe.view.on("design-resolution-changed",(function(){var t=fe.game.canvas.width,i=fe.game.canvas.height;e.resize(t,i)}),e)}))},t.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(Ye.free(this._poolHandle),this._poolHandle=Ge)},t.resize=function(e,t){this._device.resize(e,t),this._mainWindow.resize(e,t);for(var i,n=Xe(this._windows);!(i=n()).done;){var r=i.value;r.shouldSyncSizeWithSwapchain&&r.resize(e,t)}this._pipeline&&this._pipeline.resize(e,t)},t.setRenderPipeline=function(e){if(e instanceof mi&&(this._useDeferredPipeline=!0),e||(e=ji()),this._pipeline=e,!this._pipeline.activate())return!1;var t=fe.director.getScene();return t&&t.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&fe.internal.Batcher2D&&(this._batcher=new fe.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},t.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.initDeferredPassInfo()},t.activeWindow=function(e){this._curWindow=e},t.resetCumulativeTime=function(){Ye.set(this._poolHandle,et.CUMULATIVE_TIME,0)},t.frameMove=function(e){Ye.set(this._poolHandle,et.FRAME_TIME,e),++this._frameCount,Ye.set(this._poolHandle,et.CUMULATIVE_TIME,Ye.get(this._poolHandle,et.CUMULATIVE_TIME)+e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var t=0;t<this._scenes.length;++t)this._scenes[t].removeBatches();this._batcher&&this._batcher.update();for(var i=this._windows,n=[],r=0;r<i.length;r++)i[r].extractRenderCameras(n);if(this._pipeline&&n.length>0){this._device.acquire();var s=this._scenes,a=fe.director.getTotalFrames();this._batcher&&this._batcher.uploadBuffers();for(var o=0;o<s.length;o++)s[o].update(a);fe.director.emit(fe.Director.EVENT_BEFORE_COMMIT),n.sort((function(e,t){return e.priority-t.priority})),this._pipeline.render(n),this._device.present()}this._batcher&&this._batcher.reset()},t.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},t.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},t.destroyWindows=function(){for(var e,t=Xe(this._windows);!(e=t()).done;)e.value.destroy();this._windows=[]},t.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},t.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},t.destroyScenes=function(){for(var e,t=Xe(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes=[]},t.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new tt((function(){return new e}),10)),t=this._modelPools.get(e));var i=t.alloc();return i.initialize(),i},t.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):Ue(1300,e.constructor.name)},t.createCamera=function(){return this._cameraPool.alloc()},t.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new tt((function(){return new e}),4)),t=this._lightPools.get(e));var i=t.alloc();return i.initialize(),i},t.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case vi.SPHERE:e.scene.removeSphereLight(e);break;case vi.SPOT:e.scene.removeSpotLight(e)}},ke(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",get:function(){return this._curWindow},set:function(e){this._curWindow=e}},{key:"tempWindow",get:function(){return this._tempWindow},set:function(e){this._tempWindow=e}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return Ye.get(this._poolHandle,et.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return Ye.get(this._poolHandle,et.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",get:function(){return this._fixedFPS},set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}},{key:"useDeferredPipeline",get:function(){return this._useDeferredPipeline}}]),e}();fe.Root=en;var tn={};it(tn,"vmath",[{name:"vec2",newName:"Vec2",target:Vi,targetName:"math"},{name:"vec3",newName:"Vec3",target:Vi,targetName:"math"},{name:"vec4",newName:"Vec4",target:Vi,targetName:"math"},{name:"quat",newName:"Quat",target:Vi,targetName:"math"},{name:"mat3",newName:"Mat3",target:Vi,targetName:"math"},{name:"mat4",newName:"Mat4",target:Vi,targetName:"math"},{name:"color4",newName:"Color",target:Vi,targetName:"math"},{name:"rect",newName:"Rect",target:Vi,targetName:"math"},{name:"approx",newName:"approx",target:Vi,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:Vi,targetName:"math"},{name:"equals",newName:"equals",target:Vi,targetName:"math"},{name:"clamp",newName:"clamp",target:Vi,targetName:"math"},{name:"clamp01",newName:"clamp01",target:Vi,targetName:"math"},{name:"lerp",newName:"lerp",target:Vi,targetName:"math"},{name:"toRadian",newName:"toRadian",target:Vi,targetName:"math"},{name:"toDegree",newName:"toDegree",target:Vi,targetName:"math"},{name:"random",newName:"random",target:Vi,targetName:"math"},{name:"randomRange",newName:"randomRange",target:Vi,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:Vi,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:Vi,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:Vi,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:Vi,targetName:"math"},{name:"repeat",newName:"repeat",target:Vi,targetName:"math"},{name:"pingPong",newName:"pingPong",target:Vi,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:Vi,targetName:"math"}]),fe.vmath=tn,it(Zi.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:Zi,targetName:"Scheduler"}]),it(wi.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:wi,targetName:"EventTouch"}]),it(Ei.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),nt(Ei.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),it(en.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]);var nn=e("D",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._purgeDirectorInNextLoop=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._lastUpdate=void 0,t._deltaTime=void 0,t._startTime=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._lastUpdate=0,t._deltaTime=0,t._startTime=0,t._scheduler=new Zi,t._compScheduler=new Mi,t._nodeActivator=new Bi,t._systems=[],fe.game.once(Ti.EVENT_RENDERER_INITED,t._initOnRendererInitialized,ut(t)),t}Me(t,e);var i=t.prototype;return i.calculateDeltaTime=function(e){e||(e=performance.now()),this._deltaTime=e>this._lastUpdate?(e-this._lastUpdate)/1e3:0,this._lastUpdate=e},i.convertToGL=function(e){var t=fe.game.container,i=fe.view,n=t.getBoundingClientRect(),s=n.left+window.pageXOffset-t.clientLeft,a=n.top+window.pageYOffset-t.clientTop,o=i._devicePixelRatio*(e.x-s),u=i._devicePixelRatio*(a+n.height-e.y);return i._isRotated?r(i._viewportRect.width-u,o):r(o,u)},i.convertToUI=function(e){var t=fe.game.container,i=fe.view,n=t.getBoundingClientRect(),s=n.left+window.pageXOffset-t.clientLeft,a=n.top+window.pageYOffset-t.clientTop,o=r(0,0);return i._isRotated?(o.x=s+e.y/i._devicePixelRatio,o.y=a+n.height-(i._viewportRect.width-e.x)/i._devicePixelRatio):(o.x=s+e.x*i._devicePixelRatio,o.y=a+n.height-e.y*i._devicePixelRatio),o},i.end=function(){this._purgeDirectorInNextLoop=!0},i.getWinSize=function(){return g(fe.winSize)},i.getWinSizeInPixels=function(){return g(fe.winSize)},i.pause=function(){this._paused||(this._paused=!0)},i.purgeCachedData=function(){fe.assetManager.releaseAll()},i.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),rt&&rt.setEnabled(!1),fe.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),fe.assetManager.releaseAll()},i.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),rt&&rt.setEnabled(!0),this.startAnimation()},i.runSceneImmediate=function(e,t,i){e instanceof Di&&(e=e.scene),Be(e instanceof Fi,1216),e._load();for(var n=Object.keys(fe.game._persistRootNodes).map((function(e){return fe.game._persistRootNodes[e]})),r=0;r<n.length;r++){var s=n[r];s.emit(fe.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var a=e.uuid===s._originalSceneId&&e.getChildByUuid(s.uuid);if(a){var o=a.getSiblingIndex();a._destroyImmediate(),e.insertChild(s,o)}else s.parent=e}var u=this._scene;fe.isValid(u)&&u.destroy(),fe.assetManager._releaseManager._autoRelease(u,e,fe.game._persistRootNodes),this._scene=null,st._deferredDestroy(),t&&t(),this.emit(fe.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),i&&i(null,e),this.emit(fe.Director.EVENT_AFTER_SCENE_LAUNCH,e)},i.runScene=function(e,t,i){var n=this;e instanceof Di&&(e=e.scene),Be(e,1205),Be(e instanceof Fi,1216),e._load(),this.once(fe.Director.EVENT_AFTER_DRAW,(function(){n.runSceneImmediate(e,t,i)}))},i.loadScene=function(e,t,i){var n=this;if(this._loadingScene)return Ue(1208,e,this._loadingScene),!1;var r=fe.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));return r?(this.emit(fe.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),r.loadScene(e,(function(r,s){console.timeEnd("LoadScene "+e),n._loadingScene="",r?(ce(r),t&&t(r)):n.runSceneImmediate(s,i,t)})),!0):(Le(1209,e),!1)},i.preloadScene=function(e,t,i){var n=fe.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));if(n)n.preloadScene(e,null,t,i);else{var r='Can not preload the scene "'+e+'" because it is not in the build settings.';i&&i(new Error(r)),ce("preloadScene: "+r)}},i.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||Oe(1200),this._paused=!1,this._deltaTime=0)},i.setDepthTest=function(e){fe.Camera.main&&(fe.Camera.main.depth=!!e)},i.setClearColor=function(e){fe.Camera.main&&(fe.Camera.main.backgroundColor=e)},i.getRunningScene=function(){return this._scene},i.getScene=function(){return this._scene},i.getAnimationInterval=function(){return 1e3/fe.game.getFrameRate()},i.setAnimationInterval=function(e){fe.game.setFrameRate(Math.round(1e3/e))},i.getDeltaTime=function(){return this._deltaTime},i.getTotalTime=function(){return performance.now()-this._startTime},i.getCurrentTime=function(){return this._lastUpdate},i.getTotalFrames=function(){return this._totalFrames},i.isPaused=function(){return this._paused},i.getScheduler=function(){return this._scheduler},i.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(Zi.ID,e,200))},i.registerSystem=function(e,t,i){t.id=e,t.priority=i,t.init(),this._systems.push(t),this._systems.sort(Gi.sortByPriority)},i.unregisterSystem=function(e){at.fastRemove(this._systems,e),this._systems.sort(Gi.sortByPriority)},i.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},i.getAnimationManager=function(){return this.getSystem(fe.AnimationManager.ID)},i.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},i.stopAnimation=function(){this._invalid=!0},i.mainLoop=function(e){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(e);var i=this._deltaTime;if(!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(i);for(var n=0;n<this._systems.length;++n)this._systems[n].update(i);this._compScheduler.lateUpdatePhase(i),this.emit(t.EVENT_AFTER_UPDATE),st._deferredDestroy();for(var r=0;r<this._systems.length;++r)this._systems[r].postUpdate(i)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(t.EVENT_AFTER_DRAW),rt.frameUpdateListeners(),ot.resetHasChangedFlags(),ot.clearNodeArray(),this._totalFrames++}},i._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,rt&&rt.setEnabled(!0),this.registerSystem(Zi.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},i._init=function(){return this._root=new en(fe.game._gfxDevice),this._root.initialize({}).catch((function(e){return Le(1217),Promise.reject(e)}))},ke(t,[{key:"root",get:function(){return this._root}}]),t}(lt));nn.EVENT_INIT="director_init",nn.EVENT_RESET="director_reset",nn.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",nn.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",nn.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",nn.EVENT_BEFORE_UPDATE="director_before_update",nn.EVENT_AFTER_UPDATE="director_after_update",nn.EVENT_BEFORE_DRAW="director_before_draw",nn.EVENT_AFTER_DRAW="director_after_draw",nn.EVENT_BEFORE_COMMIT="director_before_commit",nn.EVENT_BEFORE_PHYSICS="director_before_physics",nn.EVENT_AFTER_PHYSICS="director_after_physics",nn.instance=void 0,fe.Director=nn;var rn=e("f",nn.instance=fe.director=new nn),sn=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new ht,this.scenes=new ht,this.paths=new ht}var t=e.prototype;return t.init=function(e){!function(e){var t=e.uuids,i=e.paths,n=e.types,r=e.deps,s=e.paths=Object.create(null);if(!1===e.debug){for(var a=0,o=t.length;a<o;a++)t[a]=ft(t[a]);for(var u in i){var l=i[u],h=l[1];l[1]=n[h]}}else{for(var c=Object.create(null),d=0,f=t.length;d<f;d++){var p=t[d];t[d]=c[p]=ft(p)}t=c}for(var _ in i){var g=i[_];s[t[_]]=g}var m=e.scenes;for(var v in m){var y=m[v];m[v]=t[y]}var w=e.packs;for(var T in w)for(var b=w[T],A=0;A<b.length;++A)b[A]=t[b[A]];var E=e.versions;if(E)for(var S in E)for(var N=E[S],R=0;R<N.length;R+=2){var I=N[R];N[R]=t[I]||I}var x=e.redirect;if(x)for(var C=0;C<x.length;C+=2)x[C]=t[x[C]],x[C+1]=r[x[C+1]]}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect)},t.getInfoWithPath=function(e,t){if(!e)return null;e=ct(e);var i=this.paths.get(e);if(i){if(!t)return i[0];for(var n=0,r=i.length;n<r;n++){var s=i[n];if(dt.isChildClassOf(s.ctor,t))return s}}return null},t.getDirWithPath=function(e,t,i){"/"===(e=ct(e))[e.length-1]&&(e=e.slice(0,-1));var n=i||[];return this.paths.forEach((function(i,r){if(r.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(r,e)||!e)for(var s=0,a=i.length;s<a;s++){var o=i[s];t&&!dt.isChildClassOf(o.ctor,t)||n.push(o)}})),n},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,i){return i.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,i=e.length;t<i;t++){var n=e[t];this.assetInfos.add(n,{uuid:n})}}},t._initPath=function(e){if(e){var t=this.paths;for(var i in t.clear(),e){var n=e[i],r=n[0],s=n[1],a=3===n.length,o=this.assetInfos.get(i);o.path=r,o.ctor=dt._getClassById(s),t.has(r)?a?t.get(r).push(o):t.get(r).splice(0,0,o):t.add(r,[o])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var i=this.assetInfos;for(var n in e){var r=e[n],s=i.get(r);s.url=n,t.add(n,s)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var i in e){var n=e[i],r={uuid:i,packedUuids:n,ext:".json"};t.add(i,r);for(var s=0,a=n.length;s<a;s++){var o=n[s],u=t.get(o),l=u.packs;l?1===a?l.splice(0,0,r):l.push(r):u.packs=[r]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,i=e.import;if(i)for(var n=0,r=i.length;n<r;n+=2){var s=i[n];t.get(s).ver=i[n+1]}if(i=e.native)for(var a=0,o=i.length;a<o;a+=2){var u=i[a];t.get(u).nativeVer=i[a+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,i=0,n=e.length;i<n;i+=2){var r=e[i];t.get(r).redirect=e[i+1]}},e}();function an(e,t){e._uuid&&t.push(e._uuid)}function on(e,t){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n];if("node"!==r&&"__eventTargets"!==r){var s=e[r];if("object"==typeof s&&s)if(Array.isArray(s))for(var a=0;a<s.length;a++){var o=s[a];o instanceof gt&&an(o,t)}else if(s.constructor&&s.constructor!==Object)s instanceof gt&&an(s,t);else for(var u=Object.getOwnPropertyNames(s),l=0;l<u.length;l++){var h=s[u[l]];h instanceof gt&&an(h,t)}}}}function un(e,t){for(var i=0;i<e._components.length;i++)on(e._components[i],t);for(var n=0;n<e._children.length;n++)un(e._children[n],t)}function ln(e,t,i,n){i.push(e._uuid);for(var r=_t.getDeps(e._uuid),s=0,a=r.length;s<a;s++){var o=pt.get(r[s]);if(o){var u=o._uuid;u in t?t[u]+=n:t[u]=o.refCount+n,i.includes(u)||ln(o,t,i,n)}}}var hn=[],cn=new(function(){function e(){this._persistNodeDeps=new ht,this._toDelete=new ht,this._eventListener=!1}var t=e.prototype;return t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];un(e,t);for(var i=0,n=t.length;i<n;i++){var r=pt.get(t[i]);r&&r.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),i=0,n=t.length;i<n;i++){var r=pt.get(t[i]);r&&r.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,i){if(e){for(var n=_t.getDeps(e.uuid),r=0,s=n.length;r<s;r++){var a=pt.get(n[r]);a&&a.decRef(e.autoReleaseAssets)}var o=_t._depends.get(e.uuid);if(o&&o.persistDeps)for(var u=o.persistDeps,l=0,h=u.length;l<h;l++){var c=pt.get(u[l]);c&&c.decRef(e.autoReleaseAssets)}e.uuid!==t.uuid&&_t.remove(e.uuid)}var d=_t._depends.get(t.uuid);for(var f in d&&(d.persistDeps=[]),i){for(var p,_,g=i[f],m=this._persistNodeDeps.get(g.uuid),v=Xe(m);!(_=v()).done;){var y=_.value,w=pt.get(y);w&&w.addRef()}d&&(p=d.persistDeps).push.apply(p,m)}},t.tryRelease=function(e,t){void 0===t&&(t=!1),e instanceof gt&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,mt(this._freeAssets.bind(this)))))},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var i=e._uuid;if(this._toDelete.remove(i),vt(e,!0)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,ln(e,t,hn,-1),hn.length=0,0!==t[e._uuid])return t[e._uuid];for(var i in t)0!==t[i]&&ln(pt.get(i),t,hn,1);return hn.length=0,t[e._uuid]}(e)>0)){pt.remove(i);for(var n=_t.getDeps(i),r=0,s=n.length;r<s;r++){var a=pt.get(n[r]);a&&(a.decRef(!1),this._free(a,!1))}e.destroy(),_t.remove(i)}},e}()),dn=null;function fn(e,t){for(var i=0,n=e.input.length;i<n;i++){var r=e.input[i];t&&!r.isNative&&r.content instanceof gt&&r.content.decRef(!1),r.recycle()}e.input=null}function pn(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function _n(e,t,i,n,r){void 0===r&&(r=0),e(r,(function(s,a){r++,!s||r>t?n&&n(s,a):setTimeout((function(){_n(e,t,i,n,r)}),i)}))}function gn(e,t,i,n,r){try{for(var s=_t.parse(e,t),a=0,o=s.deps.length;a<o;a++){var u=s.deps[a];u in i||(i[u]=!0,n.push({uuid:u,bundle:r&&r.name}))}s.nativeDep&&(r&&(s.nativeDep.bundle=r.name),n.push(yt({},s.nativeDep)))}catch(e){ce(e.message,e.stack)}}function mn(e,t,i){t&&(i=void 0!==i?i:fe.assetManager.cacheAsset,wt(t)||!i||t.isDefault||pt.add(e,t))}function vn(e,t,i){var n=0,r=[],s=e.length;0===s&&i&&i(r);for(var a=function(e){e&&r.push(e),++n===s&&i&&i(r)},o=0;o<s;o++)t(e[o],a)}function yn(e,t,i){var n=e,r=t,s=i;if(void 0===i){var a="function"==typeof e;t?(s=t,a||(r=null)):void 0===t&&a&&(s=e,n=null,r=null),void 0!==t&&a&&(r=e,n=null)}return{options:n||Object.create(null),onProgress:r,onComplete:s}}function wn(e,t,i){var n=e,r=t,s=i;if(void 0===i){var a=dt.isChildClassOf(e,gt);t?(s=t,a&&(r=null)):void 0!==t||a||(s=e,r=null,n=null),void 0===t||a||(r=e,n=null)}return{type:n,onProgress:r||dn,onComplete:s}}function Tn(e,t,i,n){if(void 0===n&&(n={}),!i[t]||n[t])return!1;n[t]=!0;var r=!1,s=_t.getDeps(t);if(s)for(var a=0,o=s.length;a<o;a++){var u=s[a];if(u===e||Tn(e,u,i,n)){r=!0;break}}return r}function bn(e){return function(t,i){if(e){var n=[];Array.isArray(i)?i.forEach((function(e){return e instanceof gt&&n.push(e.addRef())})):i instanceof gt&&n.push(i.addRef()),mt((function(){n.forEach((function(e){return e.decRef(!1)})),e(t,i)}))}}}var An=function(){function e(){this._config=new sn}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,i){return this._config.getDirWithPath(e,t,i)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),Tt.add(e.name,this)},t.load=function(e,t,i,n){var r=wn(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete,u={__requestType__:bt.PATH,type:s,bundle:this.name,__outputAsArray__:Array.isArray(e)};fe.assetManager.loadAny(e,u,a,o)},t.preload=function(e,t,i,n){var r=wn(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;fe.assetManager.preloadAny(e,{__requestType__:bt.PATH,type:s,bundle:this.name},a,o)},t.loadDir=function(e,t,i,n){var r=wn(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;fe.assetManager.loadAny(e,{__requestType__:bt.DIR,type:s,bundle:this.name,__outputAsArray__:!0},a,o)},t.preloadDir=function(e,t,i,n){var r=wn(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;fe.assetManager.preloadAny(e,{__requestType__:bt.DIR,type:s,bundle:this.name},a,o)},t.loadScene=function(e,t,i,n){var r=yn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.preset=s.preset||"scene",s.bundle=this.name,fe.assetManager.loadAny({scene:e},s,a,(function(e,t){if(e)ce(e.message,e.stack);else if(t instanceof Di&&t.scene){var i=t.scene;i._id=t._uuid,i.name=t.name}else e=new Error("The asset "+t._uuid+" is not a scene");o&&o(e,t)}))},t.preloadScene=function(e,t,i,n){var r=yn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.bundle=this.name,fe.assetManager.preloadAny({scene:e},s,a,(function(t){t&&Le(1210,e,t.message),o&&o(t)}))},t.get=function(e,t){var i=this.getInfoWithPath(e,t);return i&&pt.get(i.uuid)||null},t.release=function(e,t){var i=this.get(e,t);i&&cn.tryRelease(i,!0)},t.releaseUnusedAssets=function(){var e=this;pt.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&cn.tryRelease(t)}))},t.releaseAll=function(){var e=this;pt.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&cn.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},ke(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),En=e("r",new An);function Sn(e,t,i){var n=new Image;function r(){n.removeEventListener("load",r),n.removeEventListener("error",s),i&&i(null,n)}function s(){n.removeEventListener("load",r),n.removeEventListener("error",s),i&&i(new Error(At(4930,e)))}return"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.addEventListener("load",r),n.addEventListener("error",s),n.src=e,n}function Nn(e,t,i,n){var r=new XMLHttpRequest,s="download failed: "+e+", status: ";if(r.open("GET",e,!0),void 0!==t.xhrResponseType&&(r.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(r.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(r.timeout=t.xhrTimeout),t.xhrHeader)for(var a in t.xhrHeader)r.setRequestHeader(a,t.xhrHeader[a]);return r.onload=function(){200===r.status||0===r.status?n&&n(null,r.response):n&&n(new Error(""+s+r.status+"(no response)"))},i&&(r.onprogress=function(e){e.lengthComputable&&i(e.loaded,e.total)}),r.onerror=function(){n&&n(new Error(""+s+r.status+"(error)"))},r.ontimeout=function(){n&&n(new Error(""+s+r.status+"(time out)"))},r.onabort=function(){n&&n(new Error(""+s+r.status+"(abort)"))},r.send(null),r}fe.resources=En;var Rn={};function In(e,t,i){if(Rn[e])return i&&i(null),null;var n=document.createElement("script");function r(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",s,!1),Rn[e]=!0,i&&i(null)}function s(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",s,!1),i&&i(new Error(At(4928,e)))}return"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.async=t.scriptAsyncLoading||!1,n.src=e,n.addEventListener("load",r,!1),n.addEventListener("error",s,!1),document.body.appendChild(n),n}var xn=/^(?:\w+:\/\/|\.+\/).+/,Cn=function(e,t,i){(Rt.capabilities.imageBitmap&&fe.assetManager.allowImageBitmap?Pn:Sn)(e,t,i)},Pn=function(e,t,i){t.xhrResponseType="blob",Nn(e,t,t.onFileProgress,i)},kn=function(e,t,i){t.xhrResponseType="json",Nn(e,t,t.onFileProgress,i)},Dn=function(e,t,i){t.xhrResponseType="arraybuffer",Nn(e,t,t.onFileProgress,i)},Fn=function(e,t,i){t.xhrResponseType="text",Nn(e,t,t.onFileProgress,i)},Mn=function(e,t,i){var n=It(e),r=e;xn.test(r)||(r=-1!==Ln.remoteBundles.indexOf(n)?Ln.remoteServerAddress+"remote/"+n:"assets/"+n);var s=t.version||Ln.bundleVers[n],a=0,o=null,u=null;kn(r+"/config."+(s?s+".":"")+"json",t,(function(e,t){u=e,(o=t)&&(o.base=r+"/"),2==++a&&i(u,o)})),In(r+"/index."+(s?s+".":"")+"js",t,(function(e){u=e,2==++a&&i(e,o)}))},Bn=function(){function e(){this.maxConcurrency=6,this.maxRequestsPerFrame=6,this.maxRetryCount=3,this.appendTimeStamp=!!Nt,this.limited=!Nt,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=Sn,this.downloadDomAudio=null,this.downloadFile=Nn,this.downloadScript=In,this._downloaders={".png":Cn,".jpg":Cn,".bmp":Cn,".jpeg":Cn,".gif":Cn,".ico":Cn,".tiff":Cn,".webp":Cn,".image":Cn,".pvr":Dn,".pkm":Dn,".astc":Dn,".txt":Fn,".xml":Fn,".vsh":Fn,".fsh":Fn,".atlas":Fn,".tmx":Fn,".tsx":Fn,".json":kn,".ExportJson":kn,".plist":Fn,".fnt":Fn,".binary":Dn,".bin":Dn,".dbbin":Dn,".skel":Dn,".js":In,bundle:Mn,default:Fn},this._downloading=new ht,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var t=e.prototype;return t.init=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t={}),void 0===i&&(i=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=i},t.register=function(e,t){"object"==typeof e?Et(this._downloaders,e):this._downloaders[e]=t},t.download=function(e,t,i,n,r){var s=this,a=St.get(e);if(a)r(null,a);else{var o=this._downloading.get(e);if(o){o.push(r);var u=this._queue.find((function(t){return t.id===e}));if(!u)return;var l=n.priority||0;u.priority<l&&(u.priority=l,this._queueDirty=!0)}else{var h=void 0!==n.maxRetryCount?n.maxRetryCount:this.maxRetryCount,c=void 0!==n.maxConcurrency?n.maxConcurrency:this.maxConcurrency,d=void 0!==n.maxRequestsPerFrame?n.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[i]||this._downloaders.default;_n((function(i,a){if(0===i&&s._downloading.add(e,[r]),s.limited){s._updateTime();var o=function(e,t){s._totalNum--,s._handleQueueInNextFrame(c,d),a(e,t)};s._totalNum<c&&s._totalNumThisPeriod<d?(f(pn(t,s.appendTimeStamp),n,o),s._totalNum++,s._totalNumThisPeriod++):(s._queue.push({id:e,priority:n.priority||0,url:t,options:n,done:o,handler:f}),s._queueDirty=!0,s._totalNum<c&&s._handleQueueInNextFrame(c,d))}else f(pn(t,s.appendTimeStamp),n,a)}),h,this.retryInterval,(function(t,i){t||St.add(e,i);for(var n=s._downloading.remove(e),r=0,a=n.length;r<a;r++)n[r](t,i)}))}}},t.loadSubpackage=function(e,t){fe.assetManager.loadBundle(e,null,t)},t._updateTime=function(){var e=Date.now(),t=fe.director.getDeltaTime(),i=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*i&&(this._totalNumThisPeriod=0,this._lastDate=e)},t._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var i=this._queue.pop();if(!i)break;this._totalNum++,this._totalNumThisPeriod++,i.handler(pn(i.url,this.appendTimeStamp),i.options,i.done)}this._handleQueueInNextFrame(e,t)},t._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&(mt(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},ke(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),e}(),Ln=e("x",new Bn);function Un(e,t,i,n){var r=null,s=null;try{(r=new xt)._nativeUrl=e,r._nativeAsset=t}catch(e){s=e}n(s,r)}function On(e,t,i,n){var r=new Li;r.json=t,n(null,r)}function Wn(e,t,i,n){var r=new Ui;r.text=t,n(null,r)}function Vn(e,t,i,n){var r=new Oi;r._nativeUrl=e,r._nativeAsset=t,n(null,r)}function Hn(e,t,i,n){var r=new gt;r._nativeUrl=e,r._nativeAsset=t,n(null,r)}function jn(e,i,n,r){var s=Tt.get(i.name);s||(s=i.name===Ct.RESOURCES?En:new An,i.base=i.base||e+"/",s.init(i)),t.import("virtual:///prerequisite-imports/"+s.name).then((function(){r(null,s)})).catch(r)}var zn=function(){function e(){this._creating=new ht,this._producers={".png":Un,".jpg":Un,".bmp":Un,".jpeg":Un,".gif":Un,".ico":Un,".tiff":Un,".webp":Un,".image":Un,".pvr":Un,".pkm":Un,".txt":Wn,".xml":Wn,".vsh":Wn,".fsh":Wn,".atlas":Wn,".tmx":Wn,".tsx":Wn,".fnt":Wn,".json":On,".ExportJson":On,".binary":Vn,".bin":Vn,".dbbin":Vn,".skel":Vn,bundle:jn,default:Hn}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?dt.mixin(this._producers,e):this._producers[e]=t},t.create=function(e,t,i,n,r){var s=this,a=this._producers[i]||this._producers.default,o=pt.get(e);if(n.reloadAsset||!o){var u=this._creating.get(e);u?u.push(r):(this._creating.add(e,[r]),a(e,t,n,(function(t,i){!t&&i instanceof gt&&(i._uuid=e,mn(e,i,n.cacheAsset));for(var r=s._creating.remove(e),a=0,o=r.length;a<o;a++)r[a](t,i)})))}else r(null,o)},e}(),qn=e("y",new zn),Gn=new(function(){function e(){this._loading=new ht,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,i,n){var r=dt.createMap(!0),s=null;if(Array.isArray(t)){(t=Pt(t)).length!==e.length&&Le(4915);for(var a=0;a<e.length;a++)r[e[a]+"@import"]=t[a]}else{var o=dt._getClassId(kt),u=dt._getClassId(xt);if(t.type===o&&t.data){var l=t.data;l.length!==e.length&&Le(4915);for(var h=0;h<e.length;h++)r[e[h]+"@import"]=Dt(o,{base:l[h][0],mipmaps:l[h][1]})}else if(t.type===u&&t.data){var c=t.data;c.length!==e.length&&Le(4915);for(var d=0;d<e.length;d++)r[e[d]+"@import"]=c[d]}else s=new Error("unmatched type pack!"),r=null}n(s,r)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?dt.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,i,n,r){t?(0,this._unpackers[i])(e,t,n,r):r(new Error("package data is wrong!"))},t.load=function(e,t,i){var n=this;if(!e.isNative&&e.info&&e.info.packs)if(St.has(e.id))i(null,St.get(e.id));else{var r=e.info.packs,s=r.find((function(e){return n._loading.has(e.uuid)}));if(s)this._loading.get(s.uuid).push({onComplete:i,id:e.id});else{s=r[0],this._loading.add(s.uuid,[{onComplete:i,id:e.id}]);var a=Ft(s.uuid,{ext:s.ext,bundle:e.config.name});Ln.download(s.uuid,a,s.ext,e.options,(function(t,i){St.remove(s.uuid),t&&ce(t.message,t.stack),n.unpack(s.packedUuids,i,s.ext,e.options,(function(e,i){if(!e)for(var r in i)St.add(r,i[r]);for(var a=n._loading.remove(s.uuid),o=0,u=a.length;o<u;o++){var l=a[o];if(t||e)l.onComplete(t||e);else{var h=i[l.id];h?l.onComplete(null,h):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else Ln.download(e.id,e.url,e.ext,e.options,i)},e}());function Xn(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress,s=[],a=r.total,o=n.__exclude__=n.__exclude__||Object.create(null);e.output=[],vn(e.input,(function(n,u){if(!n.isNative&&pt.has(n.uuid)){var l=pt.get(n.uuid);return n.content=l.addRef(),e.output.push(n),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n),void u()}Gn.load(n,e.options,(function(l,h){l?e.isFinish||(!fe.assetManager.force||i?(ce(l.message,l.stack),r.canInvoke=!1,t(l)):(e.output.push(n),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n))):e.isFinish||(n.file=h,e.output.push(n),n.isNative||(o[n.uuid]=!0,gn(n.uuid,h,o,s,n.config),r.total=a+s.length),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n)),u()}))}),(function(){if(e.isFinish)return fn(e,!0),void e.dispatch("error");if(s.length>0){var a=Mt.create({input:s,progress:r,options:n,onProgress:e.onProgress,onError:Mt.prototype.recycle,onComplete:function(n){var r;n||((r=e.output).push.apply(r,a.output),a.recycle()),i&&Yn(e),t(n)}});Bt.async(a)}else i&&Yn(e),t()}))}function Yn(e){for(var t=e.output,i=0,n=t.length;i<n;i++)t[i].content&&t[i].content.decRef(!1)}var Qn=new(function(e){function t(){return e.apply(this,arguments)||this}Me(t,e);var i=t.prototype;return i.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return Ue(5100),{};for(var i=null,n=0,r=t.childNodes.length;n<r&&1!==(i=t.childNodes[n]).nodeType;n++);return this._parseNode(i)},i._parseNode=function(e){var t=null,i=e.tagName;if("dict"===i)t=this._parseDict(e);else if("array"===i)t=this._parseArray(e);else if("string"===i)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].nodeValue}else"false"===i?t=!1:"true"===i?t=!0:"real"===i?t=parseFloat(e.firstChild.nodeValue):"integer"===i&&(t=parseInt(e.firstChild.nodeValue,10));return t},i._parseArray=function(e){for(var t=[],i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&t.push(this._parseNode(r))}return t},i._parseDict=function(e){for(var t={},i="",n=0,r=e.childNodes.length;n<r;n++){var s=e.childNodes[n];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:t[i]=this._parseNode(s))}return t},t}(e("z",function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}())));function Jn(e,t){return e[t]<<8|e[t+1]}var Kn=new(function(){function e(){this._parsing=new ht,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,i){e instanceof HTMLImageElement?i(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){i(null,e)}),(function(e){i(e,null)}))},t.parseAudio=function(e,t,i){e instanceof ArrayBuffer?Rt.__audioSupport.context.decodeAudioData(e,(function(e){i(null,e)}),(function(e){i(new Error("Error with decoding audio data"+e.err),null)})):i(null,e)},t.parsePVRTex=function(e,t,i){var n=null,r=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,a=new Int32Array(s,0,13);if(55727696===a[0]){var o=a[7],u=a[6],l=a[12]+52;r={_data:new Uint8Array(s,l),_compressed:!0,width:o,height:u,format:0}}else{if(559044176!==a[11])throw new Error("Invalid magic number in PVR header");var h=a[0],c=a[1],d=a[2];r={_data:new Uint8Array(s,h),_compressed:!0,width:d,height:c,format:0}}}catch(e){n=e}i(n,r)},t.parsePKMTex=function(e,t,i){var n=null,r=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(s),o=Jn(a,6);if(0!==o&&1!==o&&3!==o)throw new Error("Invalid magic number in ETC header");var u=Jn(a,12),l=Jn(a,14);Jn(a,8),Jn(a,10),r={_data:new Uint8Array(s,16),_compressed:!0,width:u,height:l,format:0}}catch(e){n=e}i(n,r)},t.parseASTCTex=function(e,t,i){var n=null,r=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(s);if(1554098963!==a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24))throw new Error("Invalid magic number in ASTC header");var o=a[4],u=a[5],l=a[6];if((o<3||o>6||u<3||u>6||l<3||l>6)&&(o<4||7===o||9===o||11===o||o>12||u<4||7===u||9===u||11===u||u>12||1!==l))throw new Error("Invalid block number in ASTC header");var h=function(e,t){return 4===e?Ot.RGBA_ASTC_4x4:5===e?4===t?Ot.RGBA_ASTC_5x4:Ot.RGBA_ASTC_5x5:6===e?5===t?Ot.RGBA_ASTC_6x5:Ot.RGBA_ASTC_6x6:8===e?5===t?Ot.RGBA_ASTC_8x5:6===t?Ot.RGBA_ASTC_8x6:Ot.RGBA_ASTC_8x8:10===e?5===t?Ot.RGBA_ASTC_10x5:6===t?Ot.RGBA_ASTC_10x6:8===t?Ot.RGBA_ASTC_10x8:Ot.RGBA_ASTC_10x10:10===t?Ot.RGBA_ASTC_12x10:Ot.RGBA_ASTC_12x12}(o,u),c=a[7]+(a[8]<<8)+(a[9]<<16),d=a[10]+(a[11]<<8)+(a[12]<<16);a[13],a[14],a[15],r={_data:new Uint8Array(s,16),_compressed:!0,width:c,height:d,format:h}}catch(e){n=e}i(n,r)},t.parsePlist=function(e,t,i){var n=null,r=Qn.parse(e);r||(n=new Error("parse failed")),i(n,r)},t.parseImport=function(e,t,i){if(e){var n=null,r=null;try{n=Lt(e,t)}catch(e){r=e}i(r,n)}else i(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?Et(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,i,n,r){var s=this,a=Ut.get(e);if(a)r(null,a);else{var o=this._parsing.get(e);if(o)o.push(r);else{var u=this._parsers[i];u?(this._parsing.add(e,[r]),u(t,n,(function(t,i){t?St.remove(e):wt(i)||Ut.add(e,i);for(var n=s._parsing.remove(e),r=0,a=n.length;r<a;r++)n[r](t,i)}))):r(null,t)}}},e}());function Zn(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress;n.__exclude__=n.__exclude__||Object.create(null),e.output=[],vn(e.input,(function(s,a){var o=Mt.create({input:s,onProgress:e.onProgress,options:n,progress:r,onComplete:function(n,u){n&&!e.isFinish&&(!fe.assetManager.force||i?(ce(n.message,n.stack),r.canInvoke=!1,t(n)):r.canInvoke&&e.dispatch("progress",++r.finish,r.total,s)),e.output.push(u),o.recycle(),a(null)}});$n.async(o)}),(function(){if(n.__exclude__=null,e.isFinish)return fn(e,!0),void e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var i=e.output=[],n=0,r=t.length;n<r;n++)i.push(t[n].content);else e.output=t[0].content}(e),fn(e,!0),t()}))}var $n=new Wt("loadOneAsset",[function(e,t){var i=e.output=e.input,n=i.options,r=i.isNative,s=i.uuid,a=i.file,o=n.reloadAsset;a||!o&&!r&&pt.has(s)?t():Gn.load(i,e.options,(function(e,n){i.file=n,t(e)}))},function(e,t){var i=e.output=e.input,n=e.progress,r=e.options.__exclude__,s=i.id,a=i.file,o=i.options;if(i.isNative)Kn.parse(s,a,i.ext,o,(function(r,a){r?t(r):(i.content=a,n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),St.remove(s),Ut.remove(s),t())}));else{var u=i.uuid;if(u in r){var l=r[u],h=l.finish,c=l.content,d=l.err,f=l.callbacks;n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),h||Tn(u,u,r)?(c&&c.addRef(),i.content=c,t(d)):f.push({done:t,item:i})}else if(!o.reloadAsset&&pt.has(u)){var p=pt.get(u);i.content=p.addRef(),n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),t()}else o.__uuid__=u,Kn.parse(s,a,"import",o,(function(i,n){i?t(i):function(e,t,i){var n=e.input,r=e.progress,s=n,a=s.uuid,o=s.id,u=s.options,l=s.config,h=u.cacheAsset,c=[];t.addRef&&t.addRef(),gn(a,t,Object.create(null),c,l),r.canInvoke&&e.dispatch("progress",++r.finish,r.total+=c.length,n);var d=e.options.__exclude__[a]={content:t,finish:!1,callbacks:[{done:i,item:n}]},f=Mt.create({input:c,options:e.options,onProgress:e.onProgress,onError:Mt.prototype.recycle,progress:r,onComplete:function(e){if(t.decRef&&t.decRef(!1),d.finish=!0,d.err=e,!e){for(var i,n=Array.isArray(f.output)?f.output:[f.output],r=Object.create(null),s=Xe(n);!(i=s()).done;){var u=i.value;u&&(r[u instanceof gt?u._uuid+"@import":a+"@native"]=u)}!function(e,t,i){var n=t.__depends__;if(n){for(var r=0,s=n.length;r<s;r++){var a=n[r],o=i[a.uuid+"@import"];if(o)a.owner[a.prop]=o.addRef();else{if(ce("The asset "+a.uuid+" is missing!"),a.type&&a.type!==gt){var u=new a.type;u.initDefault(a.uuid),a.owner[a.prop]=u}!0}}t.__depends__=null}t.__nativeDepend__&&(i[e+"@native"]?t._nativeAsset=i[e+"@native"]:(!0,console.error("the native asset of "+e+" is missing!")),t.__nativeDepend__=!1)}(a,t,r);try{"function"!=typeof t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){ce("The asset "+a+" is invalid for some reason, detail message: "+e.message+", stack: "+e.stack)}St.remove(o),Ut.remove(o),mn(a,t,h),f.recycle()}for(var l=d.callbacks,c=0,p=l.length;c<p;c++){var _=l[c];t.addRef&&t.addRef(),_.item.content=t,_.done(e)}l.length=0}});Vt.async(f)}(e,n,t)}))}}]);function er(e,t){var i=e.options,n=Object.create(null),r=Object.create(null);for(var s in i)switch(s){case bt.PATH:case bt.UUID:case bt.DIR:case bt.SCENE:case bt.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":n[s]=i[s];break;case"__exclude__":case"__outputAsArray__":r[s]=i[s];break;default:n[s]=i[s],r[s]=i[s]}e.options=r;var a=Mt.create({input:e.input,options:n}),o=null;try{e.output=e.source=Ht.sync(a)}catch(e){o=e;for(var u=0,l=a.output.length;u<l;u++)a.output[u].recycle()}a.recycle(),t(o)}var tr=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},ke(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();tr.MAX_DEAD_NUM=500,tr._deadPool=[];var ir=[];function nr(e){var t=e.options,i=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var n=function(n){var r=i[n],s=tr.create(),a=null,o=null;if("string"==typeof r&&((r=Object.create(null))[t.__requestType__||bt.UUID]=i[n]),"object"==typeof r)for(var u in jt(r,t),r.preset&&jt(r,zt[r.preset]),r){switch(u){case bt.UUID:if("break"===function(){var e=s.uuid=ft(r.uuid);if(!r.bundle){var t=Tt.find((function(t){return!!t.getAssetInfo(e)}));r.bundle=t&&t.name}if(Tt.has(r.bundle)){if(a=Tt.get(r.bundle).config,(o=a.getAssetInfo(e))&&o.redirect){if(!Tt.has(o.redirect))throw new Error("Please load bundle "+o.redirect+" first");a=Tt.get(o.redirect).config,o=a.getAssetInfo(e)}s.config=a,s.info=o}return s.ext=r.ext||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case bt.DIR:if(Tt.has(r.bundle)){Tt.get(r.bundle).config.getDirWithPath(r.dir,r.type,ir);for(var l,h=Xe(ir);!(l=h()).done;){var c=l.value;i.push({uuid:c.uuid,__isNative__:!1,ext:".json",bundle:r.bundle})}ir.length=0}s.recycle(),s=null;break;case bt.PATH:if(Tt.has(r.bundle)){if(a=Tt.get(r.bundle).config,(o=a.getInfoWithPath(r.path,r.type))&&o.redirect){if(!Tt.has(o.redirect))throw new Error("you need to load bundle "+o.redirect+" first");a=Tt.get(o.redirect).config,o=a.getAssetInfo(o.uuid)}if(!o)throw s.recycle(),new Error("Bundle "+r.bundle+" doesn't contain "+r.path);s.config=a,s.uuid=o.uuid,s.info=o}s.ext=r.ext||".json";break;case bt.SCENE:if(!r.bundle){var d=Tt.find((function(e){return!!e.getSceneInfo(r.scene)}));r.bundle=d&&d.name}if(Tt.has(r.bundle)){if(a=Tt.get(r.bundle).config,(o=a.getSceneInfo(r.scene))&&o.redirect){if(!Tt.has(o.redirect))throw new Error("you need to load bundle "+o.redirect+" first");a=Tt.get(o.redirect).config,o=a.getAssetInfo(o.uuid)}if(!o)throw s.recycle(),new Error("Bundle "+a.name+" doesn't contain scene "+r.scene);s.config=a,s.uuid=o.uuid,s.info=o}break;case"__isNative__":s.isNative=r.__isNative__;break;case bt.URL:s.url=r.url,s.uuid=r.uuid||r.url,s.ext=r.ext||qt(r.url),s.isNative=void 0===r.__isNative__||r.__isNative__;break;default:s.options[u]=r[u]}if(!s)break}if(!s)return"continue";if(e.output.push(s),!s.uuid&&!s.url)throw new Error("Can not parse this input:"+JSON.stringify(r))},r=0;r<i.length;r++)n(r);return null}function rr(e){for(var t=e.output=e.input,i=0;i<t.length;i++){var n=t[i];if(!n.url){var r,s,a=n.config;s=n.isNative?a&&a.nativeBase?a.base+a.nativeBase:fe.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:fe.assetManager.generalImportBase;var o=n.uuid,u="";n.info&&(u=n.isNative?n.info.nativeVer?"."+n.info.nativeVer:"":n.info.ver?"."+n.info.ver:""),r=".ttf"===n.ext?s+"/"+o.slice(0,2)+"/"+o+u+"/"+n.options.__nativeName__:s+"/"+o.slice(0,2)+"/"+o+u+n.ext,n.url=r}}return null}var sr=e("A",function(){function e(){this.pipeline=Vt.append(er).append(Zn),this.fetchPipeline=Bt.append(er).append(Xn),this.transformPipeline=Ht.append(nr).append(rr),this.bundles=Tt,this.assets=pt,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=_t,this.force=Gt,this.allowImageBitmap=!Rt.isMobile,this.utils=Xt,this.downloader=Ln,this.parser=Kn,this.packManager=Gn,this.cacheAsset=!0,this.cacheManager=null,this.presets=zt,this.factory=qn,this.preprocessPipe=er,this.fetchPipe=Xn,this.loadPipe=Zn,this.references=Yt,this._releaseManager=cn,this._files=St,this._parsed=Ut,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var i=e.nativeBase||"";i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),this.generalImportBase=t,this.generalNativeBase=i},t.getBundle=function(e){return Tt.get(e)||null},t.removeBundle=function(e){e._destroy(),Tt.remove(e.name)},t.loadAny=function(e,t,i,n){var r=yn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.preset=s.preset||"default",e=Array.isArray(e)?e.slice():e;var u=Mt.create({input:e,onProgress:a,onComplete:bn(o),options:s});Vt.async(u)},t.preloadAny=function(e,t,i,n){var r=yn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.preset=s.preset||"preload",e=Array.isArray(e)?e.slice():e;var u=Mt.create({input:e,onProgress:a,onComplete:bn(o),options:s});Bt.async(u)},t.postLoadNative=function(e,t,i){var n=yn(t,void 0,i),r=n.options,s=n.onComplete;if(e._native&&e.__nativeDepend__){var a=_t.getNativeDep(e._uuid);if(a){if(!Tt.has(a.bundle)){var o=Tt.find((function(t){return!!t.getAssetInfo(e._uuid)}));o&&(a.bundle=o.name)}this.loadAny(a,r,(function(t,i){t?ce(t.message,t.stack):e.isValid&&e.__nativeDepend__&&(e._nativeAsset=i,e.__nativeDepend__=!1),s&&s(t)}))}}else bn(s)(null)},t.loadRemote=function(e,t,i){var n=yn(t,void 0,i),r=n.options,s=n.onComplete;r.reloadAsset||!this.assets.has(e)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:e},r,null,(function(t,i){t?(ce(t.message,t.stack),s&&s(t,i)):qn.create(e,i,r.ext||qt(e),r,(function(e,t){s&&s(e,t)}))}))):bn(s)(null,this.assets.get(e))},t.loadBundle=function(e,t,i){var n=yn(t,void 0,i),r=n.options,s=n.onComplete,a=It(e);this.bundles.has(a)?bn(s)(null,this.getBundle(a)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:e},r,null,(function(t,i){t?(ce(t.message,t.stack),s&&s(t,i)):qn.create(e,i,"bundle",r,(function(e,t){s&&s(e,t)}))})))},t.releaseAsset=function(e){cn.tryRelease(e,!0)},t.releaseUnusedAssets=function(){pt.forEach((function(e){cn.tryRelease(e)}))},t.releaseAll=function(){pt.forEach((function(e){cn.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},ke(e,[{key:"main",get:function(){return Tt.get(Ct.MAIN)||null}},{key:"resources",get:function(){return Tt.get(Ct.RESOURCES)||null}}]),e}());sr.Pipeline=Wt,sr.Task=Mt,sr.Cache=ht,sr.RequestItem=tr,sr.Bundle=An,sr.BuiltinBundleName=Ct;var ar=e("i",fe.assetManager=new sr);fe.AssetManager=sr;var or=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],ur=[".mp3",".ogg",".wav",".m4a"];function lr(){return!0}var hr={transformURL:function(e){var t=Kt(e);if(!t)return e;var i=Tt.find((function(e){return!!e.getAssetInfo(t)}));if(!i)return e;var n,r=i.getAssetInfo(t);if(!(n=e.startsWith(i.base+i.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==e.indexOf(n))return e;var s=!1;if(".ttf"===qt(e)&&(s=!0),s){var a=Zt(e),o=It(e);e=a+"."+n+"/"+o}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(e){return e+"."+n}));return e}},cr=e("j",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=wn}var t=e.prototype;return t.load=function(e,t,i){void 0===i&&void 0!==t&&(i=t,t=null);for(var n=Array.isArray(e)?e:[e],r=0;r<n.length;r++){var s=n[r];"string"==typeof s?n[r]={url:s,__isNative__:!0}:(s.type&&(s.ext="."+s.type,s.type=void 0),s.url&&(s.__isNative__=!0))}var a=[],o=[];ar.loadAny(n,null,(function(e,i,n){n.content&&(or.includes(n.ext)?a.push(n.content):ur.includes(n.ext)&&o.push(n.content)),t&&t(e,i,n)}),(function(e,t){var r=null;if(!e){t=Array.isArray(t)?t:[t];for(var s=function(e){var i=t[e];if(!(i instanceof gt)){var r=i,s=n[e].url;a.includes(r)?qn.create(s,i,".png",{},(function(i,n){r=t[e]=n})):o.includes(r)&&qn.create(s,i,".mp3",{},(function(i,n){r=t[e]=n})),pt.add(s,r)}},u=0;u<t.length;u++)s(u);if(t.length>1){var l=Object.create(null);t.forEach((function(e){l[e._uuid]=e})),r={isCompleted:lr,_map:l}}else r=t[0]}i&&i(e,r)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return ar.assets.has(e)?{content:ar.assets.get(e)}:null},t.loadRes=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete,u=qt(e);u&&!En.getInfoWithPath(e,s)&&(e=e.slice(0,-u.length)),En.load(e,s,a,o)},t.loadResArray=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;e.forEach((function(t,i){var n=qt(t);n&&!En.getInfoWithPath(t,s)&&(e[i]=t.slice(0,-n.length))})),En.load(e,s,a,o)},t.loadResDir=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;En.loadDir(e,s,a,(function(t,i){var n=[];t||(n=En.getDirWithPath(e,s).map((function(e){return e.path}))),o&&o(t,i,n)}))},t.getRes=function(e,t){return pt.has(e)?pt.get(e):En.get(e,t)},t.getResCount=function(){return pt.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return _t.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),i=function(i){var n=e[i];t["."+i]=function(e,t,i){n({url:e},i)}};for(var n in e)i(n);Ln.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),i=function(i){var n=e[i];t["."+i]=function(e,t,i){n({content:e},i)}};for(var n in e)i(n);Kn.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t];"string"==typeof i&&(i=pt.get(i)),ar.releaseAsset(i)}else e&&("string"==typeof e&&(e=pt.get(e)),ar.releaseAsset(e))},t.releaseAsset=function(e){ar.releaseAsset(e)},t.releaseRes=function(e,t){En.release(e,t)},t.releaseAll=function(){ar.releaseAll(),pt.clear()},t.removeItem=function(e){return!!pt.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var i=_t.getDepsRecursively(e),n=0;n<i.length;n++)this._autoReleaseSetting[i[n]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},ke(e,[{key:"onProgress",set:function(e){dn=e}},{key:"_cache",get:function(){return pt._map}},{key:"md5Pipe",get:function(){return hr}},{key:"downloader",get:function(){return Ln}},{key:"loader",get:function(){return ar.parser}}]),e}()),dr=e("l",new cr),fr=e("k",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,ar.init(e),e.rawAssets&&En.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:Ct.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets)})},loadAsset:function(e,t){ar.loadAny(e,t)}}),pr=e("u",{});it(pr,"url",[{name:"normalize",target:ar.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?Ft({path:Qt(e.substr(10)),bundle:Ct.RESOURCES,__isNative__:!0,ext:qt(e)}):""}}]),nt(fr,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),nt(dr,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),it(fe,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return dr}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return fr}},{name:"Pipeline",target:sr,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return pr}}]),nt(fe,"cc",[{name:"LoadingItems",suggest:At(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),it(Jt,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:Ln,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),it(rn,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return ar.main?null===(t=ar.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),it(bi,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return ar.main&&ar.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var _r,gr,mr,vr,yr,wr,Tr,br,Ar,Er,Sr,Nr,Rr,Ir,xr=cn._autoRelease;cn._autoRelease=function(e,t,i){xr.call(cn,e,t,i);for(var n=dr._autoReleaseSetting,r=Object.keys(n),s=0;s<r.length;s++){var a=r[s];if(!0===n[a]){var o=pt.get(a);o&&cn.tryRelease(o)}}};var Cr,Pr,kr,Dr,Fr,Mr,Br=e("E",(_r=$t("cc.ClickEvent"),gr=ei(fe.Node),mr=si(),vr=si(),yr=si(),wr=si(),_r((Ir=function(){function e(){ii(this,"target",Ar,this),ii(this,"component",Er,this),ii(this,"_componentId",Sr,this),ii(this,"handler",Nr,this),ii(this,"customEventData",Rr,this)}e.emitEvents=function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var s=0,a=t.length;s<a;s++){var o=t[s];o instanceof e&&o.emit(n)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(fe.isValid(t)){this._genCompIdIfNeeded();var i=fe.js._getClassById(this._componentId),n=t.getComponent(i);if(fe.isValid(n)){var r=n[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),r.apply(n,e))}}},t._compName2Id=function(e){var t=fe.js.getClassByName(e);return fe.js._getClassId(t)},t._compId2Name=function(e){var t=fe.js._getClassById(e);return fe.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},ke(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),Ar=ti((br=Ir).prototype,"target",[ni,gr,mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Er=ti(br.prototype,"component",[ni,ri,vr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Sr=ti(br.prototype,"_componentId",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Nr=ti(br.prototype,"handler",[ni,ri,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Rr=ti(br.prototype,"customEventData",[ni,ri,wr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Tr=br))||Tr));fe.Component.EventHandler=Br,it(Wi,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),it(Wi.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),fe.CameraComponent=Wi,dt.setClassAlias(Wi,"cc.CameraComponent");var Lr,Ur,Or,Wr,Vr,Hr,jr,zr,qr,Gr,Xr,Yr=e("U",$t("cc.animation.UniformProxyFactory")((Mr=function(){function e(e,t){ii(this,"passIndex",kr,this),ii(this,"uniformName",Dr,this),ii(this,"channelIndex",Fr,this),this.passIndex=t||0,this.uniformName=e||""}return e.prototype.forTarget=function(e){var t=e.passes[this.passIndex],i=t.getHandle(this.uniformName);if(!i)throw new Error('Material "'+e.name+'" has no uniform "'+this.uniformName+'"');var n=ai.getPropertyTypeFromHandle(i);if(n===oi.BUFFER){var r=void 0===this.channelIndex?i:t.getHandle(this.uniformName,this.channelIndex,ui.FLOAT);if(!r)throw new Error('Uniform "'+this.uniformName+" (in material "+e.name+") has no channel "+this.channelIndex+'"');return function(e,t){for(var i,n=Xe(e.shaderInfo.blocks);!(i=n()).done;)for(var r,s=i.value,a=Xe(s.members);!(r=a()).done;){var o=r.value;if(o.name===t)return o.count>1}return!1}(t,this.uniformName)?{set:function(e){t.setUniformArray(r,e)}}:{set:function(e){t.setUniform(r,e)}}}if(n===oi.TEXTURE){var s=ai.getBindingFromHandle(i),a=t.properties[this.uniformName],o=a&&a.value?a.value+"-texture":li(a.type),u=$e.get(o);return u||(hi("Illegal texture default value: "+o+"."),u=$e.get("default-texture")),{set:function(e){e||(e=u);var i=e.getGFXTexture();i&&i.width&&i.height&&(t.bindTexture(s,i),e instanceof ci&&t.bindSampler(s,di.getSampler(fe.game._gfxDevice,e.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+n+".")},e}(),kr=ti((Pr=Mr).prototype,"passIndex",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Dr=ti(Pr.prototype,"uniformName",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Fr=ti(Pr.prototype,"channelIndex",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Cr=Pr))||Cr);function Qr(e,t,i,n){var r,s,a,o,u,h,c=new t,d=new t,f=new t,p=$t(e)((h=function(){function e(e,i,n){ii(this,"dataPoint",a,this),ii(this,"inTangent",o,this),ii(this,"outTangent",u,this),this.dataPoint=e||new t,this.inTangent=i||new t,this.outTangent=n||new t}var r=e.prototype;return r.lerp=function(e,t,r){var s=this.dataPoint,a=e.dataPoint;d=i(d,this.inTangent,r),f=i(f,e.outTangent,r);var o=t*t*t,u=t*t,l=o-2*u+t,h=-2*o+3*u,p=o-u;return c=i(c,s,2*o-3*u+1),c=n(c,c,d,l),c=n(c,c,a,h),c=n(c,c,f,p)},r.getNoLerp=function(){return this.dataPoint},e}(),a=ti((s=h).prototype,"dataPoint",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),o=ti(s.prototype,"inTangent",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),u=ti(s.prototype,"outTangent",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),r=s))||r;if(t===l){var _=p.prototype.lerp;p.prototype.lerp=function(e,t,i){var n=_.call(this,e,t,i);return l.normalize(n,n),n}}return p}e("M",$t("cc.animation.MorphWeightsValueProxy")((Wr=function(){function e(){ii(this,"subMeshIndex",Or,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(i){e.setWeights(i,t.subMeshIndex)}}},e}(),Or=ti((Ur=Wr).prototype,"subMeshIndex",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lr=Ur))||Lr),e("a",$t("cc.animation.MorphWeightsAllValueProxy")(Vr=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(t){for(var i,n,r=null!==(i=null===(n=e.mesh)||void 0===n?void 0:n.struct.primitives.length)&&void 0!==i?i:0,s=0;s<r;++s)e.setWeights(t,s)}}},e}())||Vr);var Jr=e("C",Qr("cc.CubicSplineVec2Value",n,n.multiplyScalar,n.scaleAndAdd));fe.CubicSplineVec2Value=Jr;var Kr=e("b",Qr("cc.CubicSplineVec3Value",s,s.multiplyScalar,s.scaleAndAdd));fe.CubicSplineVec3Value=Kr;var Zr=e("c",Qr("cc.CubicSplineVec4Value",o,o.multiplyScalar,o.scaleAndAdd));fe.CubicSplineVec4Value=Zr;var $r=e("d",Qr("cc.CubicSplineQuatValue",l,l.multiplyScalar,l.scaleAndAdd));fe.CubicSplineQuatValue=$r;var es=e("e",$t("cc.CubicSplineNumberValue")((Xr=function(){function e(e,t,i){ii(this,"dataPoint",zr,this),ii(this,"inTangent",qr,this),ii(this,"outTangent",Gr,this),this.dataPoint=e,this.inTangent=t,this.outTangent=i}var t=e.prototype;return t.lerp=function(e,t,i){var n=this.dataPoint,r=e.dataPoint,s=t*t*t,a=t*t;return n*(2*s-3*a+1)+this.outTangent*i*(s-2*a+t)+r*(-2*s+3*a)+e.inTangent*i*(s-a)},t.getNoLerp=function(){return this.dataPoint},e}(),zr=ti((jr=Xr).prototype,"dataPoint",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qr=ti(jr.prototype,"inTangent",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gr=ti(jr.prototype,"outTangent",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hr=jr))||Hr);fe.CubicSplineNumberValue=es,it(Ni.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var e=arguments.length<=0?void 0:arguments[0];return Ni.prototype.removeState.call(this,e.name)}}]),fe.AnimationComponent=Ni,dt.setClassAlias(Ni,"cc.AnimationComponent");var ts,is,ns,rs,ss,as,os,us=function(){function e(){this._nodeBlendStates=new Map}var t=e.prototype;return t.createWriter=function(e,t,i,n){var r=this.ref(e,t);return new ls(e,t,r,i,n)},t.destroyWriter=function(e){var t=e;this.deRef(t.node,t.property)},t.ref=function(e,t){var i=this._nodeBlendStates.get(e);return i||(i=new fs,this._nodeBlendStates.set(e,i)),i.refProperty(t)},t.deRef=function(e,t){var i=this._nodeBlendStates.get(e);i&&(i.deRefProperty(t),i.empty&&this._nodeBlendStates.delete(e))},t.apply=function(){this._nodeBlendStates.forEach((function(e,t){e.apply(t)}))},e}(),ls=function(){function e(e,t,i,n,r){this._node=e,this._property=t,this._propertyBlendState=i,this._host=n,this._constants=r}var t=e.prototype;return t.getValue=function(){return this._node[this._property]},t.setValue=function(e){var t=this._propertyBlendState,i=this._host.weight;t.blend(e,i)},ke(e,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),e}(),hs=function(e){this.blendedWeight=0,this.blendedValue=void 0,this.refCount=0,this.blendedValue=e},cs=function(e){function t(){return e.call(this,new s)||this}Me(t,e);var i=t.prototype;return i.blend=function(e,t){var i=this.blendedValue;1===t?s.copy(i,e):s.scaleAndAdd(i,i,e,t),this.blendedWeight+=t},i.reset=function(){this.blendedWeight=0,s.zero(this.blendedValue)},t}(hs),ds=function(e){function t(){return e.call(this,new l)||this}Me(t,e);var i=t.prototype;return i.blend=function(e,t){if(0!==t){var i=this.blendedValue,n=this.blendedWeight;if(1===t)l.copy(i,e);else{var r=t/(n+t);l.slerp(i,i,e,r)}this.blendedWeight+=t}},i.reset=function(){this.blendedWeight=0,l.identity(this.blendedValue)},t}(hs),fs=function(){function e(){this._properties={}}var t=e.prototype;return t.refProperty=function(e){var t,i,n,r=this._properties;switch(e){default:case"position":case"scale":case"eulerAngles":n=null!==(t=r[e])&&void 0!==t?t:r[e]=new cs;break;case"rotation":n=null!==(i=r[e])&&void 0!==i?i:r[e]=new ds}return++n.refCount,n},t.deRefProperty=function(e){var t=this._properties,i=t[e];i&&(--i.refCount,i.refCount>0||delete t[e])},t.apply=function(e){var t,i,n,r=this._properties,s=r.position,a=r.scale,o=r.rotation,u=r.eulerAngles,l=!1,h=!1,c=!1,d=!1;s&&s.blendedWeight&&(l=!0,s.blendedWeight<1&&s.blend(e.position,1-s.blendedWeight),t=s.blendedValue),a&&a.blendedWeight&&(h=!0,a.blendedWeight<1&&a.blend(e.scale,1-a.blendedWeight),i=a.blendedValue),u&&u.blendedWeight&&(d=!0,u.blendedWeight<1&&u.blend(e.eulerAngles,1-u.blendedWeight),n=u.blendedValue),o&&o.blendedWeight&&(c=!0,o.blendedWeight<1&&o.blend(e.rotation,1-o.blendedWeight),n=o.blendedValue),(n||t||i)&&e.setRTS(n,t,i),l&&s.reset(),h&&a.reset(),c&&o.reset(),d&&u.reset()},ke(e,[{key:"empty",get:function(){var e=this._properties;return!(e.position||e.rotation||e.eulerAngles||e.scale)}}]),e}(),ps=e("w",$t((ns=is=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._anims=new pi([]),t._crossFades=new pi([]),t._delayEvents=[],t._blendStateBuffer=new us,t._sockets=[],t}Me(t,e);var i=t.prototype;return i.addCrossFade=function(e){-1===this._crossFades.array.indexOf(e)&&this._crossFades.push(e)},i.removeCrossFade=function(e){var t=this._crossFades.array.indexOf(e);t>=0?this._crossFades.fastRemoveAt(t):Le(3907)},i.update=function(e){var t=this._delayEvents,i=this._crossFades,n=this._sockets,r=i.array;for(i.i=0;i.i<r.length;++i.i)r[i.i].update(e);var s=this._anims,a=s.array;for(s.i=0;s.i<a.length;++s.i){var o=a[s.i];o.isMotionless||o.update(e)}this._blendStateBuffer.apply();for(var u=fe.director.getTotalFrames(),l=0,h=n.length;l<h;l++){var c=n[l],d=c.target,f=c.transform;d.matrix=Ri(f,u)}for(var p=0,_=t.length;p<_;p++){var g=t[p];g.fn.apply(g.thisArg,g.args)}t.length=0},i.destruct=function(){},i.addAnimation=function(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)},i.removeAnimation=function(e){var t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):Le(3907)},i.pushDelayEvent=function(e,t,i){this._delayEvents.push({fn:e,thisArg:t,args:i})},i.addSockets=function(e,t){for(var i=this,n=function(n){var r=t[n];if(i._sockets.find((function(e){return e.target===r.target})))return"continue";var s=e.getChildByPath(r.path),a=r.target&&s&&xi(s,e);a&&i._sockets.push({target:r.target,transform:a})},r=0;r<t.length;++r)n(r)},i.removeSockets=function(e,t){for(var i=0;i<t.length;++i)for(var n=t[i],r=0;r<this._sockets.length;++r){var s=this._sockets[r];if(s.target===n.target){Ii(s.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},ke(t,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),t}(Gi),is.ID="animation",ts=ns))||ts);rn.on(nn.EVENT_INIT,(function(){var e=new ps;rn.registerSystem(ps.ID,e,Zi.PRIORITY_SYSTEM)})),fe.AnimationManager=ps,fe.easing=Ci;var _s=e("H",$t("cc.HierachyModifier")(rs=function(e){function t(){return e.apply(this,arguments)||this}return Me(t,e),t}(Pi))||rs);fe.HierachyModifier=_s;var gs=e("o",$t("cc.ComponentModifier")(ss=function(e){function t(){return e.apply(this,arguments)||this}return Me(t,e),t}(ki))||ss);fe.ComponentModifier=gs;var ms=e("p",$t("cc.CurveValueAdapter")(as=function(){function e(){}return e.prototype.forTarget=function(){return{set:function(){}}},e}())||as);fe.CurveValueAdapter=ms;var vs=e("q",$t("cc.UniformCurveValueAdapter")(os=function(e){function t(){return e.apply(this,arguments)||this}return Me(t,e),t}(Yr))||os);function ys(e){return"string"==typeof e}function ws(e){return"number"==typeof e}function Ts(e,t){return e instanceof t}fe.UniformCurveValueAdapter=vs,fe.isPropertyModifier=ys,fe.isElementModifier=ws,fe.isCustomTargetModifier=Ts,fe.math=Vi,fe.geometry=Hi}}}));
